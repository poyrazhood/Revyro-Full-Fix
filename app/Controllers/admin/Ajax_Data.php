<?php

namespace App\Controllers\admin;

use App\Models\service_api;
use App\Models\ticket_reply;
use CodeIgniter\Controller;
use PDO;
use SMMApi;

class Ajax_Data extends Ana_Controller
{
    function index()
    {
        include APPPATH . 'ThirdParty/SMMApi/SMMApi.php';
        global $conn;
        global $_SESSION;
        $action = $_POST["action"];
        $languages = $conn->prepare("SELECT * FROM languages WHERE language_type=:type");
        $languages->execute(["type" => 2]);
        $languages = $languages->fetchAll(PDO::FETCH_ASSOC);
        $settings = $this->settings;
        $user = $this->getuser;
        if ($action == "providers_list") {
            $smmapi = new SMMApi();
            $provider = isset($_POST["provider"]) ? $_POST["provider"] : 0;
            if ($provider) {
                $api = $conn->prepare("SELECT * FROM service_api WHERE id=:id");
                $api->execute(["id" => $provider]);
                $api = $api->fetch(PDO::FETCH_ASSOC);
                if ($api["api_type"] == 3) {
                    echo "<div class=\"service-mode__block\">\r\n\r\n          <div class=\"form-group\">\r\n\r\n            <label>Servis</label>\r\n\r\n            <input class=\"form-control\" name=\"service\" placeholder=\"Servis ID giriniz\">\r\n\r\n          </div>\r\n\r\n        </div>";
                } else {
                    if ($api["api_type"] == 1) {
                        $services = $smmapi->action(["key" => $api["api_key"], "action" => "services"], $api["api_url"]);
                        echo "<div class=\"service-mode__block\">\r\n\r\n          <div class=\"form-group\">\r\n\r\n          <label>Servis</label>\r\n\r\n            <select class=\"form-control\" name=\"service\">";
                        foreach ($services as $service) {
                            echo "<option data-max=" . $service->max . " data-min=" . $service->min . " data-price=" . $service->rate . " value=\"" . $service->service . "\"";
                            if (isset($_SESSION["data"]["service"]) && $_SESSION["data"]["service"] == $service->service) {
                                echo "selected";
                            }
                            echo ">" . $service->service . " - " . $service->name . " - " . priceFormat($service->rate) . "</option>";
                        }
                        echo "</select>\r\n\r\n          </div>\r\n\r\n        </div><script>selectService()</script>";
                    }
                }
                unset($_SESSION["data"]);
            }
        }
        if ($action == "providers_list2") {
            $smmapi = new SMMApi();
            $provider = isset($_POST["provider"]) ? $_POST["provider"] : 0;
            if ($provider) {

                $api = $conn->prepare("SELECT * FROM service_api WHERE id=:id");
                $api->execute(["id" => $provider]);
                $api = $api->fetch(PDO::FETCH_ASSOC);
                if ($api["api_type"] == 3) {
                    echo "<div class=\"service-mode__block\">\r\n\r\n          <div class=\"form-group\">\r\n\r\n            <label>Servis</label>\r\n\r\n            <input class=\"form-control\" name=\"service2\" placeholder=\"Servis ID giriniz\">\r\n\r\n          </div>\r\n\r\n        </div>";
                } else {
                    if ($api["api_type"] == 1) {
                        $services = $smmapi->action(["key" => $api["api_key"], "action" => "services"], $api["api_url"]);
                        echo "<div class=\"service-mode__block\">\r\n\r\n          <div class=\"form-group\">\r\n\r\n          <label>Servis</label>\r\n\r\n            <select class=\"form-control\" name=\"service2\">";
                        foreach ($services as $service) {
                            echo "<option data-max=" . $service->max . " data-min=" . $service->min . " data-price=" . $service->rate . " value=\"" . $service->service . "\"";
                            if (isset($_SESSION["data"]["service"]) && $_SESSION["data"]["service"] == $service->service) {
                                echo "selected";
                            }
                            echo ">" . $service->service . " - " . $service->name . " - " . priceFormat($service->rate) . "</option>";
                        }
                        echo "</select>\r\n\r\n          </div>\r\n\r\n        </div><script>selectService()</script>";
                    }
                }
                unset($_SESSION["data"]);
            }
        } else {
            if ($action == "paymentmethod-sortable") {
                $list = $_POST["methods"];
                foreach ($list as $method) {
                    $update = $conn->prepare("UPDATE payment_methods SET method_line=:line WHERE id=:id ");
                    $update->execute(["id" => $method["id"], "line" => $method["line"]]);
                }
            } else {
                if ($action == "service-sortable") {
                    $list = $_POST["services"];
                    foreach ($list as $service) {
                        $id = explode("-", $service["id"]);
                        $update = $conn->prepare("UPDATE services SET service_line=:line WHERE service_id=:id ");
                        $update->execute(["id" => $id[1], "line" => $service["line"]]);
                    }
                } else {
                    if ($action == "category-sortable") {
                        $list = $_POST["categories"];
                        foreach ($list as $category) {
                            $update = $conn->prepare("UPDATE categories SET category_line=:line WHERE category_id=:id ");
                            $update->execute(["id" => $category["id"], "line" => $category["line"]]);
                        }
                    } else {
                        if ($action == "secret_user") {
                            $id = $_POST["id"];
                            $services = $conn->prepare("SELECT * FROM services RIGHT JOIN categories ON categories.category_id=services.category_id WHERE services.service_secret='1' || categories.category_secret='1'  ");
                            $services->execute(["id" => $id]);
                            $services = $services->fetchAll(PDO::FETCH_ASSOC);
                            $grouped = array_group_by($services, "category_name");
                            $return = "<form class=\"form\" action=\"" . base_url("admin/clients/export") . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n\r\n\r\n        <div class=\"majer\">\r\n\r\n               <div>\r\n\r\n                  <div class=\"services-import__list-wrap services-import__list-active\">\r\n\r\n                     <div class=\"services-import__scroll-wrap\">";
                            foreach ($grouped as $category) {
                                $row = ["table" => "clients_category", "where" => ["client_id" => $id, "category_id" => $category[0]["category_id"]]];
                                $return .= "<span>\r\n\r\n                            <div class=\"services-import__category\">\r\n\r\n                               <div class=\"services-import__category-title\">\r\n\r\n                                 <label> ";
                                if ($category[0]["category_secret"] == 1) {
                                    $return .= "<small><i class=\"fa fa-lock\"></i></small> <input type=\"checkbox\"";
                                    if (countRow($row)) {
                                        $return .= "checked";
                                    }
                                    $return .= " class=\"tiny-toggle\" data-tt-palette=\"blue\" data-url=\"" . base_url("admin/clients/secret_category/" . $id) . "\" data-id=\"" . $category[0]["category_id"] . "\"> ";
                                }
                                $return .= $category[0]["category_name"] . " </label>\r\n\r\n                               </div>\r\n\r\n                            </div>\r\n\r\n                             <div class=\"services-import__packages\">\r\n\r\n                                <ul>";
                                for ($i = 0; $i < count($category); $i++) {
                                    $row = ["table" => "clients_service", "where" => ["client_id" => $id, "service_id" => $category[$i]["service_id"]]];
                                    $return .= "<li id=\"service-" . $category[$i]["service_id"] . "\">\r\n\r\n                                     <label>";
                                    if ($category[$i]["service_secret"] == 1) {
                                        $return .= "<small><i class=\"fa fa-lock\"></i></small> ";
                                    }
                                    $return .= $category[$i]["service_id"] . " - " . $category[$i]["service_name"] . "\r\n\r\n                                        <span class=\"services-import__packages-price-edit\" >";
                                    if ($category[$i]["service_secret"] == 1) {
                                        $return .= "<input type=\"checkbox\"";
                                        if (countRow($row)) {
                                            $return .= "checked";
                                        }
                                        $return .= "  class=\"tiny-toggle\" data-tt-palette=\"blue\" data-url=\"" . base_url("admin/clients/secret_service/" . $id) . "\" data-id=\"" . $category[$i]["service_id"] . "\">";
                                    }
                                    $return .= "</span>\r\n\r\n                                     </label>\r\n\r\n                                    </li>";
                                }
                                $return .= "</ul>\r\n\r\n                             </div>\r\n\r\n                          </span>";

                               /* break;*/
                            }
                            $return .= "</div>\r\n\r\n                  </div>\r\n\r\n               </div>\r\n\r\n            </div>\r\n\r\n            <script src=\"" . base_url("assets/js/admin/") . "/jquery.tinytoggle.min.js\"></script>\r\n\r\n            <link rel=\"stylesheet\" type=\"text/css\" href=\"" . base_url("assets/css/admin/") . "/tinytoggle.min.css\" rel=\"stylesheet\">\r\n\r\n            <script>\r\n\r\n                       $('.tiny-toggle').tinyToggle({

              onCheck: function() {

                var id     = $(this).attr('data-id');

                var action = $(this).attr('data-url')+'?type=on&id='+id;

                  $.ajax({

                  url:  action,

                  type: 'GET',

                  dataType: 'json',

                  cache: false,

                  contentType: false,

                  processData: false

                  }).done(function(result){

                    if( result == 1 ){

                      $.toast({

                          heading: 'success',

                          text: 'İşlem Başarılı',

                          icon: 'success',

                          loader: true,

                          loaderBg: '#9EC600'

                      });

                    }else{

                      $.toast({

                          heading: 'Başarısız',

                          text: 'İşlem başarısız',

                          icon: 'error',

                          loader: true,

                          loaderBg: '#9EC600'

                      });

                    }

                  })

                  .fail(function(){

                    $.toast({

                        heading: 'Başarısız',

                        text: 'İşlem başarısız',

                        icon: 'error',

                        loader: true,

                        loaderBg: '#9EC600'

                    });

                  });

              },

              onUncheck: function() {

                var id     = $(this).attr('data-id');

                var action = $(this).attr('data-url')+'?type=off&id='+id;

                  $.ajax({

                  url:  action,

                  type: 'GET',

                  dataType: 'json',

                  cache: false,

                  contentType: false,

                  processData: false

                  }).done(function(result){

                    if( result == 1 ){

                      $.toast({

                          heading: 'success',

                          text: 'İşlem Başarılı',

                          icon: 'success',

                          loader: true,

                          loaderBg: '#9EC600'

                      });

                    }else{

                      $.toast({

                          heading: 'Başarısız',

                          text: 'İşlem başarısız',

                          icon: 'error',

                          loader: true,

                          loaderBg: '#9EC600'

                      });

                    }

                  })

                  .fail(function(){

                    $.toast({

                        heading: 'Başarısız',

                        text: 'İşlem başarısız',

                        icon: 'error',

                        loader: true,

                        loaderBg: '#9EC600'

                    });

                  });

              },

            });\r\n\r\n\r\n\r\n            </script>\r\n\r\n\r\n\r\n        </div>\r\n\r\n\r\n\r\n          <div class=\"modal-footer\">\r\n\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Kapat</button>\r\n\r\n          </div>\r\n\r\n          </form>";
                            echo json_encode(["content" => $return, "title" => "Kullanıcıya özel servisler"]);
                        } else {
                            if ($action == "new_user") {
                                $return = "<form class=\"form\" action=\"" . base_url("admin/clients/new") . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n";
                                if ($settings["name_secret"] == 1) {
                                    $return .= "<div style=\"display: none;\">";
                                }
                                $return .= " \r\n          <div class=\"form-group\">\r\n\r\n            <label class=\"form-group__service-name\"> İsim</label>\r\n\r\n            <input type=\"text\" class=\"form-control\" name=\"first_name\" value=\"\">\r\n\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n\r\n            <label class=\"form-group__service-name\"> Soyisim</label>\r\n\r\n            <input type=\"text\" class=\"form-control\" name=\"last_name\" value=\"\">\r\n\r\n          </div>";
                                if ($settings["name_secret"] == 1) {
                                    $return .= "</div>";
                                }
                                $return .= "  \r\n\r\n\r\n          <div class=\"form-group\">\r\n\r\n            <label> E-mail</label>\r\n\r\n            <input type=\"text\" name=\"email\" value=\"\" class=\"form-control\">\r\n\r\n          </div>\r\n\r\n\r\n\r\n          <div class=\"form-group\">\r\n\r\n            <label>Kullanıcı Adı</label>\r\n\r\n            <input type=\"text\" name=\"username\" class=\"form-control\" value=\"\">\r\n\r\n          </div>\r\n\r\n\r\n\r\n          <div class=\"form-group\">\r\n\r\n            <label>Şifre</label>\r\n\r\n            <div class=\"input-group\">\r\n\r\n              <input type=\"text\" class=\"form-control\" name=\"password\" value=\"\" id=\"user_password\">\r\n\r\n              <span class=\"input-group-btn\">\r\n\r\n                <button class=\"btn btn-default\" onclick=\"UserPassword()\" type=\"button\">\r\n\r\n                <span class=\"fa fa-random\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"\" aria-hidden=\"true\" data-original-title=\"Şifre Oluştur\"></span></button>\r\n\r\n              </span>\r\n\r\n            </div>\r\n\r\n          </div>";
                                if ($settings["skype_area"] == 1) {
                                    $return .= "<div style=\"display: none;\">";
                                }
                                $return .= " \r\n          <div class=\"form-group\">\r\n\r\n            <label>Telefon Numarası</label>\r\n\r\n            <input type=\"text\" name=\"telephone\" class=\"form-control\" value=\"\">\r\n\r\n          </div>";
                                if ($settings["skype_area"] == 1) {
                                    $return .= "</div>";
                                }
                                $return .= " \r\n\r\n          <div class=\"service-mode__block\">\r\n\r\n            <div class=\"form-group\">\r\n\r\n            <label>Borç kullanımı</label>\r\n\r\n              <select class=\"form-control\" id=\"debit\" name=\"balance_type\">\r\n\r\n                    <option value=\"2\">Kapalı</option>\r\n\r\n                    <option value=\"1\">Aktif</option>\r\n\r\n                </select>\r\n\r\n            </div>\r\n\r\n          </div>\r\n\r\n\r\n\r\n          <div class=\"form-group\" id=\"debit_limit\">\r\n\r\n            <label>Max Borç Tutarı</label>\r\n\r\n            <input type=\"text\" name=\"debit_limit\" class=\"form-control\" value=\"\">\r\n\r\n          </div>";
                                if ($user["access"]["admins"] == 0) {
                                    $return .= "<div style=\"display: none;\">";
                                }
                                $return .= "       <div class=\"service-mode__block\">\r\n\r\n            <div class=\"form-group\">\r\n\r\n            <label>Yetkili mi?</label>\r\n\r\n              <select class=\"form-control\" id=\"limit\" name=\"access[admin_access]\">\r\n\r\n                    <option value=\"0\" selected>Hayır</option>\r\n\r\n                    <option value=\"1\">Evet</option>\r\n\r\n                </select>\r\n\r\n            </div>\r\n\r\n          </div>\r\n\r\n\r\n\r\n          <div class=\"service-mode__block\">\r\n\r\n            <div class=\"form-group\" id=\"admin_limit\">\r\n\r\n            <label>Yetkiler</label>\r\n\r\n              <div class=\"form-group\">\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[users]\"  value=\"0\"> Kullanıcılar\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[orders]\"  value=\"0\"> Siparişler\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[subscriptions]\"  value=\"0\"> Abonelikler\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[dripfeed]\"  value=\"0\"> Drip-feed\r\n\r\n                  </label>\r\n\r\n                     \r\n                  <label class=\"checkbox-inline\">\r\n\r\n                  <input type=\"checkbox\" class=\"access\" name=\"access[tasks]\"  value=\"0\"> Tasks\r\n\r\n                </label>\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[services]\"  value=\"0\"> Servisler\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[payments]\"  value=\"0\"> Ödemeler\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[tickets]\"  value=\"0\"> Destek\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[reports]\"  value=\"0\"> İstatistikler\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[general_settings]\"  value=\"0\"> Ayarlar\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[pages]\"  value=\"0\"> Sayfalar\r\n\r\n                  </label>\r\n                  \r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[child_panels]\"  value=\"0\"> Child Panels\r\n\r\n                  </label>\r\n                  \r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[blog]\"  value=\"0\"> Blog\r\n\r\n                  </label>     <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[seo]\"  value=\"0\"> Seo Ayarları\r\n\r\n                  </label>\r\n                  \r\n                               <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[menu]\"  value=\"0\"> Menü Ayarları\r\n\r\n                  </label>\r\n                  \r\n                               <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[license]\"  value=\"0\"> Lisans Bilgileri\r\n\r\n                  </label>\r\n                            \r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[subject]\"  value=\"0\"> Konu Başlıkları\r\n\r\n                  </label>\r\n     \r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[payments_settings]\"  value=\"0\"> Ödeme Yöntemleri\r\n\r\n                    </label>  \r\n  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[bank_accounts]\"  value=\"0\"> Banka Hesapları\r\n\r\n                    </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[payments_bonus]\"  value=\"0\"> Ödeme Bonusları\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[alert_settings]\"  value=\"0\"> Bildirim Ayarları\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[providers]\"  value=\"0\"> Sağlayıcılar\r\n\r\n                  </label>\r\n                  \r\n                          <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[modules]\"  value=\"0\"> Modüller\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[themes]\"  value=\"0\"> Tema Ayarları\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[language]\"  value=\"0\"> Dil Ayarları\r\n\r\n                  </label>\r\n\r\n             \r\n\r\n\r\n\r\n                        <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[logs]\"  value=\"0\"> Loglar</label>\r\n\r\n                    \r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[admins]\"  value=\"0\"> Yetki Düzenleme\r\n\r\n                  </label>\r\n\r\n              </div>";
                                if ($user["access"]["admins"] == 0) {
                                    $return .= "</div>";
                                }
                                $return .= "\r\n            </div>\r\n\r\n          </div>\r\n\r\n\r\n\r\n\r\n\r\n        </div>\r\n\r\n\r\n\r\n          <div class=\"modal-footer\">\r\n\r\n            <button type=\"submit\" class=\"btn btn-primary\">Onayla</button>\r\n\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Kapat</button>\r\n\r\n          </div>\r\n\r\n          </form>\r\n\r\n          <script>\r\n\r\n            var type = \$(\"#debit\").val();\r\n\r\n            if( type == 2 ){\r\n\r\n              \$(\"#debit_limit\").hide();\r\n\r\n            } else{\r\n\r\n              \$(\"#debit_limit\").show();\r\n\r\n            }\r\n\r\n            \$(\"#debit\").change(function(){\r\n\r\n              var type = \$(this).val();\r\n\r\n                if( type == 2 ){\r\n\r\n                  \$(\"#debit_limit\").hide();\r\n\r\n                } else{\r\n\r\n                  \$(\"#debit_limit\").show();\r\n\r\n                }\r\n\r\n            });\r\n\r\n            var type = \$(\"#limit\").val();\r\n\r\n            if( type == 0 ){\r\n\r\n              \$(\"#admin_limit\").hide();\r\n\r\n            } else{\r\n\r\n              \$(\"#admin_limit\").show();\r\n\r\n            }\r\n\r\n            \$(\"#limit\").change(function(){\r\n\r\n              var type = \$(this).val();\r\n\r\n                if( type == 0 ){\r\n\r\n                  \$(\"#admin_limit\").hide();\r\n\r\n                } else{\r\n\r\n                  \$(\"#admin_limit\").show();\r\n\r\n                }\r\n\r\n            });\r\n\r\n          </script>";
                                echo json_encode(["content" => $return, "title" => "Yeni kullanıcı oluştur"]);
                            } else {
                                if ($action == "edit_user") {
                                    $id = $_POST["id"];
                                    $user = $conn->prepare("SELECT * FROM clients WHERE client_id=:id ");
                                    $user->execute(["id" => $id]);
                                    $user = $user->fetch(PDO::FETCH_ASSOC);
                                    $access = json_decode($user["access"], true);
                                    $user2 = $conn->prepare("SELECT * FROM clients WHERE client_id=:id ");
                                    $user2->execute(["id" => $_SESSION['neira_userid']]);
                                    $user2 = $user2->fetch(PDO::FETCH_ASSOC);
                                    $access2 = json_decode($user2["access"], true);
                                    $return = "<form class=\"form\" action=\"" . base_url("admin/clients/edit/" . $user["username"]) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n";
                                    if ($settings["name_secret"] == 2) {
                                        $return .= "<div class=\"form-group\">\r\n\r\n            <label class=\"form-group__service-name\">İsim</label>\r\n\r\n            <input type=\"text\" class=\"form-control\" name=\"first_name\" value=\"" . $user["first_name"] . "\">\r\n\r\n          </div>\r\n       <div class=\"form-group\">\r\n\r\n            <label class=\"form-group__service-name\">Soyisim</label>\r\n\r\n            <input type=\"text\" class=\"form-control\" name=\"last_name\" value=\"" . $user["last_name"] . "\">\r\n\r\n          </div>";
                                    }
                                    $return .= " \r\n        \r\n\r\n\r\n          <div class=\"form-group\">\r\n\r\n            <label> E-mail</label>\r\n\r\n            <input type=\"text\" name=\"email\" value=\"" . $user["email"] . "\" class=\"form-control\">\r\n\r\n          </div>\r\n\r\n\r\n\r\n          <div class=\"form-group\">\r\n\r\n            <label>Kullanıcı Adı</label>\r\n\r\n            <input type=\"text\" name=\"username\" class=\"form-control\"  value=\"" . $user["username"] . "\">\r\n\r\n          </div>\r\n\r\n";
                                    if ($settings["skype_area"] == 2) {
                                        $return .= " \r\n\r\n          <div class=\"form-group\">\r\n\r\n            <label>Telefon Numarası</label>\r\n\r\n            <input type=\"text\" name=\"telephone\" class=\"form-control\" value=\"" . $user["telephone"] . "\">\r\n\r\n          </div>";
                                    }
                                    $return .= " \r\n\r\n  <div class=\"form-group\">\r\n\r\n            <label>API Key</label>\r\n\r\n            <div class=\"input-group\">\r\n\r\n              <input type=\"text\" class=\"form-control\" value=\"" . $user["apikey"] . "\" id=\"api_key\" disabled>\r\n\r\n              <span class=\"input-group-btn\">\r\n\r\n               <a href=\"/admin/clients/change_apikey/" . $user["client_id"] . "\" class=\"btn btn-default\">\r\n\r\n                <span class=\"fa fa-random\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"\" aria-hidden=\"true\" data-original-title=\"API Key Oluştur\"></span></a>\r\n\r\n              </span>\r\n\r\n            </div>\r\n\r\n          </div>\r\n\r\n\r\n          <div class=\"service-mode__block\">\r\n\r\n            <div class=\"form-group\">\r\n\r\n            <label>Borç Kullanımı</label>\r\n\r\n              <select class=\"form-control\" id=\"debit\" name=\"balance_type\">\r\n\r\n                    <option value=\"2\"";
                                    if ($user["balance_type"] == 2) {
                                        $return .= "selected";
                                    }
                                    $return .= ">Kapalı</option>\r\n\r\n                    <option value=\"1\"";
                                    if ($user["balance_type"] == 1) {
                                        $return .= "selected";
                                    }
                                    $return .= ">Açık</option>\r\n\r\n                </select>\r\n\r\n            </div>\r\n\r\n          </div>\r\n\r\n\r\n\r\n          <div class=\"form-group\" id=\"debit_limit\">\r\n\r\n            <label>Max Borç Tutarı</label>\r\n\r\n            <input type=\"text\" name=\"debit_limit\" class=\"form-control\" value=\"" . $user["debit_limit"] . "\">\r\n\r\n          </div>";
                                    if (isset($access2["admins"]) && $access2["admins"] == 1) {
                                        $return .= "\r\n\r\n          <div class=\"service-mode__block\">\r\n\r\n            <div class=\"form-group\">\r\n\r\n            <label>Yetkili Hesabı mı?</label>\r\n\r\n              <select class=\"form-control\" id=\"limit\" name=\"access[admin_access]\">\r\n\r\n                    <option value=\"0\"";
                                        if (!isset($access["admin_access"])) {
                                            $return .= "selected";
                                        }
                                        $return .= ">Hayır</option>\r\n\r\n                    <option value=\"1\"";
                                        if (isset($access["admin_access"])) {
                                            $return .= "selected";
                                        }
                                        $return .= ">Evet</option>\r\n\r\n                </select>\r\n\r\n            </div>\r\n\r\n          </div>\r\n\r\n\r\n\r\n          <div class=\"service-mode__block\">\r\n\r\n            <div class=\"form-group\" id=\"admin_limit\">\r\n\r\n            <label>Yetkiler</label>\r\n\r\n              <div class=\"form-group \">\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[users]\"";
                                        if (isset($access["users"])) {
                                            $return .= "checked";
                                        }
                                        $return .= " value=\"1\"> Kullanıcılar\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[orders]\"";
                                        if (isset($access["orders"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Siparişler\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[subscriptions]\"";
                                        if (isset($access["subscriptions"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Abonelikler\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[dripfeed]\"";
                                        if (isset($access["dripfeed"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Drip-feed\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                  <input type=\"checkbox\" class=\"access\" name=\"access[tasks]\"";
                                        if (isset($access["tasks"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Tasks\r\n\r\n                </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[services]\"";
                                        if (isset($access["services"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Servisler\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[payments]\"";
                                        if (isset($access["payments"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Ödemeler\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[tickets]\"";
                                        if (isset($access["tickets"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Destek Talepleri\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[reports]\"";
                                        if (isset($access["reports"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> İstatistikler\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[general_settings]\"";
                                        if (isset($access["general_settings"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Ayarlar\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[pages]\"";
                                        if (isset($access["pages"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Sayfalar\r\n\r\n                  </label>   \r\n                  \r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[blog]\"";
                                        if (isset($access["blog"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Blog\r\n\r\n                  </label>   <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[seo]\"";
                                        if (isset($access["seo"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Seo Ayarları\r\n\r\n                  </label>\r\n                  \r\n                          <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[menu]\"";
                                        if (isset($access["menu"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Menü Ayarları\r\n\r\n                  </label>\r\n                  \r\n                     \r\n                  \r\n                          <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[subject]\"";
                                        if (isset($access["subject"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Konu Başlıkları\r\n\r\n                  </label>\r\n                  \r\n        <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[child_panels]\"";
                                        if (isset($access["child_panels"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Child Panels\r\n\r\n                  </label>\r\n\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[payments_settings]\"";
                                        if (isset($access["payments_settings"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Ödeme Ayarları\r\n\r\n                  </label>   \r\n                  \r\n                     <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[bank_accounts]\"";
                                        if (isset($access["bank_accounts"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Banka Hesapları\r\n\r\n                  </label>   \r\n                  \r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[payments_bonus]\"";
                                        if (isset($access["payments_bonus"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Ödeme Bonusları\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[alert_settings]\"";
                                        if (isset($access["alert_settings"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Bildirim Ayarları\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[providers]\"";
                                        if (isset($access["providers"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Sağlayıcılar\r\n\r\n                  </label>\r\n\r\n    <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[modules]\"";
                                        if (isset($access["modules"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Modüller\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[themes]\"";
                                        if (isset($access["themes"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Tema Ayarları\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[language]\"";
                                        if (isset($access["language"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Dil Ayarları\r\n\r\n                  </label>\r\n\r\n             \r\n\r\n                         <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[logs]\"";
                                        if (isset($access["logs"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Loglar\r\n\r\n                  </label>\r\n                  \r\n                  \r\n                         <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[provider_logs]\"";
                                        if (isset($access["provider_logs"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Sağlayıcı Logları\r\n\r\n                  </label>\r\n\r\n                         <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[guard_logs]\"";
                                        if (isset($access["guard_logs"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Koruma Logları\r\n\r\n                  </label>\r\n\r\n                  <label class=\"checkbox-inline\">\r\n\r\n                    <input type=\"checkbox\" class=\"access\" name=\"access[admins]\"";
                                        if (isset($access["admins"])) {
                                            $return .= "checked";
                                        }
                                        $return .= "  value=\"1\"> Yetki Ayarları\r\n\r\n                  </label>\r\n\r\n              </div>";
                                    }
                                    $return .= "</div>\r\n\r\n          </div>\r\n\r\n        </div>\r\n\r\n\r\n\r\n          <div class=\"modal-footer\">\r\n\r\n            <button type=\"submit\" class=\"btn btn-primary\">Güncelle</button>\r\n\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Kapat</button>\r\n\r\n          </div>\r\n\r\n          </form>\r\n\r\n          <script>\r\n\r\n            var type = \$(\"#debit\").val();\r\n\r\n            if( type == 2 ){\r\n\r\n              \$(\"#debit_limit\").hide();\r\n\r\n            } else{\r\n\r\n              \$(\"#debit_limit\").show();\r\n\r\n            }\r\n\r\n            \$(\"#debit\").change(function(){\r\n\r\n              var type = \$(this).val();\r\n\r\n                if( type == 2 ){\r\n\r\n                  \$(\"#debit_limit\").hide();\r\n\r\n                } else{\r\n\r\n                  \$(\"#debit_limit\").show();\r\n\r\n                }\r\n\r\n            });\r\n\r\n            var type = \$(\"#limit\").val();\r\n\r\n            if( type == 0 ){\r\n\r\n              \$(\"#admin_limit\").hide();\r\n\r\n            } else{\r\n\r\n              \$(\"#admin_limit\").show();\r\n\r\n            }\r\n\r\n            \$(\"#limit\").change(function(){\r\n\r\n              var type = \$(this).val();\r\n\r\n                if( type == 0 ){\r\n\r\n                  \$(\"#admin_limit\").hide();\r\n\r\n                } else{\r\n\r\n                  \$(\"#admin_limit\").show();\r\n\r\n                }\r\n\r\n            });\r\n\r\n          </script>\r\n\r\n          ";
                                    echo json_encode(["content" => $return, "title" => "Kullanıcıyı düzenle"]);
                                } else {
                                    if ($action == "pass_user") {
                                        $id = $_POST["id"];
                                        $user = $conn->prepare("SELECT * FROM clients WHERE client_id=:id ");
                                        $user->execute(["id" => $id]);
                                        $user = $user->fetch(PDO::FETCH_ASSOC);
                                        $return = "<form class=\"form\" action=\"" . base_url("admin/clients/pass/" . $user["username"]) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n\r\n\r\n          <div class=\"form-group\">\r\n\r\n            <label>Yeni Şifre</label>\r\n\r\n            <div class=\"input-group\">\r\n\r\n              <input type=\"text\" class=\"form-control\" name=\"password\" value=\"\" id=\"user_password\">\r\n\r\n              <span class=\"input-group-btn\">\r\n\r\n                <button class=\"btn btn-default\" onclick=\"UserPassword()\" type=\"button\">\r\n\r\n                <span class=\"fa fa-random\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"\" aria-hidden=\"true\" data-original-title=\"Şifre Oluştur\"></span></button>\r\n\r\n              </span>\r\n\r\n            </div>\r\n\r\n          </div>\r\n\r\n\r\n\r\n        </div>\r\n\r\n\r\n\r\n          <div class=\"modal-footer\">\r\n\r\n            <button type=\"submit\" class=\"btn btn-primary\">Onayla</button>\r\n\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Kapat</button>\r\n\r\n          </div>\r\n\r\n          </form>";
                                        echo json_encode(["content" => $return, "title" => "Parola düzenle"]);
                                    } else {
                                        if ($action == "alert_user") {
                                            $return = "<form class=\"form\" action=\"" . base_url("admin/clients/alert") . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"service-mode__block\">\r\n\r\n            <div class=\"form-group\">\r\n\r\n            <label>Bildirim Gönderilecek Üye</label>\r\n\r\n              <select class=\"form-control\" id=\"user_type\" name=\"user_type\">\r\n\r\n                    <option value=\"all\">Tüm üyeler</option>\r\n\r\n                    <option value=\"secret\">Üyeye özel</option>\r\n\r\n                </select>\r\n\r\n            </div>\r\n\r\n          </div>\r\n          \r\n          <div class=\"form-group\" id=\"username\">\r\n\r\n            <label>Kullanıcı adı</label>\r\n\r\n            <input type=\"text\" name=\"username\" class=\"form-control\" value=\"\">\r\n\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n\r\n            <div class=\"form-group\">\r\n\r\n            <label>Bildirim Tipi</label>\r\n\r\n              <select class=\"form-control\" id=\"alert_type\" name=\"alert_type\">\r\n\r\n                    <option value=\"email\">E-mail</option>\r\n\r\n                    <option value=\"sms\">SMS</option>\r\n\r\n                </select>\r\n\r\n            </div>\r\n\r\n          </div>\r\n\r\n\r\n\r\n          <div id=\"email\">\r\n\r\n            <div class=\"form-group\">\r\n\r\n              <label>E-mail Başlığı</label>\r\n\r\n              <input type=\"text\" name=\"subject\" class=\"form-control\" value=\"\">\r\n\r\n            </div>\r\n\r\n          </div>\r\n\r\n\r\n\r\n          <div class=\"form-group\" id=\"username\">\r\n\r\n            <label>Bildirim Mesajı</label>\r\n\r\n            <textarea type=\"text\" name=\"message\" class=\"form-control\" rows=\"5\"></textarea>\r\n\r\n          </div>\r\n\r\n        </div>\r\n\r\n        <script type=\"text/javascript\">\r\n\r\n          \$(\"#username\").hide();\r\n\r\n          \$(\"#user_type\").change(function(){\r\n\r\n            var type = \$(this).val();\r\n\r\n            if( type == \"secret\" ){\r\n\r\n              \$(\"#username\").show();\r\n\r\n            } else{\r\n\r\n              \$(\"#username\").hide();\r\n\r\n            }\r\n\r\n          });\r\n          \$(\"#alert_type\").change(function(){\r\n            var type = \$(this).val();\r\n            if( type == \"email\" ){\r\n              \$(\"#email\").show();\r\n            } else{\r\n\r\n              \$(\"#email\").hide();\r\n            }\r\n          });\r\n        </script>\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Kullanıcılara bildiri geç</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                            echo json_encode(["content" => $return, "title" => "Kullanıcılara bildirim"]);
                                        } else {
                                            if ($action == "new_service") {
                                                $categories = $conn->prepare("SELECT * FROM categories ORDER BY category_line ");
                                                $categories->execute([]);
                                                $categories = $categories->fetchAll(PDO::FETCH_ASSOC);
                                                $providers = $conn->prepare("SELECT * FROM service_api");
                                                $providers->execute([]);
                                                $providers = $providers->fetchAll(PDO::FETCH_ASSOC);

                                                $return = "<form class=\"form\" action=\"" . base_url("admin/services/new-service") . "\" method=\"post\" data-xhr=\"true\">\r\n        <div class=\"modal-body\">";
                                                if (1 < count($languages)) {
                                                    $translationList = "<a class=\"other_services\"> Çeviriler (" . (count($languages) - 1) . ") </a>";
                                                } else {
                                                    $translationList = "";
                                                }
                                                foreach ($languages as $language) {
                                                    if ($language["default_language"]) {
                                                        $return .= "<div class=\"form-group\">\r\n              <label class=\"form-group__service-name\">Servis adı <span class=\"badge\">" . $language["language_name"] . "</span> " . $translationList . " </label>\r\n              <input type=\"text\" class=\"form-control\" name=\"name[" . $language["language_code"] . "]\" value=\"" . $language["language_code"] . "\">\r\n            </div>";
                                                        if (1 < count($languages)) {
                                                            $return .= "<div class=\"hidden\" id=\"translationsList\">";
                                                        }
                                                    } else {
                                                        $return .= "<div class=\"form-group\">\r\n              <label class=\"form-group__service-name\">Servis adı <span class=\"badge\">" . $language["language_name"] . "</span> </label>\r\n              <input type=\"text\" class=\"form-control\" name=\"name[" . $language["language_code"] . "]\" value=\"" . $language["language_code"] . "\">\r\n            </div>";
                                                    }
                                                }
                                                if (1 < count($languages)) {
                                                    $return .= "</div>";
                                                }
                                                $return .= "<div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Servis Kategori</label>\r\n              <select class=\"form-control\" name=\"category\">\r\n                    <option value=\"0\">Lütfen kategori seçin..</option>";
                                                foreach ($categories as $category) {
                                                    $return .= "<option value=\"" . $category["category_id"] . "\">" . $category["category_name"] . "</option>";
                                                }
                                                $otocok = "<div class=\"form-group\">\r\n                <label>Servis Sağlayıcısı</label>\r\n                  <select class=\"form-control\" name=\"provider\" id=\"provider\">\r\n                        <option value=\"0\">Servis sağlayıcı seçiniz...</option>";
                                                $ikiis = '<div class="form-check">
                                                                                                    <input class="form-check-input" type="checkbox" value="1" name="ikiliislem" id="ikiliislem" onchange="ikilicheckbox(this);">
                                                                                                    <label class="form-check-label" for="ikiliislem">
                                                                                                      2li İşlem
                                                                                                    </label>
                                                                                                  </div>';
                                                $ikiis_ayni = '<div class="form-check" style="display:none" id="ikiislem">
                                                                                                    <input class="form-check-input" type="checkbox" value="1" name="siraliislem" id="siraliislem"">
                                                                                                    <label class="form-check-label" for="siraliislem">
                                                                                                      Sıralı İşlem
                                                                                                    </label>
                                                                                                  </div>';
                                                $return .= "</select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__wrapper\">\r\n            <div class=\"service-mode__block\">\r\n              <div class=\"form-group\">\r\n              <label>Servis Tipi</label>\r\n                <select class=\"form-control\" name=\"package\">\r\n                      <option value=\"1\">Servis</option>\r\n                      <option value=\"2\">Paket</option>\r\n                      <option value=\"3\">Özel Yorum</option>\r\n                      <option value=\"4\">Paket Yorum</option>\r\n                  </select>\r\n              </div>\r\n            </div>\r\n            <div class=\"service-mode__block\">\r\n              <div class=\"form-group\">\r\n              <label>Mod</label>\r\n                <select class=\"form-control\" name=\"mode\" id=\"serviceMode\">\r\n                      <option value=\"1\">Manuel</option>\r\n                      <option value=\"2\">Otomatik (API)</option>\r\n                  </select>\r\n              </div>\r\n            </div>\r\n\r\n            <div id=\"autoMode\" style=\"display: none\">\r\n              <div class=\"service-mode__block\">\r\n               " . $ikiis . " <div class=\"form-group\">\r\n                <label>Servis Sağlayıcısı</label>\r\n                  <select class=\"form-control\" name=\"provider\" id=\"provider\">\r\n                        <option value=\"0\">Servis sağlayıcı seçiniz...</option>";
                                                $iki_service = "<div class=\"form-group\" id='ikili_servis_select' style='display:none;'>\r\n                <label>Servis Sağlayıcısı 2</label>\r\n                  <select class=\"form-control\" name=\"provider_iki\" id=\"provider_iki\">\r\n                        <option value=\"0\">Servis sağlayıcı seçiniz...</option>";

                                                foreach ($providers as $provider) {
                                                    $return .= "<option value=\"" . $provider["id"] . "\">" . $provider["api_name"] . "</option>";
                                                    $iki_service .= "<option value=\"" . $provider["id"] . "\">" . $provider["api_name"] . "</option>";
                                                }
                                                $iki_service .= "</select>\r\n                </div>";
                                                $return .= "</select>\r\n                </div>\r\n              </div>\r\n              <div id=\"provider_service\">\r\n              </div>" . $iki_service . "<div id=\"provider_service_iki\">\r\n              </div>" . $ikiis_ayni . "\r\n              <div class=\"service-mode__block\">\r\n                <div class=\"form-group\">\r\n                <label>Dripfeed</label>\r\n                  <select class=\"form-control\" name=\"dripfeed\">\r\n                    <option value=\"1\">Pasif</option>\r\n                    <option value=\"2\">Aktif</option>\r\n                  </select>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">1000 Adet Ücreti</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"price\" value=\"\">\r\n          </div>\r\n\r\n          <div class=\"row\">\r\n            <div class=\"col-md-6 form-group\">\r\n              <label class=\"form-group__service-name\">Minimum</label>\r\n              <input type=\"text\" class=\"form-control\" name=\"min\" value=\"\">\r\n            </div>\r\n\r\n            <div class=\"col-md-6 form-group\">\r\n              <label class=\"form-group__service-name\">Maksimum</label>\r\n              <input type=\"text\" class=\"form-control\" name=\"max\" value=\"\">\r\n            </div>\r\n          </div>\r\n<hr>\r\n          <div class=\"row\">\r\n          <div class=\"form-group col-md-6\">\r\n          <label>İptal butonu</label>\r\n            <select class=\"form-control\" name=\"cancel_type\">\r\n                <option value=\"2\">Aktif</option>\r\n                <option value=\"1\" selected>Pasif</option>\r\n            </select>\r\n          </div>\r\n          \r\n          \r\n          <div class=\"form-group col-md-6\">\r\n          <label>Refill Butonu</label>\r\n            <select id=\"refill\" class=\"form-control\" name=\"refill_type\">\r\n                <option value=\"2\">Aktif</option>\r\n                <option value=\"1\" selected>Pasif</option>\r\n            </select>\r\n          </div>\r\n          </div>\r\n          \r\n          <div id=\"refill_day\" class=\"form-group\">\r\n          <label>Refill Maksimum Gün <small>(Lifetime ise 0 yazınız)</small></label>\r\n            <input type=\"number\" class=\"form-control\" name=\"refill_time\">\r\n          </div>\r\n       \r\n\r\n          <hr>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Sipariş Bağlantı <small>(Yeni sipariş sayfasında gösterilir)</small></label>\r\n              <select class=\"form-control\" name=\"want_username\">\r\n                  <option value=\"1\">Link</option>\r\n                  <option value=\"2\">Kullanıcı adı</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Kişiye Özel Servis <small>(Sadece seçtiğiniz kişiler görebilir)</small></label>\r\n              <select class=\"form-control\" name=\"secret\">\r\n                  <option value=\"2\">Hayır</option>\r\n                  <option value=\"1\">Evet</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Servis Hızı <small>(Servis listesinde sembol ve renk olarak gösterilir)</small></label>\r\n              <select class=\"form-control\" name=\"speed\">\r\n                  <option value=\"1\">Yavaş</option>\r\n                  <option value=\"2\">Bazen Yavaş</option>\r\n                  <option value=\"3\">Normal</option>\r\n                  <option value=\"4\">Hızlı</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Yeni servisi ekle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>\r\n          <script src=\"";

                                                $return .= base_url("assets/js/admin/") . "/";
                                                $return .= "script.js\"></script>\r\n          <script>\r\n\r\n          var type = \$(\"#refill\").val();\r\n\r\n          if( type == 1 ){\r\n\r\n            \$(\"#refill_day\").hide();\r\n\r\n          } else{\r\n\r\n            \$(\"#refill_day\").show();\r\n\r\n          }\r\n\r\n          \$(\"#refill\").change(function(){\r\n\r\n            var type = \$(this).val();\r\n\r\n              if( type == 1 ){\r\n\r\n                \$(\"#refill_day\").hide();\r\n\r\n              } else{\r\n\r\n                \$(\"#refill_day\").show();\r\n\r\n              }\r\n\r\n          });\r\n\r\n          \$(\".other_services\").click(function(){\r\n            var control = \$(\"#translationsList\");\r\n            if( control.attr(\"class\") == \"hidden\" ){\r\n              control.removeClass(\"hidden\");\r\n            } else{\r\n              control.addClass(\"hidden\");\r\n            }\r\n          });\r\n          </script>\r\n          ";
                                                echo json_encode(["content" => $return, "title" => "Yeni servis ekle"]);
                                            } else {
                                                if ($action == "edit_service") {
                                                    $id = $_POST["id"];
                                                    $smmapi = new SMMApi();
                                                    $categories = $conn->prepare("SELECT * FROM categories ORDER BY category_line ");
                                                    $categories->execute([]);
                                                    $categories = $categories->fetchAll(PDO::FETCH_ASSOC);
                                                    $serviceInfo = $conn->prepare("SELECT * FROM services LEFT JOIN service_api ON service_api.id=services.service_api WHERE services.service_id=:id ");
                                                    $serviceInfo->execute(["id" => $id]);
                                                    $serviceInfo = $serviceInfo->fetch(PDO::FETCH_ASSOC);
                                                    $providers = $conn->prepare("SELECT * FROM service_api");
                                                    $providers->execute([]);
                                                    $providers = $providers->fetchAll(PDO::FETCH_ASSOC);
                                                    $multiName = json_decode($serviceInfo["name_lang"], true);
                                                    if (in_array($serviceInfo["service_package"], ["11", "12", "13", "14", "15"])) {
                                                        $return = "<form class=\"form\" action=\"" . base_url("admin/services/edit-subscription/" . $serviceInfo["service_id"]) . "\" method=\"post\" data-xhr=\"true\">\r\n            <div class=\"modal-body\">";
                                                        if (1 < count($languages)) {
                                                            $translationList = "<a class=\"other_services\"> Çeviriler (" . (count($languages) - 1) . ") </a>";
                                                        } else {
                                                            $translationList = "";
                                                        }
                                                        foreach ($languages as $language) {
                                                            if ($language["default_language"]) {
                                                                $return .= "\r\n          <div class=\"form-group\">\r\n                    <label class=\"form-group__service-name\">Servis adı <span class=\"badge\">" . $language["language_name"] . "</span> " . $translationList . " </label>\r\n                    <input type=\"text\" class=\"form-control\" name=\"name[" . $language["language_code"] . "]\" value=\"" . $multiName[$language["language_code"]] . "\">\r\n                  </div>";
                                                                if (1 < count($languages)) {
                                                                    $return .= "<div class=\"hidden\" id=\"translationsList\">";
                                                                }
                                                            } else {
                                                                $return .= "<div class=\"form-group\">\r\n                    <label class=\"form-group__service-name\">Servis adı <span class=\"badge\">" . $language["language_name"] . "</span> </label>\r\n                    <input type=\"text\" class=\"form-control\" name=\"name[" . $language["language_code"] . "]\" value=\"" . $multiName[$language["language_code"]] . "\">\r\n                  </div>";
                                                            }
                                                        }
                                                        if (1 < count($languages)) {
                                                            $return .= "</div>";
                                                        }
                                                        $return .= "<div class=\"service-mode__block\">\r\n                <div class=\"form-group\">\r\n                <label>Servis Kategori</label>\r\n                  <select class=\"form-control\" name=\"category\">\r\n                        <option value=\"0\">Lütfen kategori seçin..</option>";
                                                        foreach ($categories as $category) {
                                                            $return .= "<option value=\"" . $category["category_id"] . "\"";
                                                            if ($serviceInfo["category_id"] == $category["category_id"]) {
                                                                $return .= "selected";
                                                            }
                                                            $return .= ">" . $category["category_name"] . "</option>";
                                                        }
                                                        $return .= "</select>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"service-mode__block\">\r\n                <div class=\"form-group\">\r\n                <label>Abonelik Tipi</label>\r\n                  <select class=\"form-control\" disabled  id=\"subscription_package\">\r\n                        <option value=\"11\"";
                                                        if ($serviceInfo["service_package"] == 11) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Instagram Otomatik Beğeni - Sınırsız</option>\r\n                        <option value=\"12\"";
                                                        if ($serviceInfo["service_package"] == 12) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Instagram Otomatik İzlenme - Sınırsız</option>\r\n                        <option value=\"14\"";
                                                        if ($serviceInfo["service_package"] == 14) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Instagram Otomatik Beğeni - Süreli</option>\r\n                        <option value=\"15\"";
                                                        if ($serviceInfo["service_package"] == 15) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Instagram Otomatik İzlenme - Süreli</option>\r\n                    </select>\r\n                </div>\r\n              </div>\r\n\r\n              \r\n\r\n              <div class=\"service-mode__wrapper\">\r\n\r\n                <div class=\"service-mode__block\">\r\n                  <div class=\"form-group\">\r\n                  <label>Mod</label>\r\n                    <select class=\"form-control\" name=\"mode\" id=\"serviceMode\">\r\n                          <option value=\"2\"";
                                                        if ($serviceInfo["service_api"] != 0) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Otomatik (API)</option>\r\n                      </select>\r\n                  </div>\r\n                </div>\r\n\r\n\r\n                <div id=\"autoMode\" style=\"display: none\">\r\n                  <div class=\"service-mode__block\">\r\n                    <div class=\"form-group\">\r\n                    <label>Servis Sağlayıcısı</label>\r\n                      <select class=\"form-control\" name=\"provider\" id=\"provider\">\r\n                            <option value=\"0\">Servis sağlayıcı seçiniz...</option>";
                                                        foreach ($providers as $provider) {
                                                            $return .= "<option value=\"" . $provider["id"] . "\"";
                                                            if ($serviceInfo["service_api"] == $provider["id"]) {
                                                                $return .= "selected";
                                                            }
                                                            $return .= ">" . $provider["api_name"] . "</option>";
                                                        }
                                                        $return .= "</select>\r\n                    </div>\r\n                  </div>\r\n                  <div id=\"provider_service\">";
                                                        $services = $smmapi->action(["key" => $serviceInfo["api_key"], "action" => "services"], $serviceInfo["api_url"]);
                                                        if ($serviceInfo["api_type"] == 1) {
                                                            $return .= "<div class=\"service-mode__block\">\r\n                      <div class=\"form-group\">\r\n                      <label>Servis</label>\r\n                        <select class=\"form-control\" name=\"service\">";
                                                            foreach ($services as $service) {
                                                                $return .= "<option value=\"" . $service->service . "\"";
                                                                if ($serviceInfo["api_service"] == $service->service) {
                                                                    $return .= "selected";
                                                                }
                                                                $return .= ">" . $service->service . " - " . $service->name . " - " . $service->rate . "</option>";
                                                            }
                                                            $return .= "</select>\r\n                      </div>\r\n                    </div>";
                                                        } else {
                                                            if ($serviceInfo["api_type"] == 3) {
                                                                $return .= "<div class=\"service-mode__block\">\r\n                      <div class=\"form-group\">\r\n                      <label>Servis</label>\r\n                        <input class=\"form-control\" value=\"" . $serviceInfo["api_service"] . "\" name=\"service\">\r\n                      </div>\r\n                    </div>";
                                                            }
                                                        }
                                                        $return .= "</div>\r\n                </div>\r\n              </div>\r\n\r\n              <div id=\"unlimited\">\r\n                <div class=\"form-group\">\r\n                  <label class=\"form-group__service-name\">Servis fiyatı (1000 adet)</label>\r\n                  <input type=\"text\" class=\"form-control\" name=\"price\" value=\"" . $serviceInfo["service_price"] . "\">\r\n                </div>\r\n\r\n                <div class=\"row\">\r\n                  <div class=\"col-md-6 form-group\">\r\n                    <label class=\"form-group__service-name\">Minimum sipariş</label>\r\n                    <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $serviceInfo["service_min"] . "\">\r\n                  </div>\r\n\r\n                  <div class=\"col-md-6 form-group\">\r\n                    <label class=\"form-group__service-name\">Maksimum sipariş</label>\r\n                    <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $serviceInfo["service_max"] . "\">\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div id=\"limited\">\r\n                <div class=\"form-group\">\r\n                  <label class=\"form-group__service-name\">Servis fiyatı</label>\r\n                  <input type=\"text\" class=\"form-control\" name=\"limited_price\" value=\"" . $serviceInfo["service_price"] . "\">\r\n                </div>\r\n\r\n\r\n\r\n                <div class=\"row\">\r\n                  <div class=\"col-md-6 form-group\">\r\n                    <label class=\"form-group__service-name\">Gönderi miktarı</label>\r\n                    <input type=\"text\" class=\"form-control\" name=\"autopost\" value=\"" . $serviceInfo["service_autopost"] . "\">\r\n                  </div>\r\n\r\n                  <div class=\"col-md-6 form-group\">\r\n                    <label class=\"form-group__service-name\">Sipariş miktarı</label>\r\n                    <input type=\"text\" class=\"form-control\" name=\"limited_min\" value=\"" . $serviceInfo["service_min"] . "\">\r\n                  </div>\r\n                </div>\r\n                <div class=\"form-group\">\r\n                  <label class=\"form-group__service-name\">Paket Süresi <small>(gün)</small></label>\r\n                  <input type=\"text\" class=\"form-control\" name=\"autotime\" value=\"" . $serviceInfo["service_autotime"] . "\">\r\n                </div>\r\n              </div>\r\n\r\n              <hr>\r\n\r\n              <div class=\"service-mode__block\">\r\n                <div class=\"form-group\">\r\n                <label>Kişiye Özel Servis (Sadece seçtiğiniz kişiler görebilir.)</label>\r\n                  <select class=\"form-control\" name=\"secret\">\r\n                      <option value=\"2\"";
                                                        if ($serviceInfo["service_secret"] == 2) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Hayır</option>\r\n                      <option value=\"1\"";
                                                        if ($serviceInfo["service_secret"] == 1) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Evet</option>\r\n                  </select>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"service-mode__block\">\r\n                <div class=\"form-group\">\r\n                <label>Servis Hızı (Servis listesinde sembol ve renk olarak gösterilir.)</label>\r\n                  <select class=\"form-control\" name=\"speed\">\r\n                      <option value=\"1\"";
                                                        if ($serviceInfo["service_speed"] == 1) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Yavaş</option>\r\n                      <option value=\"2\"";
                                                        if ($serviceInfo["service_speed"] == 2) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Bazen Yavaş</option>\r\n                      <option value=\"3\"";
                                                        if ($serviceInfo["service_speed"] == 3) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Normal</option>\r\n                      <option value=\"4\"";
                                                        if ($serviceInfo["service_speed"] == 4) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Hızlı</option>\r\n                  </select>\r\n                </div>\r\n              </div>\r\n\r\n            </div>\r\n\r\n              <div class=\"modal-footer\">\r\n                <button type=\"submit\" class=\"btn btn-primary\">Abonelik bilgilerini güncelle</button>\r\n                <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n              </div>\r\n              </form>\r\n              <script type=\"text/javascript\">\r\n\r\n              var type = \$(\"#refill\").val();\r\n\r\n              if( type == 1 ){\r\n    \r\n                \$(\"#refill_day\").hide();\r\n    \r\n              } else{\r\n    \r\n                \$(\"#refill_day\").show();\r\n    \r\n              }\r\n    \r\n              \$(\"#refill\").change(function(){\r\n    \r\n                var type = \$(this).val();\r\n    \r\n                  if( type == 1 ){\r\n    \r\n                    \$(\"#refill_day\").hide();\r\n    \r\n                  } else{\r\n    \r\n                    \$(\"#refill_day\").show();\r\n    \r\n                  }\r\n    \r\n              });\r\n\r\n              \$(\".other_services\").click(function(){\r\n                var control = \$(\"#translationsList\");\r\n                if( control.attr(\"class\") == \"hidden\" ){\r\n                  control.removeClass(\"hidden\");\r\n                } else{\r\n                  control.addClass(\"hidden\");\r\n                }\r\n              });\r\n              var base_url  = \$(\"head base\").attr(\"href\");\r\n                \$(\"#provider\").change(function(){\r\n                  var provider = \$(this).val();\r\n                  getProviderServices(provider,base_url);\r\n                });\r\n\r\n                getProvider();\r\n                \$(\"#serviceMode\").change(function(){\r\n                  getProvider();\r\n                });\r\n\r\n                getSalePrice();\r\n                \$(\"#saleprice_cal\").change(function(){\r\n                  getSalePrice();\r\n                });\r\n\r\n                getSubscription();\r\n                \$(\"#subscription_package\").change(function(){\r\n                  getSubscription();\r\n                });\r\n                function getProviderServices(provider,base_url){\r\n                  if( provider == 0 ){\r\n                    \$(\"#provider_service\").hide();\r\n                  }else{\r\n                    \$.post(base_url+\"/admin/ajax_data\",{action:\"providers_list\",provider:provider}).done(function( data ) {\r\n                      \$(\"#provider_service\").show();\r\n                      \$(\"#provider_service\").html(data);\r\n                    }).fail(function(){\r\n                      alert(\"Hata oluştu!\");\r\n                    });\r\n                  }\r\n                }\r\n\r\n                function getProvider(){\r\n                  var mode = \$(\"#serviceMode\").val();\r\n                    if( mode == 1 ){\r\n                      \$(\"#autoMode\").hide();\r\n                    }else{\r\n                      \$(\"#autoMode\").show();\r\n                    }\r\n                }\r\n\r\n                function getSalePrice(){\r\n                  var type = \$(\"#saleprice_cal\").val();\r\n                    if( type == \"normal\" ){\r\n                      \$(\"#saleprice\").hide();\r\n                      \$(\"#servicePrice\").show();\r\n                    }else{\r\n                      \$(\"#saleprice\").show();\r\n                      \$(\"#servicePrice\").hide();\r\n                    }\r\n                }\r\n\r\n                function getSubscription(){\r\n                  var type = \$(\"#subscription_package\").val();\r\n                    if( type == \"11\" || type == \"12\" ){\r\n                      \$(\"#unlimited\").show();\r\n                      \$(\"#limited\").hide();\r\n                    }else{\r\n                      \$(\"#unlimited\").hide();\r\n                      \$(\"#limited\").show();\r\n                    }\r\n                }\r\n              </script>\r\n              ";
                                                        echo json_encode(["content" => $return, "title" => "Abonelik düzenle (ID: " . $serviceInfo["service_id"] . ")"]);
                                                    } else {
                                                        $return = "\r\n\r\n        <form class=\"form\" action=\"" . base_url("admin/services/edit-service/" . $serviceInfo["service_id"]) . "\" method=\"post\" data-xhr=\"true\">\r\n            <div class=\"modal-body\">";
                                                        if (1 < count($languages)) {
                                                            $translationList = "<a class=\"other_services\"> Çeviriler (" . (count($languages) - 1) . ") </a>";
                                                        } else {
                                                            $translationList = "";
                                                        }
                                                        foreach ($languages as $language) {
                                                            if ($language["default_language"]) {
                                                                $return .= "\r\n\t\t\t\t  <div class=\"form-group\">\r\n                    <label class=\"form-group__service-name\">Servis adı <span class=\"badge\">" . $language["language_name"] . "</span> " . $translationList . " </label>\r\n                    <input type=\"text\" class=\"form-control\" name=\"name[" . $language["language_code"] . "]\" value=\"" . $multiName[$language["language_code"]] . "\">\r\n                  </div>";
                                                                if (1 < count($languages)) {
                                                                    $return .= "<div class=\"hidden\" id=\"translationsList\">";
                                                                }
                                                            } else {
                                                                $return .= "<div class=\"form-group\">\r\n                    <label class=\"form-group__service-name\">Servis adı <span class=\"badge\">" . $language["language_name"] . "</span> </label>\r\n                    <input type=\"text\" class=\"form-control\" name=\"name[" . $language["language_code"] . "]\" value=\"" . $multiName[$language["language_code"]] . "\">\r\n                  </div>";
                                                            }
                                                        }
                                                        if (1 < count($languages)) {
                                                            $return .= "</div>";
                                                        }
                                                        $return .= "<div class=\"service-mode__block\">\r\n                <div class=\"form-group\">\r\n                <label>Servis Kategori</label>\r\n                  <select class=\"form-control\" name=\"category\">\r\n                        <option value=\"0\">Lütfen kategori seçin..</option>";
                                                        foreach ($categories as $category) {
                                                            $return .= "<option value=\"" . $category["category_id"] . "\"";
                                                            if ($serviceInfo["category_id"] == $category["category_id"]) {
                                                                $return .= "selected";
                                                            }
                                                            $return .= ">" . $category["category_name"] . "</option>";
                                                        }
                                                        $return .= "</select>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"service-mode__wrapper\">\r\n                <div class=\"service-mode__block\">\r\n                  <div class=\"form-group\">\r\n                  <label>Servis Tipi</label>\r\n                    <select class=\"form-control\" name=\"package\">\r\n                          <option value=\"1\"";
                                                        if ($serviceInfo["service_package"] == 1) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Servis</option>\r\n                          <option value=\"2\"";
                                                        if ($serviceInfo["service_package"] == 2) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Paket</option>\r\n                          <option value=\"3\"";
                                                        if ($serviceInfo["service_package"] == 3) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Özel Yorum</option>\r\n                          <option value=\"4\"";
                                                        if ($serviceInfo["service_package"] == 4) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Paket Yorum</option>\r\n                      </select>\r\n                  </div>\r\n                </div>\r\n                <div class=\"service-mode__block\">\r\n                  <div class=\"form-group\">\r\n                  <label>Mod</label>\r\n                    <select class=\"form-control\" name=\"mode\" id=\"serviceMode\">\r\n                          <option value=\"1\"";
                                                        if ($serviceInfo["service_api"] == 0) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Manuel</option>\r\n                          <option value=\"2\"";
                                                        if ($serviceInfo["service_api"] != 0) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Otomatik (API)</option>\r\n                      </select>\r\n                  </div>\r\n                </div>\r\n\r\n                <div id=\"autoMode\" style=\"display: none\">\r\n                  <div class=\"service-mode__block\">\r\n                    <div class=\"form-group\">\r\n                    <label>Servis Sağlayıcısı</label>\r\n                      <select class=\"form-control\" name=\"provider\" id=\"provider\">\r\n                            <option value=\"0\">Servis sağlayıcı seçiniz...</option>";
                                                        foreach ($providers as $provider) {
                                                            $return .= "<option value=\"" . $provider["id"] . "\"";
                                                            if ($serviceInfo["service_api"] == $provider["id"]) {
                                                                $return .= "selected";
                                                            }
                                                            $return .= ">" . $provider["api_name"] . "</option>";
                                                        }
                                                        $return .= "</select>\r\n                    </div>\r\n                  </div>\r\n                  <div id=\"provider_service\">";
                                                        $services = $smmapi->action(["key" => $serviceInfo["api_key"], "action" => "services"], $serviceInfo["api_url"]);
                                                        if ($serviceInfo["api_type"] == 1) {
                                                            $return .= "<div class=\"service-mode__block\">\r\n                        <div class=\"form-group\">\r\n                        <label>Servis</label>\r\n                          <select class=\"form-control\" name=\"service\">";
                                                            foreach ($services as $service) {
                                                                $return .= "<option value=\"" . $service->service . "\"";
                                                                if ($serviceInfo["api_service"] == $service->service) {
                                                                    $return .= "selected";
                                                                }
                                                                $return .= ">" . $service->service . " - " . $service->name . " - " . $service->rate . "</option>";
                                                            }
                                                            $return .= "</select>\r\n                        </div>\r\n                      </div>";
                                                        } else {
                                                            if ($serviceInfo["api_type"] == 3) {
                                                                $return .= "<div class=\"service-mode__block\">\r\n                        <div class=\"form-group\">\r\n                        <label>Servis</label>\r\n                          <input class=\"form-control\" value=\"" . $serviceInfo["api_service"] . "\" name=\"service\">\r\n                        </div>\r\n                      </div>";
                                                            }
                                                        }
                                                        $return .= "</div>\r\n                  <div class=\"service-mode__block\">\r\n                    <div class=\"form-group\">\r\n                    <label>Dripfeed</label>\r\n                      <select class=\"form-control\" name=\"dripfeed\">\r\n                        <option value=\"1\"";
                                                        if ($serviceInfo["service_dripfeed"] == 1) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Pasif</option>\r\n                        <option value=\"2\"";
                                                        if ($serviceInfo["service_dripfeed"] == 2) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Aktif</option>\r\n                      </select>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n";
                                                        if ($serviceInfo["service_api"] == 0) {
                                                            $return .= "\r\n    \r\n    \r\n                <div class=\"form-group\">\r\n                  <label class=\"form-group__service-name\">Servis fiyatı (1000 adet)</label>\r\n                  <input type=\"text\" class=\"form-control\" name=\"price\" value=\"" . $serviceInfo["service_price"] . "\">\r\n                </div>\r\n\r\n                <div class=\"row\">\r\n                  <div class=\"col-md-6 form-group\">\r\n                    <label class=\"form-group__service-name\">Minimum sipariş</label>\r\n                    <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $serviceInfo["service_min"] . "\">\r\n                  </div>\r\n\r\n                  <div class=\"col-md-6 form-group\">\r\n                    <label class=\"form-group__service-name\">Maksimum sipariş</label>\r\n                    <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $serviceInfo["service_max"] . "\">\r\n                  </div>\r\n                </div>\r\n          \r\n\r\n    \r\n    \r\n    ";
                                                        } else {
                                                            $return .= "\r\n    \r\n    \r\n       <div class=\"form-group\">\r\n                                        <label class=\"form-group__service-name\" >";
                                                            if ($serviceInfo["sync_price"] == 1) {
                                                                $return .= "% Kaç arttırılsın?";
                                                            } else {
                                                                $return .= "1000 Adet Ücreti";
                                                            }
                                                            $return .= "</label>\r\n\r\n                  <div class=\"form-group\">\r\n                        <div class=\"input-group\">\r\n                            <input type=\"text\" ";
                                                            if ($serviceInfo["sync_price"] == 1) {
                                                                $return .= "style=\"display:none\"";
                                                            }
                                                            $return .= " class=\"form-control\" id=\"priceInput\" name=\"price\" value=\"" . $serviceInfo["service_price"] . "\">\r\n                            <div id=\"priceThreeInput\" ";
                                                            if ($serviceInfo["sync_price"] == 0) {
                                                                $return .= "style=\"display:none\"";
                                                            }
                                                            $return .= ">\r\n                            <div class=\"col-md-6\">\r\n                             <input type=\"text\" class=\"form-control\" style=\"border-radius:5px;\" id=\"priceInput\" name=\"sync_rate\" value=\"" . $serviceInfo["sync_rate"] . "\">\r\n                             </div>\r\n                             <div class=\"col-md-6\">\r\n                             \r\n                             <div class = \"input-group\">\r\n                            \t <span class = \"input-group-addon\">" . $settings["site_currency"] . "</span>\r\n                             \t<input type = \"text\" value=\"" . $serviceInfo["service_price"] . "\" readonly class =\" form-control\" placeholder=\"MajerPanel\">\r\n                             \r\n                     \t        <span class = \"input-group-addon\">";
                                                            foreach ($services as $service) {
                                                                if ($serviceInfo["api_service"] == $service->service) {
                                                                    $return .= $service->rate;
                                                                }
                                                            }
                                                            $return .= "</span>\r\n                     \t    \r\n                     \t  </div>\r\n                     \t  \r\n                     \t  \r\n                                <input type=\"hidden\" name=\"price_api\" value=\"";
                                                            foreach ($services as $service) {
                                                                if ($serviceInfo["api_service"] == $service->service) {
                                                                    $return .= $service->rate;
                                                                }
                                                            }
                                                            $return .= "\">\r\n                                \r\n                             </div>\r\n\r\n                         </div>\r\n\r\n                            <div class=\"input-group-addon\">\r\n                            <label class=\"switch\"><input  id=\"priceCheckbox\"  type=\"checkbox\" name=\"auto_price\" ";
                                                            if ($serviceInfo["sync_price"] == 1) {
                                                                $return .= "checked";
                                                            }
                                                            $return .= "/>\r\n                            <span class=\"slider round\"></span>\r\n                        </label>\r\n                         \r\n                     </div>\r\n                    </div>\r\n                    </div>\r\n                    \r\n              </div>\r\n\r\n              <div class=\"row\">\r\n                <div class=\"col-md-6 form-group\">\r\n                  <label class=\"form-group__service-name\">Minimum Sipariş</label>\r\n                \r\n                <div id=\"minText\" style=\"padding: 11px;margin-left: 4px;\" class=\"form-group__provider-value\">";
                                                            foreach ($services as $service) {
                                                                if ($serviceInfo["api_service"] == $service->service) {
                                                                    $return .= $service->min;
                                                                }
                                                            }
                                                            $return .= "</div>\r\n                \r\n                     <div class=\"form-group\">\r\n                        <div class=\"input-group\">\r\n                            <input type=\"number\" id=\"minPriceInput\" style=\"height:43px;\" class=\"form-control\" name=\"min\" value=\"" . $serviceInfo["service_min"] . "\" ";
                                                            if ($serviceInfo["sync_min"] == 1) {
                                                                $return .= "readonly";
                                                            }
                                                            $return .= ">\r\n                            <div class=\"input-group-addon\" >\r\n                            <label class=\"switch\"><input  id=\"minPriceCheckbox\"  type=\"checkbox\" name=\"auto_min\" ";
                                                            if ($serviceInfo["sync_min"] == 1) {
                                                                $return .= "checked";
                                                            }
                                                            $return .= " />\r\n                            <span  class=\"slider round\"></span>\r\n                        </label>\r\n                     </div>\r\n                    </div>\r\n                    </div>\r\n                  </div>\r\n\r\n          \r\n                    \r\n                <div class=\"col-md-6 form-group\">\r\n                  <label class=\"form-group__service-name\">Maksimum Sipariş</label>\r\n                  \r\n                  <div id=\"maxText\" style=\"padding: 11px;margin-left: 4px;\" class=\"form-group__provider-value\">";
                                                            foreach ($services as $service) {
                                                                if ($serviceInfo["api_service"] == $service->service) {
                                                                    $return .= $service->max;
                                                                }
                                                            }
                                                            $return .= "</div>\r\n                \r\n                    <div class=\"form-group\">\r\n                        <div class=\"input-group\">\r\n                            <input type=\"number\" id=\"maxPriceInput\" style=\"height:43px;\" class=\"form-control\" name=\"max\" value=\"" . $serviceInfo["service_max"] . "\" ";
                                                            if ($serviceInfo["sync_max"] == 1) {
                                                                $return .= "readonly";
                                                            }
                                                            $return .= ">\r\n                            <div class=\"input-group-addon\" >\r\n                            <label class=\"switch\"><input id=\"maxPriceCheckbox\"  type=\"checkbox\" name=\"auto_max\" ";
                                                            if ($serviceInfo["sync_max"] == 1) {
                                                                $return .= "checked";
                                                            }
                                                            $return .= "/>\r\n                            <span   class=\"slider round\"></span>\r\n                        </label>\r\n                    </div>\r\n                </div>\r\n              </div>\r\n              </div>\r\n              </div>\r\n\r\n    \r\n    \r\n    \r\n    ";
                                                        }
                                                        $return .= "\r\n    \r\n<hr>\r\n\r\n<div class=\"row\">\r\n<div class=\"form-group col-md-6\">\r\n<label>İptal butonu</label>\r\n  <select class=\"form-control\" name=\"cancel_type\">\r\n      <option value=\"2\"";
                                                        if ($serviceInfo["cancel_type"] == 2) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Aktif</option>\r\n      <option value=\"1\"";
                                                        if ($serviceInfo["cancel_type"] == 1) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Pasif</option>\r\n  </select>\r\n</div>\r\n\r\n\r\n<div class=\"form-group col-md-6\">\r\n<label>Refill Butonu</label>\r\n  <select class=\"form-control\" id=\"refill\" name=\"refill_type\">\r\n      <option value=\"2\"";
                                                        if ($serviceInfo["refill_type"] == 2) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Aktif</option>\r\n      <option value=\"1\"";
                                                        if ($serviceInfo["refill_type"] == 1) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Pasif</option>\r\n  </select>\r\n</div>\r\n</div>\r\n\r\n<div id=\"refill_day\" class=\"form-group\">\r\n<label>Refill Maksimum Gün <small>(Lifetime ise 0 yazınız)</small></label>\r\n  <input type=\"number\" class=\"form-control\" name=\"refill_time\" value=\"" . $serviceInfo["refill_time"] . "\">\r\n</div>\r\n\r\n\r\n              <hr>\r\n\r\n              <div class=\"service-mode__block\">\r\n                <div class=\"form-group\">\r\n                <label>Sipariş Bağlantı <small>(Yeni sipariş sayfasında gösterilir)</small></label>\r\n                  <select class=\"form-control\" name=\"want_username\">\r\n                      <option value=\"1\"";
                                                        if ($serviceInfo["want_username"] == 1) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Link</option>\r\n                      <option value=\"2\"";
                                                        if ($serviceInfo["want_username"] == 2) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Kullanıcı adı</option>\r\n                  </select>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"service-mode__block\">\r\n                <div class=\"form-group\">\r\n                <label>Kişiye Özel Servis <small>(Sadece seçtiğiniz kişiler görebilir)</small></label>\r\n                  <select class=\"form-control\" name=\"secret\">\r\n                      <option value=\"2\"";
                                                        if ($serviceInfo["service_secret"] == 2) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Hayır</option>\r\n                      <option value=\"1\"";
                                                        if ($serviceInfo["service_secret"] == 1) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Evet</option>\r\n                  </select>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"service-mode__block\">\r\n                <div class=\"form-group\">\r\n                <label>Servis Hızı <small>(Servis listesinde sembol ve renk olarak gösterilir)</small></label>\r\n                  <select class=\"form-control\" name=\"speed\">\r\n                      <option value=\"1\"";
                                                        if ($serviceInfo["service_speed"] == 1) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Yavaş</option>\r\n                      <option value=\"2\"";
                                                        if ($serviceInfo["service_speed"] == 2) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Bazen Yavaş</option>\r\n                      <option value=\"3\"";
                                                        if ($serviceInfo["service_speed"] == 3) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Normal</option>\r\n                      <option value=\"4\"";
                                                        if ($serviceInfo["service_speed"] == 4) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">Hızlı</option>\r\n                  </select>\r\n                </div>\r\n              </div>\r\n\r\n            </div>\r\n\r\n              <div class=\"modal-footer\">\r\n                <button type=\"submit\" class=\"btn btn-primary\">Servis bilgilerini güncelle</button>\r\n                <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n              </div>\r\n              </form>\r\n              <script type=\"text/javascript\">\r\n\r\n              var type = \$(\"#refill\").val();\r\n\r\n              if( type == 1 ){\r\n    \r\n                \$(\"#refill_day\").hide();\r\n    \r\n              } else{\r\n    \r\n                \$(\"#refill_day\").show();\r\n    \r\n              }\r\n    \r\n              \$(\"#refill\").change(function(){\r\n    \r\n                var type = \$(this).val();\r\n    \r\n                  if( type == 1 ){\r\n    \r\n                    \$(\"#refill_day\").hide();\r\n    \r\n                  } else{\r\n    \r\n                    \$(\"#refill_day\").show();\r\n    \r\n                  }\r\n    \r\n              });\r\n       \r\n              /* minprice checkbox eventıdır tıklandığı zaman minpriceinputunun readonly yapıyor check edildiği zaman edilmediği zaman ise input açık kalıyor */\r\n               \$(\"#minPriceCheckbox\").click(function(){\r\n                    var minPriceInput = \$(\"#minPriceInput\");  \r\n                    var minText = \$(\"#minText\");\r\n                   if(!this.checked){\r\n                    minPriceInput.removeAttr(\"readonly\",\"readonly\");\r\n                   }else{\r\n                    minPriceInput.attr(\"readonly\",\"readonly\");\r\n                    minPriceInput.val(minText.text());\r\n                   }\r\n                });\r\n       \r\n       \r\n              /* maxprice checkbox eventıdır tıklandığı zaman minpriceinputunun readonly yapıyor check edildiği zaman edilmediği zaman ise input açık kalıyor */\r\n               \$(\"#maxPriceCheckbox\").click(function(){\r\n                    var maxPriceInput = \$(\"#maxPriceInput\");  \r\n                    var maxText = \$(\"#maxText\");\r\n                   if(!this.checked){\r\n                    maxPriceInput.removeAttr(\"readonly\",\"readonly\");\r\n                   }else{\r\n                    maxPriceInput.attr(\"readonly\",\"readonly\");\r\n                    maxPriceInput.val(maxText.text());\r\n                   }\r\n                });\r\n\r\n       \r\n              /* maxprice checkbox eventıdır tıklandığı zaman minpriceinputunun readonly yapıyor check edildiği zaman edilmediği zaman ise input açık kalıyor */\r\n               \$(\"#priceCheckbox\").click(function(){\r\n                    var priceInput = \$(\"#priceInput\");  \r\n                    var priceThree = \$(\"#priceThreeInput\");\r\n                   if(this.checked){\r\n                        priceInput.css(\"display\",\"none\");\r\n                        priceThree.css(\"display\",\"block\");\r\n                   }else{\r\n                        priceThree.css(\"display\",\"none\");\r\n                        priceInput.css(\"display\",\"block\");\r\n                   }\r\n                });\r\n                \r\n               \$(\".other_services\").click(function(){\r\n                 var control = \$(\"#translationsList\");\r\n                 if( control.attr(\"class\") == \"hidden\" ){\r\n                   control.removeClass(\"hidden\");\r\n                 } else{\r\n                   control.addClass(\"hidden\");\r\n                 }\r\n               });\r\n              var base_url  = \$(\"head base\").attr(\"href\");\r\n                \$(\"#provider\").change(function(){\r\n                  var provider = \$(this).val();\r\n                  getProviderServices(provider,base_url);\r\n                });\r\n\r\n                getProvider();\r\n                \$(\"#serviceMode\").change(function(){\r\n                  getProvider();\r\n                });\r\n\r\n                getSalePrice();\r\n                \$(\"#saleprice_cal\").change(function(){\r\n                  getSalePrice();\r\n                });\r\n\r\n                getSubscription();\r\n                \$(\"#subscription_package\").change(function(){\r\n                  getSubscription();\r\n                });\r\n                function getProviderServices(provider,base_url){\r\n                  if( provider == 0 ){\r\n                    \$(\"#provider_service\").hide();\r\n                  }else{\r\n                    \$.post(base_url+\"/admin/ajax_data\",{action:\"providers_list\",provider:provider}).done(function( data ) {\r\n                      \$(\"#provider_service\").show();\r\n                      \$(\"#provider_service\").html(data);\r\n                    }).fail(function(){\r\n                      alert(\"Hata oluştu!\");\r\n                    });\r\n                  }\r\n                }\r\n\r\n                function getProvider(){\r\n                  var mode = \$(\"#serviceMode\").val();\r\n                    if( mode == 1 ){\r\n                      \$(\"#autoMode\").hide();\r\n                    }else{\r\n                      \$(\"#autoMode\").show();\r\n                    }\r\n                }\r\n\r\n                function getSalePrice(){\r\n                  var type = \$(\"#saleprice_cal\").val();\r\n                    if( type == \"normal\" ){\r\n                      \$(\"#saleprice\").hide();\r\n                      \$(\"#servicePrice\").show();\r\n                    }else{\r\n                      \$(\"#saleprice\").show();\r\n                      \$(\"#servicePrice\").hide();\r\n                    }\r\n                }\r\n\r\n                function getSubscription(){\r\n                  var type = \$(\"#subscription_package\").val();\r\n                    if( type == \"11\" || type == \"12\" ){\r\n                      \$(\"#unlimited\").show();\r\n                      \$(\"#limited\").hide();\r\n                    }else{\r\n                      \$(\"#unlimited\").hide();\r\n                      \$(\"#limited\").show();\r\n                    }\r\n                }\r\n              </script>\r\n              ";
                                                        echo json_encode(["content" => $return, "title" => "Servis düzenle (ID: " . $serviceInfo["service_id"] . ")"]);
                                                    }
                                                } else {
                                                    if ($action == "edit_description") {
                                                        $id = $_POST["id"];
                                                        $smmapi = new SMMApi();
                                                        $serviceInfo = $conn->prepare("SELECT * FROM services WHERE service_id=:id ");
                                                        $serviceInfo->execute(["id" => $id]);
                                                        $serviceInfo = $serviceInfo->fetch(PDO::FETCH_ASSOC);
                                                        $multiDesc = json_decode($serviceInfo["description_lang"], true);
                                                        $return = "<form class=\"form\" action=\"" . base_url("admin/services/edit-description/" . $serviceInfo["service_id"]) . "\" method=\"post\" data-xhr=\"true\">\r\n            <div class=\"modal-body\">";
                                                        if (1 < count($languages)) {
                                                            $translationList = "<a class=\"other_services\"> Çeviriler (" . (count($languages) - 1) . ") </a>";
                                                        } else {
                                                            $translationList = "";
                                                        }
                                                        foreach ($languages as $language) {
                                                            if ($language["default_language"]) {
                                                                $return .= "<div class=\"form-group\">\r\n                    <label class=\"form-group__service-name\">Açıklama <span class=\"badge\">" . $language["language_name"] . "</span> " . $translationList . " </label>\r\n                    <textarea class=\"form-control\" rows=\"5\" name=\"description[" . $language["language_code"] . "]\">" . $multiDesc[$language["language_code"]] . "</textarea>\r\n                  </div>";
                                                                if (1 < count($languages)) {
                                                                    $return .= "<div class=\"hidden\" id=\"translationsList\">";
                                                                }
                                                            } else {
                                                                $return .= "<div class=\"form-group\">\r\n                    <label class=\"form-group__service-name\">Açıklama <span class=\"badge\">" . $language["language_name"] . "</span> </label>\r\n                    <textarea class=\"form-control\" rows=\"5\"  name=\"description[" . $language["language_code"] . "]\">" . $multiDesc[$language["language_code"]] . "</textarea>\r\n                  </div>";
                                                            }
                                                        }
                                                        if (1 < count($languages)) {
                                                            $return .= "</div>";
                                                        }
                                                        $return .= "\r\n\r\n            </div>\r\n\r\n              <div class=\"modal-footer\">\r\n                <button type=\"submit\" class=\"btn btn-primary\">Açıklamayı güncelle</button>\r\n                <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n              </div>\r\n              </form>\r\n              <script type=\"text/javascript\">\r\n\r\n              \$(\".other_services\").click(function(){\r\n                var control = \$(\"#translationsList\");\r\n                if( control.attr(\"class\") == \"hidden\" ){\r\n                  control.removeClass(\"hidden\");\r\n                } else{\r\n                  control.addClass(\"hidden\");\r\n                }\r\n              });\r\n\r\n              </script>\r\n              ";
                                                        echo json_encode(["content" => $return, "title" => "Açıklama düzenle (ID: " . $serviceInfo["service_id"] . ")"]);
                                                    } else {
                                                        if ($action == "new_subscriptions") {
                                                            $categories = $conn->prepare("SELECT * FROM categories ORDER BY category_line ");
                                                            $categories->execute([]);
                                                            $categories = $categories->fetchAll(PDO::FETCH_ASSOC);
                                                            $providers = $conn->prepare("SELECT * FROM service_api");
                                                            $providers->execute([]);
                                                            $providers = $providers->fetchAll(PDO::FETCH_ASSOC);
                                                            $return = "<form class=\"form\" action=\"" . base_url("admin/services/new-subscription") . "\" method=\"post\" data-xhr=\"true\">\r\n        <div class=\"modal-body\">";
                                                            if (1 < count($languages)) {
                                                                $translationList = "<a class=\"other_services\"> Çeviriler (" . (count($languages) - 1) . ") </a>";
                                                            } else {
                                                                $translationList = "";
                                                            }
                                                            foreach ($languages as $language) {
                                                                if ($language["default_language"]) {
                                                                    $return .= "<div class=\"form-group\">\r\n              <label class=\"form-group__service-name\">Servis adı <span class=\"badge\">" . $language["language_name"] . "</span> " . $translationList . " </label>\r\n              <input type=\"text\" class=\"form-control\" name=\"name[" . $language["language_code"] . "]\" value=\"" . $language["language_code"] . "\">\r\n            </div>";
                                                                    if (1 < count($languages)) {
                                                                        $return .= "<div class=\"hidden\" id=\"translationsList\">";
                                                                    }
                                                                } else {
                                                                    $return .= "<div class=\"form-group\">\r\n              <label class=\"form-group__service-name\">Servis adı <span class=\"badge\">" . $language["language_name"] . "</span> </label>\r\n              <input type=\"text\" class=\"form-control\" name=\"name[" . $language["language_code"] . "]\" value=\"" . $language["language_code"] . "\">\r\n            </div>";
                                                                }
                                                            }
                                                            if (1 < count($languages)) {
                                                                $return .= "</div>";
                                                            }
                                                            $return .= "<div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Servis Kategori</label>\r\n              <select class=\"form-control\" name=\"category\">\r\n                    <option value=\"0\">Lütfen kategori seçin..</option>";
                                                            foreach ($categories as $category) {
                                                                $return .= "<option value=\"" . $category["category_id"] . "\">" . $category["category_name"] . "</option>";
                                                            }
                                                            $return .= "</select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Abonelik Tipi</label>\r\n              <select class=\"form-control\" name=\"package\" id=\"subscription_package\">\r\n                    <option value=\"11\">Instagram Otomatik Beğeni - Sınırsız</option>\r\n                    <option value=\"12\">Instagram Otomatik İzlenme - Sınırsız</option>\r\n                    <option value=\"11\">Instagram Otomatik Kaydetme - Sınırsız</option>\r\n                    <option value=\"11\">Instagram Otomatik Etkileşim - Sınırsız</option>\r\n                    <option value=\"14\">Instagram Otomatik Beğeni - Süreli</option>\r\n                    <option value=\"15\">Instagram Otomatik İzlenme - Süreli</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__wrapper\">\r\n\r\n            <div class=\"service-mode__block\">\r\n              <div class=\"form-group\">\r\n              <label>Mod</label>\r\n                <select class=\"form-control\" name=\"mode\" id=\"serviceMode\">\r\n                      <option value=\"2\">Otomatik (API)</option>\r\n                  </select>\r\n              </div>\r\n            </div>\r\n\r\n            <div id=\"autoMode\" style=\"display: none\">\r\n              <div class=\"service-mode__block\">\r\n                <div class=\"form-group\">\r\n                <label>Servis Sağlayıcısı</label>\r\n                  <select class=\"form-control\" name=\"provider\" id=\"provider\">\r\n                        <option value=\"0\">Servis sağlayıcı seçiniz...</option>";
                                                            foreach ($providers as $provider) {
                                                                $return .= "<option value=\"" . $provider["id"] . "\">" . $provider["api_name"] . "</option>";
                                                            }
                                                            $return .= "</select>\r\n                </div>\r\n              </div>\r\n              <div id=\"provider_service\">\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div id=\"unlimited\">\r\n            <div class=\"form-group\">\r\n              <label class=\"form-group__service-name\">Servis fiyatı (1000 adet)</label>\r\n              <input type=\"text\" class=\"form-control\" name=\"price\" value=\"\">\r\n            </div>\r\n\r\n            <div class=\"row\">\r\n              <div class=\"col-md-6 form-group\">\r\n                <label class=\"form-group__service-name\">Minimum sipariş</label>\r\n                <input type=\"text\" class=\"form-control\" name=\"min\" value=\"\">\r\n              </div>\r\n\r\n              <div class=\"col-md-6 form-group\">\r\n                <label class=\"form-group__service-name\">Maksimum sipariş</label>\r\n                <input type=\"text\" class=\"form-control\" name=\"max\" value=\"\">\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div id=\"limited\">\r\n            <div class=\"form-group\">\r\n              <label class=\"form-group__service-name\">Servis fiyatı</label>\r\n              <input type=\"text\" class=\"form-control\" name=\"limited_price\" value=\"\">\r\n            </div>\r\n\r\n\r\n\r\n            <div class=\"row\">\r\n              <div class=\"col-md-6 form-group\">\r\n                <label class=\"form-group__service-name\">Gönderi miktarı</label>\r\n                <input type=\"text\" class=\"form-control\" name=\"autopost\" value=\"\">\r\n              </div>\r\n\r\n              <div class=\"col-md-6 form-group\">\r\n                <label class=\"form-group__service-name\">Sipariş miktarı</label>\r\n                <input type=\"text\" class=\"form-control\" name=\"limited_min\" value=\"\">\r\n              </div>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label class=\"form-group__service-name\">Paket Süresi <small>(gün)</small></label>\r\n              <input type=\"text\" class=\"form-control\" name=\"autotime\" value=\"\">\r\n            </div>\r\n          </div>\r\n\r\n          <hr>\r\n\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Kişiye Özel Servis Servis (Sadece seçtiğiniz kişiler görebilir.)</label>\r\n              <select class=\"form-control\" name=\"secret\">\r\n                  <option value=\"2\">Hayır</option>\r\n                  <option value=\"1\">Evet</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Servis Hızı</label>\r\n              <select class=\"form-control\" name=\"speed\">\r\n                  <option value=\"1\">Yavaş</option>\r\n                  <option value=\"2\">Bazen Yavaş</option>\r\n                  <option value=\"3\">Normal</option>\r\n                  <option value=\"4\">Hızlı</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Yeni aboneliği ekle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>\r\n          <script type=\"text/javascript\">\r\n\r\n          \$(\".other_services\").click(function(){\r\n            var control = \$(\"#translationsList\");\r\n            if( control.attr(\"class\") == \"hidden\" ){\r\n              control.removeClass(\"hidden\");\r\n            } else{\r\n              control.addClass(\"hidden\");\r\n            }\r\n          });\r\n\r\n          var base_url  = \$(\"head base\").attr(\"href\");\r\n            \$(\"#provider\").change(function(){\r\n              var provider = \$(this).val();\r\n              getProviderServices(provider,base_url);\r\n            });\r\n\r\n            getProvider();\r\n            \$(\"#serviceMode\").change(function(){\r\n              getProvider();\r\n            });\r\n\r\n            getSalePrice();\r\n            \$(\"#saleprice_cal\").change(function(){\r\n              getSalePrice();\r\n            });\r\n\r\n            getSubscription();\r\n            \$(\"#subscription_package\").change(function(){\r\n              getSubscription();\r\n            });\r\n            function getProviderServices(provider,base_url){\r\n              if( provider == 0 ){\r\n                \$(\"#provider_service\").hide();\r\n              }else{\r\n                \$.post('" . base_url() . "'+\"/admin/ajax_data\",{action:\"providers_list\",provider:provider}).done(function( data ) {\r\n                  \$(\"#provider_service\").show();\r\n                  \$(\"#provider_service\").html(data);\r\n                }).fail(function(){\r\n                  alert(\"Hata oluştu!\");\r\n                });\r\n              }\r\n            }\r\n\r\n            function getProvider(){\r\n              var mode = \$(\"#serviceMode\").val();\r\n                if( mode == 1 ){\r\n                  \$(\"#autoMode\").hide();\r\n                }else{\r\n                  \$(\"#autoMode\").show();\r\n                }\r\n            }\r\n\r\n            function getSalePrice(){\r\n              var type = \$(\"#saleprice_cal\").val();\r\n                if( type == \"normal\" ){\r\n                  \$(\"#saleprice\").hide();\r\n                  \$(\"#servicePrice\").show();\r\n                }else{\r\n                  \$(\"#saleprice\").show();\r\n                  \$(\"#servicePrice\").hide();\r\n                }\r\n            }\r\n\r\n            function getSubscription(){\r\n              var type = \$(\"#subscription_package\").val();\r\n                if( type == \"11\" || type == \"12\" ){\r\n                  \$(\"#unlimited\").show();\r\n                  \$(\"#limited\").hide();\r\n                }else{\r\n                  \$(\"#unlimited\").hide();\r\n                  \$(\"#limited\").show();\r\n                }\r\n            }\r\n          </script>\r\n          ";
                                                            echo json_encode(["content" => $return, "title" => "Yeni abonelik ekle"]);
                                                        } else {
                                                            if ($action == "new_category") {
                                                                $return = "<form class=\"form\" action=\"" . base_url("admin/services/new-category") . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Kategori adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"\">\r\n          </div> <!--<div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Kategori İkon (fas fa-ad) </label>\r\n            <input type=\"text\" class=\"form-control\" name=\"icon\" value=\"\">\r\n          </div><div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Kategori İcon Rengi </label>\r\n            <input type=\"color\" class=\"form-control\" name=\"color\" value=\"\">\r\n          </div>\r\n\r\n     -->     <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Kişiye Özel Kategori (Sadece seçtiğiniz kişiler görebilir.)</label>\r\n              <select class=\"form-control\" name=\"secret\">\r\n                    <option value=\"2\">Hayır</option>\r\n                    <option value=\"1\">Evet</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Kategoriyi oluştur</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                echo json_encode(["content" => $return, "title" => "Yeni kategori oluştur"]);
                                                            } else {
                                                                if ($action == "edit_category") {
                                                                    $id = $_POST["id"];
                                                                    $category = $conn->prepare("SELECT * FROM categories WHERE category_id=:id ");
                                                                    $category->execute(["id" => $id]);
                                                                    $category = $category->fetch(PDO::FETCH_ASSOC);
                                                                    $return = "<form class=\"form\" action=\"" . base_url("admin/services/edit-category/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Kategori adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $category["category_name"] . "\">\r\n          </div><!-- <div class=\"form-group\">\r\n           <label class=\"form-group__service-name\">Kategori İkon (fas fa-ad) </label>\r\n            <input type=\"text\" class=\"form-control\" name=\"icon\" value=\"" . $category["icon"] . "\">\r\n          </div><div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Kategori İkon Rengi </label>\r\n            <input type=\"color\" class=\"form-control\" name=\"color\" value=\"" . $category["color"] . "\">\r\n          </div>\r\n \r\n    -->      <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Kişiye Özel Kategori (Sadece seçtiğiniz kişiler görebilir.)</label>\r\n              <select class=\"form-control\" name=\"secret\">\r\n                    <option value=\"2\"";
                                                                    if ($category["category_secret"] == 2) {
                                                                        $return .= "selected";
                                                                    }
                                                                    $return .= ">Hayır</option>\r\n                    <option value=\"1\"";
                                                                    if ($category["category_secret"] == 1) {
                                                                        $return .= "selected";
                                                                    }
                                                                    $return .= ">Evet</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Kategoriyi güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                    echo json_encode(["content" => $return, "title" => "Kategoriyi düzenle (ID: " . $id . ")"]);
                                                                } elseif ($action == "edit_category_price") {
                                                                    $id = $_POST["id"];
                                                                    $category = $conn->prepare("SELECT * FROM categories WHERE category_id=:id ");
                                                                    $category->execute(["id" => $id]);
                                                                    $category = $category->fetch(PDO::FETCH_ASSOC);
                                                                    $return = "<form class=\"form\" action=\"" . base_url("admin/services/edit-category-price/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Fiyat Yüzdesi</label>\r\n            <input type=\"text\" class=\"form-control\" onkeyup='kategori_fiyat_yuzde(this)' id='kategori_fiyat_name' name=\"name\" value=\"" . "0" . "\">\r\n          </div><div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Sabit Fiyat Eklemesi</label>\r\n            <input type=\"text\" onkeyup='kategori_fiyat_yuzde(this)' id='kategori_fiyat_kar' class=\"form-control\" name=\"sabit_kar\" value=\"" . "0" . "\">\r\n          </div>";
                                                                    $return .= " </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Kategoriyi güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                    echo json_encode(["content" => $return, "title" => "Kategoriyi Fiyat Düzenle (ID: " . $id . ")"]);
                                                                } elseif ($action == "edit_category_aciklama") {
                                                                    $id = $_POST["id"];
                                                                    $category = $conn->prepare("SELECT * FROM categories WHERE category_id=:id ");
                                                                    $category->execute(["id" => $id]);
                                                                    $category = $category->fetch(PDO::FETCH_ASSOC);
                                                                    $return = "<form class=\"form\" action=\"" . base_url("admin/services/edit-category-aciklama/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Açıklama</label>\r\n            <textarea type=\"text\" class=\"form-control\" id=\"tinymce$id\" name=\"name\"></textarea>\r\n          </div>";
                                                                    $return .= " </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Kategoriyi güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                    $return .= '
                                                                    <script src="/assets/css/admin/tinytoggle.min.css"></script>
                                                                    <script>
                                                                         tinymce.init({
                                                                                selector: "textarea#tinymce'.$id.'",
                                                                                plugins: "print preview powerpaste casechange importcss tinydrive searchreplace autolink autosave save directionality advcode visualblocks visualchars fullscreen image link media mediaembed template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists checklist wordcount tinymcespellchecker a11ychecker imagetools textpattern noneditable help formatpainter permanentpen pageembed charmap tinycomments mentions quickbars linkchecker emoticons advtable export code",
                                                                              menubar: "file edit view insert format tools table tc help",
                                                                              toolbar: "undo redo | code | bold italic underline strikethrough | fontselect fontsizeselect formatselect | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist checklist | forecolor backcolor casechange permanentpen formatpainter removeformat | charmap emoticons | fullscreen  preview save print | insertfile image media pageembed link codesample | a11ycheck ltr rtl | showcomments addcomment",
                                                                    
                                                                          });
                                                                    </script>
                                                                    ';
                                                                    echo json_encode(["content" => $return, "title" => "Kategoriyi Açıklama Düzenle (ID: " . $id . ")"]);
                                                                } elseif ($action == "edit_service_aciklama") {
                                                                    $id = $_POST["id"];
                                                                    $category = $conn->prepare("SELECT * FROM services WHERE service_id=:id ");
                                                                    $category->execute(["id" => $id]);
                                                                    $category = $category->fetch(PDO::FETCH_ASSOC);
                                                                    $return = "<form class=\"form\" action=\"" . base_url("admin/services/edit-service-aciklama/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Açıklama</label>\r\n            <textarea type=\"text\" class=\"form-control\" id=\"tinymce$id\" name=\"name\">" . $category['service_description'] . "</textarea>\r\n          </div>";
                                                                    $return .= " </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Kategoriyi güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                    $return .= '
                                                                    <script src="/assets/css/admin/tinytoggle.min.css"></script>
                                                                    <script>
                                                                         tinymce.init({
                                                                                selector: "textarea#tinymce'.$id.'",
                                                                                plugins: "print preview powerpaste casechange importcss tinydrive searchreplace autolink autosave save directionality advcode visualblocks visualchars fullscreen image link media mediaembed template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists checklist wordcount tinymcespellchecker a11ychecker imagetools textpattern noneditable help formatpainter permanentpen pageembed charmap tinycomments mentions quickbars linkchecker emoticons advtable export code",
                                                                              menubar: "file edit view insert format tools table tc help",
                                                                              toolbar: "undo redo | code | bold italic underline strikethrough | fontselect fontsizeselect formatselect | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist checklist | forecolor backcolor casechange permanentpen formatpainter removeformat | charmap emoticons | fullscreen  preview save print | insertfile image media pageembed link codesample | a11ycheck ltr rtl | showcomments addcomment",
                                                                    
                                                                          });
                                                                    </script>
                                                                    ';
                                                                    echo json_encode(["content" => $return, "title" => "Servis Açıklama Düzenle (ID: " . $id . ")"]);
                                                                } elseif ($action == "edit_service_baslik") {
                                                                    $id = $_POST["id"];
                                                                    $category = $conn->prepare("SELECT * FROM services WHERE service_id=:id ");
                                                                    $category->execute(["id" => $id]);
                                                                    $category = $category->fetch(PDO::FETCH_ASSOC);
                                                                    $return = "<form class=\"form\" action=\"" . base_url("admin/services/edit-service-baslik/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Servis Başlığı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $category['service_name'] . "\">\r\n          </div>";
                                                                    $return .= " </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Kategoriyi güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                    echo json_encode(["content" => $return, "title" => "Servis Başlığı Düzenle (ID: " . $id . ")"]);
                                                                } else {
                                                                    if ($action == "import_services") {
                                                                        $providers = $conn->prepare("SELECT * FROM service_api");
                                                                        $providers->execute([]);
                                                                        $providers = $providers->fetchAll(PDO::FETCH_ASSOC);
                                                                        $category = $conn->prepare("SELECT * FROM categories");
                                                                        $category->execute([]);
                                                                        $category = $category->fetchAll(PDO::FETCH_ASSOC);
                                                                        $return = "<form class=\"form\" action=\"" . base_url("admin/services/get_services_add/") . "\" method=\"post\" data-xhr=\"true\">\r\n    \r\n        <div class=\"modal-body\">\r\n\r\n          <div id=\"firstStep\">\r\n            <div class=\"service-mode__block\">\r\n              <div class=\"form-group\">\r\n              <label>Servis Sağlayıcısı</label>\r\n                <select class=\"form-control\" name=\"provider\" id=\"provider\">\r\n                      <option value=\"0\">Servis sağlayıcı seçiniz...</option>";
                                                                        foreach ($providers as $provider) {
                                                                            $return .= "<option value=\"" . $provider["id"] . "\">" . $provider["api_name"] . "</option>";
                                                                        }
                                                                        $return .= "</select>\r\n              </div>\r\n            </div>\r\n            <div class=\"service-mode__block\">\r\n              <div class=\"form-group\">\r\n              <label>Servislerin Ekleneceği  Kategoriyi Seçiniz</label>\r\n                <select class=\"form-control\" name=\"selector\" id=\"selector\">\r\n                      <option value=\"0\">Kategori seçiniz...</option>";
                                                                        foreach ($category as $cat) {
                                                                            $return .= "<option value=\"" . $cat["category_id"] . "\">" . $cat["category_name"] . "</option>";
                                                                        }
                                                                        $return .= "</select>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          \r\n          <div id=\"secondStep\">\r\n          </div>\r\n\r\n          <div id=\"thirdStep\">\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n            <button type=\"button\" class=\"btn btn-primary\" id=\"nextStep\" data-step=\"first\">Sonra ki adım</button>\r\n            <button type=\"submit\" class=\"btn btn-primary\" id=\"submitStep\">Servisleri ekle</button>\r\n          </div>\r\n\r\n        </form>\r\n           <script>\r\n            \$(\"#submitStep\").hide();\r\n            \$(\"#nextStep\").click(function(){\r\n              var now_step = \$(this).attr(\"data-step\");\r\n              var provider = \$(\"#provider\").val();\r\n              var category = \$(\"#selector\").val();\r\n              \$(\"#secondStep\").hide();\r\n                if( now_step == \"first\" ){\r\n                \r\n                  if( provider == 0 || category == 0  ){\r\n                    \$.toast({\r\n                        heading: \"Başarısız\",\r\n                        text: \"Lütfen boş alan bırakmayınız\",\r\n                        icon: \"error\",\r\n                        loader: true,\r\n                        loaderBg: \"#9EC600\"\r\n                    });\r\n                  }\r\n                  \r\n                  else{\r\n                    \$(\"#firstStep\").hide();\r\n                    \$(\"#secondStep\").show();\r\n                    \$.post(base_url+\"/admin/ajax_data\", {provider:provider,category:category,action:\"import_services_list\" }, function(data){\r\n                      \$(\"#secondStep\").html(data);\r\n                    });\r\n                    \$(\"#nextStep\").attr(\"data-step\",\"second\");\r\n                  }\r\n                }else if( now_step == \"second\" ){\r\n                    var array     = [];\r\n                       \$('[class^=\"selectServices-\"]').each(function () {\r\n                            var id    = \$(this).val();\r\n                            var check = \$(this).prop(\"checked\");\r\n                            var provider  =  \$(this).attr(\"data-provider\");\r\n                              if( check == true ){\r\n                                var params = {};\r\n                                params[\"id\"]            = id;\r\n                                params[\"category\"]      = \$(this).attr(\"data-category\");\r\n                                array.push(params);\r\n                              }\r\n                       });\r\n                       var count = array.length;\r\n                     if( count ){\r\n                       \$.post(base_url+\"/admin/ajax_data\", {provider:provider,action:\"import_services_last\",services:array }, function(data){\r\n                         \$(\"#thirdStep\").html(data);\r\n                       });\r\n                       \$(\"#nextStep\").hide();\r\n                       \$(\"#submitStep\").show();\r\n                     }else{\r\n                       \$(\"#nextStep\").attr(\"data-step\",\"second\");\r\n                       \$(\"#firstStep\").hide();\r\n                       \$(\"#secondStep\").show();\r\n                       \$(\"#nextStep\").show();\r\n                       \$(\"#submitStep\").hide();\r\n                       \$.toast({\r\n                           heading: \"Başarısız\",\r\n                           text: \"Lütfen eklemek istediğiniz en az 1 servisi seçin\",\r\n                           icon: \"error\",\r\n                           loader: true,\r\n                           loaderBg: \"#9EC600\"\r\n                       });\r\n                     }\r\n\r\n                }\r\n            });\r\n          </script>\r\n          ";
                                                                        echo json_encode(["content" => $return, "title" => "Sağlayıcıdaki servisleri çek"]);
                                                                    } else {
                                                                        if ($action == "import_services_list") {
                                                                            $provider_id = $_POST["provider"];
                                                                            $category_id2 = $_POST["category"];
                                                                            $smmapi = new SMMApi();
                                                                            $provider = $conn->prepare("SELECT * FROM service_api WHERE id=:id");
                                                                            $provider->execute(["id" => $provider_id]);
                                                                            $provider = $provider->fetch(PDO::FETCH_ASSOC);
                                                                            if ($provider["api_type"] == 1) {
                                                                                $services = $smmapi->action(["key" => $provider["api_key"], "action" => "services"], $provider["api_url"]);
                                                                                if ($services) {
                                                                                    $grouped = array_group_by($services, "category");
                                                                                    $category_id = 0;
                                                                                    echo "<div class=\"\">\r\n            <div class=\"majer\">\r\n                 <div>\r\n                    <div class=\"services-import__list-wrap\">\r\n                       <div class=\"services-import__scroll-wrap\">";
                                                                                    foreach ($grouped as $category) {
                                                                                        $category_id++;
                                                                                        echo "\r\n                          <span>\r\n                             <div class=\"services-import__category\">\r\n                                <div class=\"services-import__category-title\">\r\n                                  <label><input type=\"checkbox\" data-id=\"" . $category_id . "\" id=\"checkAll-" . $category_id . "\">" . $category[0]->category . "\r\n                                   \r\n                                  </label>\r\n                                    <input type=\"hidden\" name=\"category\" value=\"" . $category_id2 . "\">\r\n                                </div>\r\n                             </div>\r\n                             <div class=\"services-import__packages\">\r\n                                <ul>";
                                                                                        for ($i = 0; $i < count($category); $i++) {
                                                                                            echo "<li><label>\r\n                                  <input data-service=\"" . $category[$i]->name . "\" data-provider=\"" . $provider["id"] . "\"  data-category=\"" . $category_id . "\"  class=\"selectServices-" . $category_id . "\" type=\"checkbox\" value=\"" . $category[$i]->service . "\" name=\"services[]\">" . $category[$i]->service . " - " . $category[$i]->name . "<span class=\"services-import__packages-price\">" . priceFormat($category[$i]->rate) . "</span></label></li>";
                                                                                        }
                                                                                        echo "</ul>\r\n                             </div>\r\n                          </span>";
                                                                                    }
                                                                                    echo "\r\n                       </div>\r\n                    </div>\r\n                 </div>\r\n              </div>\r\n              <script>\r\n              \$('[id^=\"checkAll-\"]').click(function () {\r\n                var id = \$(this).attr(\"data-id\");\r\n                 if ( \$(this).prop(\"checked\") == true ) {\r\n                   \$(\".selectServices-\"+id).not(this).prop(\"checked\", true);\r\n                 }else{\r\n                   \$(\".selectServices-\"+id).not(this).prop(\"checked\", false);\r\n                 }\r\n               });\r\n              </script>\r\n              </div>";
                                                                                } else {
                                                                                    echo "Hata oluştu, lütfen daha sonra deneyin.";
                                                                                }
                                                                            }
                                                                        } else {
                                                                            if ($action == "import_services_last") {
                                                                                $provider_id = $_POST["provider"];
                                                                                $services = json_decode(json_encode($_POST["services"]));
                                                                                $smmapi = new SMMApi();
                                                                                $provider = $conn->prepare("SELECT * FROM service_api WHERE id=:id");
                                                                                $provider->execute(["id" => $provider_id]);
                                                                                $provider = $provider->fetch(PDO::FETCH_ASSOC);
                                                                                $apiServices = $smmapi->action(["key" => $provider["api_key"], "action" => "services"], $provider["api_url"]);
                                                                                $grouped = array_group_by($services, "category");
                                                                                echo "\r\n      <div class=\"majer\">\r\n             <div>\r\n                <div class=\"services-import__fields\">\r\n                   <div class=\"services-import__step3-field\">\r\n                      <div class=\"services-import__placeholder-title\">Sabit (1.00)</div>\r\n                      <input type=\"number\" placeholder=\"0\" id=\"raise-fixed\" name=\"fixed\" value=\"\">\r\n                   </div>\r\n                   <div class=\"services-import__step3-plus\">+</div>\r\n                   <div class=\"services-import__step3-field\">\r\n                      <div class=\"services-import__placeholder-title\">Yüzde (%)</div>\r\n                      <input type=\"number\" placeholder=\"0\" id=\"raise-percent\" name=\"percent\" value=\"\">\r\n                   </div>\r\n                   <div class=\"services-import__step3-actions\"><span class=\"btn btn-default\">Hesaplamaları sıfırla</span></div>\r\n                </div>\r\n                \r\n                <div class=\"services-import__list-wrap services-import__list-active\">\r\n                   <div class=\"services-import__scroll-wrap\">";
                                                                                $category_id = 0;
                                                                                $c = 0;
                                                                                foreach ($grouped as $category) {
                                                                                    foreach ($apiServices as $key => $value) {
                                                                                        if ($category[$category_id]->id == $value->service) {
                                                                                            $categoryName = $value->category;
                                                                                        }
                                                                                    }
                                                                                    $category_id = $category_id++;
                                                                                    $c++;
                                                                                    echo "<span class=\"providerCategory\" id=\"providerCategory-" . $c . "\">\r\n                           <div class=\"services-import__category\">\r\n                              <div class=\"services-import__category-title\"><label>" . $categoryName . "</label></div>\r\n                           </div>\r\n                           <div class=\"services-import__packages\">\r\n                              <ul>";
                                                                                    for ($i = 0; $i < count($category); $i++) {
                                                                                        foreach ($apiServices as $apiService) {
                                                                                            if ($apiService->service == $category[$i]->id) {
                                                                                                echo "<li id=\"providerService-" . $apiService->service . "\">\r\n                                         <label class=\"row\">        \r\n                                            <div class=\"col-md-8\">" . $apiService->service . " - " . $apiService->name . "</div>\r\n                                            <div class=\"col-md-3\">\r\n                                               <input style=\"\r\n                                                        width: 85px;\r\n                                                        border: solid 1px rgba(103,107,118,.5);\r\n                                                        padding-left: 0;\r\n                                                        padding-right: 22px;\r\n                                                        border-radius: 3px;\r\n                                                        background: 0 0;\r\n                                                        \" id=\"servicePriceCal" . $apiService->service . "\" type=\"text\" class=\"services-import__price\" data-rate=\"" . priceFormat($apiService->rate) . "\" data-service=\"" . $apiService->service . "\" name=\"servicesList[" . $apiService->service . "]\" value=\"" . priceFormat($apiService->rate) . "\">\r\n                                               <div class=\"services-import__packages-price-lock\" data-category=\"" . $c . "\"  data-id=\"servicedelete-" . $apiService->service . "\" data-service=\"" . $apiService->service . "\">\r\n                                                 <span class=\"fa fa-trash\"></span>\r\n                                               </div>\r\n                                               <div class=\"services-import__packages-price-lock\"  data-id=\"servicelock-" . $apiService->service . "\" data-service=\"" . $apiService->service . "\">\r\n                                                 <span class=\"fa fa-unlock\"></span>\r\n                                               </div>\r\n                                            </div>\r\n                                            <span class=\"services-import__provider-price\">" . priceFormat($apiService->rate) . "</span>\r\n                                         </label>\r\n                                      </li>";
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                    echo "</ul>\r\n                           </div>\r\n                        </span>";
                                                                                }
                                                                                echo "</div>     \r\n                </div>\r\n             </div>\r\n          </div>\r\n          <script>\r\n          function formatCurrency(total) {\r\n              var neg = false;\r\n              if(total < 0) {\r\n                  neg = true;\r\n                  total = Math.abs(total);\r\n              }\r\n              return parseFloat(total, 10).toFixed(2).replace(/(\\d)(?=(\\d{3})+\\.)/g, \"\$1,\").toString();\r\n          }\r\n          function sum(input){\r\n           if (toString.call(input) !== \"[object Array]\")\r\n              return false;\r\n\r\n                      var total =  0;\r\n                      for(var i=0;i<input.length;i++)\r\n                        {\r\n                          if(isNaN(input[i])){\r\n                          continue;\r\n                           }\r\n                      total += Number(input[i]);\r\n                   }\r\n             return total;\r\n            }\r\n          function chargeService(){\r\n            var add_fixed       = \$(\"#raise-fixed\").val();\r\n            var add_percent     = \$(\"#raise-percent\").val();\r\n            \$(\".services-import__price\").each(function(){\r\n              if( \$(this).attr(\"readonly\") != \"readonly\" ){\r\n                var rate        = \$(this).attr(\"data-rate\");\r\n                var service     = \$(this).attr(\"data-service\");\r\n                var total = sum([rate,(rate*add_percent/100),add_fixed]);\r\n                \$(\"#servicePriceCal\"+service).val(total);\r\n\r\n              }\r\n            });\r\n          }\r\n            \$('[data-id^=\"servicedelete-\"]').click(function(){\r\n              var id        = \$(this).attr(\"data-service\");\r\n              var category  = \$(this).attr(\"data-category\");\r\n              \$(\"li#providerService-\"+id).remove();\r\n                if( \$(\"#providerCategory-\"+category+\" > .services-import__packages > ul > li\").length == 0 ){\r\n                  \$(\"#providerCategory-\"+category).remove();\r\n                }\r\n            });\r\n            \$('[data-id^=\"servicelock-\"]').click(function(){\r\n              var service_id  = \$(this).attr(\"data-service\");\r\n              var lock        = \$(this).find(\"span\").attr(\"class\");\r\n              if( lock == \"fa fa-unlock\" ){\r\n                \$(this).find(\"span\").removeClass(\"fa fa-unlock\");\r\n                \$(this).find(\"span\").addClass(\"fa fa-lock\");\r\n                \$('[data-service=\"'+service_id+'\"]').attr(\"readonly\",true);\r\n              } else{\r\n                \$(this).find(\"span\").removeClass(\"fa fa-lock\");\r\n                \$(this).find(\"span\").addClass(\"fa fa-unlock\");\r\n                \$('[data-service=\"'+service_id+'\"]').attr(\"readonly\",false);\r\n              }\r\n            });\r\n\r\n            \$(\".services-import__step3-actions\").click(function(){\r\n              var add_fixed       = \$(\"#raise-fixed\").val(\"\");\r\n              var add_percent     = \$(\"#raise-percent\").val(\"\");\r\n              \$(\".services-import__price\").each(function(){\r\n                if( \$(this).attr(\"readonly\") != \"readonly\" ){\r\n                  var rate        = \$(this).attr(\"data-rate\");\r\n                  var service     = \$(this).attr(\"data-service\");\r\n                    \$(\"#servicePriceCal\"+service).val(rate);\r\n                }\r\n              });\r\n            });\r\n\r\n            \$(\"#raise-fixed\").on(\"keyup\", function(){\r\n              chargeService();\r\n            });\r\n\r\n            \$(\"#raise-percent\").on(\"keyup\", function(){\r\n              chargeService();\r\n            });\r\n\r\n          </script>\r\n          ";
                                                                            } else {
                                                                                if ($action == "price_providerCal") {
                                                                                    $fixed = $_POST["fixed"];
                                                                                    $percent = $_POST["percent"];
                                                                                    $rate = $_POST["rate"];
                                                                                    $total = $rate;
                                                                                    if (is_numeric($percent) && 0 < $percent) {
                                                                                        $total = $total + $rate * $percent / 100;
                                                                                    }
                                                                                    if (is_numeric($fixed) && 0 < $fixed) {
                                                                                        $total = $total + $fixed;
                                                                                    }
                                                                                    echo $total;
                                                                                } else {
                                                                                    if ($action == "new_ticket") {
                                                                                        $return = "<form class=\"form\" action=\"" . base_url("admin/tickets/new") . "\" method=\"post\" data-xhr=\"true\">\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Kullanıcı adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"username\" value=\"\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Konu</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"subject\" value=\"\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Mesajınız</label>\r\n            <textarea class=\"form-control\" name=\"message\" rows=\"4\"></textarea>\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Yeni talebi oluştur</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                        echo json_encode(["content" => $return, "title" => "Yeni destek talebi"]);
                                                                                    } else {
                                                                                        if ($action == "edit_category") {
                                                                                            $id = $_POST["id"];
                                                                                            $subject = $conn->prepare("SELECT * FROM ticket_subject WHERE subject_id=:id ");
                                                                                            $subject->execute(["id" => $id]);
                                                                                            $category = $category->fetch(PDO::FETCH_ASSOC);
                                                                                            $return = "<form class=\"form\" action=\"" . base_url("admin/services/edit-category/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Kategori adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $category["category_name"] . "\">\r\n          </div>\r\n \r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Kişiye Özel Kategori (Sadece seçtiğiniz kişiler görebilir.)</label>\r\n              <select class=\"form-control\" name=\"secret\">\r\n                    <option value=\"2\"";
                                                                                            if ($category["category_secret"] == 2) {
                                                                                                $return .= "selected";
                                                                                            }
                                                                                            $return .= ">Hayır</option>\r\n                    <option value=\"1\"";
                                                                                            if ($category["category_secret"] == 1) {
                                                                                                $return .= "selected";
                                                                                            }
                                                                                            $return .= ">Evet</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Destek Başlığını Düzenle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                            echo json_encode(["content" => $return, "title" => "Destek Başlığını Düzenle (ID: " . $id . ")"]);
                                                                                        } else {
                                                                                            if ($action == "edit_paymentmethod" && $_POST["id"] == "payhesap") {
                                                                                                $id = $_POST["id"];
                                                                                                $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                $method->execute(["id" => $id]);
                                                                                                $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                $extra = json_decode($method["method_extras"], true);
                                                                                                $return = "<form class=\"form\" action=\"" . base_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Method adı</label>\r\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Görünürlük</label>\r\n              <select class=\"form-control\" name=\"method_type\">\r\n                    <option value=\"2\"";
                                                                                                if ($method["method_type"] == 2) {
                                                                                                    $return .= "selected";
                                                                                                }
                                                                                                $return .= ">Aktif</option>\r\n                    <option value=\"1\"";
                                                                                                if ($method["method_type"] == 1) {
                                                                                                    $return .= "selected";
                                                                                                }
                                                                                                $return .= ">Pasif</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Görünür adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\r\n          </div>\r\n\r\n          <hr>\r\n            <p class=\"card-description\">\r\n              <ul>\r\n                <li>\r\n                  API Geri Dönüş Adresi: <code>";
                                                                                                $return .= base_url("payment/" . $method["method_get"]);
                                                                                                $return .= "</code>\r\n                </li>\r\n              </ul>\r\n            </p>\r\n          <hr>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Api Key</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"apiKey\" value=\"" . $extra["apiKey"] . "\">\r\n          </div>\r\n    <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Para Birimi</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"currency\" value=\"" . $extra["currency"] . "\">\r\n          </div>\r\n        <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Komisyon, %</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"fee\" value=\"" . $extra["fee"] . "\">\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                            } else {
                                                                                                if ($action == "edit_paymentmethod" && $_POST["id"] == "payizone") {
                                                                                                    $id = $_POST["id"];
                                                                                                    $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                    $method->execute(["id" => $id]);
                                                                                                    $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                    $extra = json_decode($method["method_extras"], true);
                                                                                                    $return = "<form class=\"form\" action=\"" . base_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Method adı</label>\r\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Görünürlük</label>\r\n              <select class=\"form-control\" name=\"method_type\">\r\n                    <option value=\"2\"";
                                                                                                    if ($method["method_type"] == 2) {
                                                                                                        $return .= "selected";
                                                                                                    }
                                                                                                    $return .= ">Aktif</option>\r\n                    <option value=\"1\"";
                                                                                                    if ($method["method_type"] == 1) {
                                                                                                        $return .= "selected";
                                                                                                    }
                                                                                                    $return .= ">Pasif</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Görünür adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\r\n          </div>\r\n\r\n          <hr>\r\n            <p class=\"card-description\">\r\n              <ul>\r\n                <li>\r\n                  API Geri Dönüş Adresi: <code>";
                                                                                                    $return .= base_url("payment/" . $method["method_get"]);
                                                                                                    $return .= "</code>\r\n                </li>\r\n              </ul>\r\n            </p>\r\n          <hr>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">APP ID</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"appid\" value=\"" . $extra["appid"] . "\">\r\n          </div>\r\n    <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">API Secret</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"apiSecret\" value=\"" . $extra["apiSecret"] . "\">\r\n          </div>\r\n     <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">E- Mail</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"email\" value=\"" . $extra["email"] . "\">\r\n          </div>\r\n\r\n\r\n   <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Other Code</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"otherCode\" value=\"" . $extra["otherCode"] . "\">\r\n          </div>\r\n\r\n\r\n      <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Komisyon, %</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"fee\" value=\"" . $extra["fee"] . "\">\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                    echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                                } else {
                                                                                                    if ($action == "edit_paymentmethod" && $_POST["id"] == "paytr") {
                                                                                                        $id = $_POST["id"];
                                                                                                        $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                        $method->execute(["id" => $id]);
                                                                                                        $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                        $extra = json_decode($method["method_extras"], true);
                                                                                                        $return = "<form class=\"form\" action=\"" . base_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Method adı</label>\r\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Görünürlük</label>\r\n              <select class=\"form-control\" name=\"method_type\">\r\n                    <option value=\"2\"";
                                                                                                        if ($method["method_type"] == 2) {
                                                                                                            $return .= "selected";
                                                                                                        }
                                                                                                        $return .= ">Aktif</option>\r\n                    <option value=\"1\"";
                                                                                                        if ($method["method_type"] == 1) {
                                                                                                            $return .= "selected";
                                                                                                        }
                                                                                                        $return .= ">Pasif</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Görünür adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\r\n          </div>\r\n\r\n          <hr>\r\n            <p class=\"card-description\">\r\n              <ul>\r\n                <li>\r\n                  API Geri Dönüş Adresi: <code>";
                                                                                                        $return .= base_url("payment/" . $method["method_get"]);
                                                                                                        $return .= "</code>\r\n                </li>\r\n              </ul>\r\n            </p>\r\n          <hr>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Merchant id</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"merchant_id\" value=\"" . $extra["merchant_id"] . "\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Merchant key</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"merchant_key\" value=\"" . $extra["merchant_key"] . "\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Merchant salt</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"merchant_salt\" value=\"" . $extra["merchant_salt"] . "\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Komisyon, %</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"fee\" value=\"" . $extra["fee"] . "\">\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                        echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                                    } else {
                                                                                                        if ($action == "edit_paymentmethod" && $_POST["id"] == "paytr_havale") {
                                                                                                            $id = $_POST["id"];
                                                                                                            $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                            $method->execute(["id" => $id]);
                                                                                                            $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                            $extra = json_decode($method["method_extras"], true);
                                                                                                            $return = "<form class=\"form\" action=\"" . base_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Method adı</label>\r\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Görünürlük</label>\r\n              <select class=\"form-control\" name=\"method_type\">\r\n                    <option value=\"2\"";
                                                                                                            if ($method["method_type"] == 2) {
                                                                                                                $return .= "selected";
                                                                                                            }
                                                                                                            $return .= ">Aktif</option>\r\n                    <option value=\"1\"";
                                                                                                            if ($method["method_type"] == 1) {
                                                                                                                $return .= "selected";
                                                                                                            }
                                                                                                            $return .= ">Pasif</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Görünür adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\r\n          </div>\r\n\r\n          <hr>\r\n            <p class=\"card-description\">\r\n              <ul>\r\n                <li>\r\n                  API Geri Dönüş Adresi: <code>";
                                                                                                            $return .= base_url("payment/paytr");
                                                                                                            $return .= "</code>\r\n                </li>\r\n              </ul>\r\n            </p>\r\n          <hr>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Merchant id</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"merchant_id\" value=\"" . $extra["merchant_id"] . "\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Merchant key</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"merchant_key\" value=\"" . $extra["merchant_key"] . "\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Merchant salt</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"merchant_salt\" value=\"" . $extra["merchant_salt"] . "\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Komisyon, %</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"fee\" value=\"" . $extra["fee"] . "\">\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                            echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                                        } else {
                                                                                                            if ($action == "edit_paymentmethod" && $_POST["id"] == "paypal") {
                                                                                                                $id = $_POST["id"];
                                                                                                                $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                                $method->execute(["id" => $id]);
                                                                                                                $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                                $extra = json_decode($method["method_extras"], true);
                                                                                                                $return = "<form class=\"form\" action=\"" . base_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Method adı</label>\r\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Görünürlük</label>\r\n              <select class=\"form-control\" name=\"method_type\">\r\n                    <option value=\"2\"";
                                                                                                                if ($method["method_type"] == 2) {
                                                                                                                    $return .= "selected";
                                                                                                                }
                                                                                                                $return .= ">Aktif</option>\r\n                    <option value=\"1\"";
                                                                                                                if ($method["method_type"] == 1) {
                                                                                                                    $return .= "selected";
                                                                                                                }
                                                                                                                $return .= ">Pasif</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Görünür adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\r\n          </div>\r\n\r\n          <hr>\r\n            <p class=\"card-description\">\r\n              <ul>\r\n                <li>\r\n                  API Geri Dönüş Adresi: <code>";
                                                                                                                $return .= base_url("payment/paypal");
                                                                                                                $return .= "</code>\r\n                </li>\r\n              </ul>\r\n            </p>\r\n          <hr>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Client Id</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"client\" value=\"" . $extra["client"] . "\"></div> <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Secret Key</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"secret\" value=\"" . $extra["secret"] . "\"></div><div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Para Birimi</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"charge\" value=\"" . $extra["charge"] . "\"></div>\r\n<div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                                            } else {
                                                                                                                if ($action == "edit_paymentmethod" && $_POST["id"] == "paywant") {
                                                                                                                    $id = $_POST["id"];
                                                                                                                    $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                                    $method->execute(["id" => $id]);
                                                                                                                    $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                                    $extra = json_decode($method["method_extras"], true);
                                                                                                                    $return = "<form class=\"form\" action=\"" . base_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Method adı</label>\r\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Görünürlük</label>\r\n              <select class=\"form-control\" name=\"method_type\">\r\n                    <option value=\"2\"";
                                                                                                                    if ($method["method_type"] == 2) {
                                                                                                                        $return .= "selected";
                                                                                                                    }
                                                                                                                    $return .= ">Aktif</option>\r\n                    <option value=\"1\"";
                                                                                                                    if ($method["method_type"] == 1) {
                                                                                                                        $return .= "selected";
                                                                                                                    }
                                                                                                                    $return .= ">Pasif</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Görünür adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\r\n          </div>\r\n\r\n          <hr>\r\n            <p class=\"card-description\">\r\n              <ul>\r\n                <li>\r\n                  API Geri Dönüş Adresi: <code>";
                                                                                                                    $return .= base_url("payment/" . $method["method_get"]);
                                                                                                                    $return .= "</code>\r\n                </li>\r\n              </ul>\r\n            </p>\r\n          <hr>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">apiKey</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"apiKey\" value=\"" . $extra["apiKey"] . "\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">apiSecret</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"apiSecret\" value=\"" . $extra["apiSecret"] . "\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Komisyon, %</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"fee\" value=\"" . $extra["fee"] . "\">\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Paywant Komison</label>\r\n              <select class=\"form-control\" name=\"commissionType\">\r\n                    <option value=\"2\"";
                                                                                                                    if ($extra["commissionType"] == 2) {
                                                                                                                        $return .= "selected";
                                                                                                                    }
                                                                                                                    $return .= ">Kullanıcıya yansıt</option>\r\n                    <option value=\"1\"";
                                                                                                                    if ($extra["commissionType"] == 1) {
                                                                                                                        $return .= "selected";
                                                                                                                    }
                                                                                                                    $return .= ">Kullanıcıya yansıtma</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label>Ödeme Yöntemleri</label>\r\n              <div class=\"form-group col-md-12\">\r\n                  <div class=\"row\">\r\n                    <label class=\"checkbox-inline col-md-3\">\r\n                      <input type=\"checkbox\" class=\"access\" name=\"payment_type[]\" value=\"1\"";
                                                                                                                    if (in_array(1, $extra["payment_type"])) {
                                                                                                                        $return .= " checked";
                                                                                                                    }
                                                                                                                    $return .= "> Mobil Ödeme\r\n                    </label>\r\n                    <label class=\"checkbox-inline col-md-3\">\r\n                      <input type=\"checkbox\" class=\"access\" name=\"payment_type[]\" value=\"2\"";
                                                                                                                    if (in_array(2, $extra["payment_type"])) {
                                                                                                                        $return .= " checked";
                                                                                                                    }
                                                                                                                    $return .= "> Kredi/Banka Kartı\r\n                    </label>\r\n                    <label class=\"checkbox-inline col-md-3\">\r\n                      <input type=\"checkbox\" class=\"access\" name=\"payment_type[]\" value=\"3\"";
                                                                                                                    if (in_array(3, $extra["payment_type"])) {
                                                                                                                        $return .= " checked";
                                                                                                                    }
                                                                                                                    $return .= "> Havale/EFT\r\n                    </label>\r\n                  </div>\r\n              </div>\r\n            </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                    echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                                                } else {
                                                                                                                    if ($action == "edit_paymentmethod" && $_POST["id"] == "coinpayments") {
                                                                                                                        $id = $_POST["id"];
                                                                                                                        $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                                        $method->execute(["id" => $id]);
                                                                                                                        $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                                        $extra = json_decode($method["method_extras"], true);
                                                                                                                        $return = "<form class=\"form\" action=\"" . base_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Method adı</label>\r\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Görünürlük</label>\r\n              <select class=\"form-control\" name=\"method_type\">\r\n                    <option value=\"2\"";
                                                                                                                        if ($method["method_type"] == 2) {
                                                                                                                            $return .= "selected";
                                                                                                                        }
                                                                                                                        $return .= ">Aktif</option>\r\n                    <option value=\"1\"";
                                                                                                                        if ($method["method_type"] == 1) {
                                                                                                                            $return .= "selected";
                                                                                                                        }
                                                                                                                        $return .= ">Pasif</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Görünür adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\r\n          </div>\r\n\r\n          <hr>\r\n            <p class=\"card-description\">\r\n              <ul>\r\n                <li>\r\n                  API Geri Dönüş Adresi: <code>";
                                                                                                                        $return .= base_url("payment/" . $method["method_get"]);
                                                                                                                        $return .= "</code>\r\n                </li>\r\n              </ul>\r\n            </p>\r\n          <hr>\r\n\r\n<div class=\"form-group\">\r\n  <label class=\"form-group__service-name\">Coinpayments Public Key</label>\r\n  <input type=\"text\" class=\"form-control\" name=\"coinpayments_public_key\" value=\"" . $extra["coinpayments_public_key"] . "\">\r\n </div>\r\n\r\n<div class=\"form-group\">\r\n  <label class=\"form-group__service-name\">Coinpayments Private Key</label>\r\n  <input type=\"text\" class=\"form-control\" name=\"coinpayments_private_key\" value=\"" . $extra["coinpayments_private_key"] . "\">\r\n </div>\r\n \r\n <div class=\"form-group\">\r\n  <label class=\"form-group__service-name\">Coinpayments Crypto Currency</label>\r\n  <input type=\"text\" class=\"form-control\" name=\"coinpayments_currency\" value=\"" . $extra["coinpayments_currency"] . "\">\r\n </div>\r\n \r\n <div class=\"form-group\">\r\n  <label class=\"form-group__service-name\">Merchant ID</label>\r\n  <input type=\"text\" class=\"form-control\" name=\"merchant_id\" value=\"" . $extra["merchant_id"] . "\">\r\n </div>\r\n \r\n <div class=\"form-group\">\r\n  <label class=\"form-group__service-name\">IPN Secret</label>\r\n  <input type=\"text\" class=\"form-control\" name=\"ipn_secret\" value=\"" . $extra["ipn_secret"] . "\">\r\n </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Komisyon, %</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"fee\" value=\"" . $extra["fee"] . "\">\r\n          </div>\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                        echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                                                    } else {
                                                                                                                        if ($action == "edit_paymentmethod" && $_POST["id"] == "2checkout") {
                                                                                                                            $id = $_POST["id"];
                                                                                                                            $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                                            $method->execute(["id" => $id]);
                                                                                                                            $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                                            $extra = json_decode($method["method_extras"], true);
                                                                                                                            $return = "<form class=\"form\" action=\"" . base_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Method adı</label>\r\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Görünürlük</label>\r\n              <select class=\"form-control\" name=\"method_type\">\r\n                    <option value=\"2\"";
                                                                                                                            if ($method["method_type"] == 2) {
                                                                                                                                $return .= "selected";
                                                                                                                            }
                                                                                                                            $return .= ">Aktif</option>\r\n                    <option value=\"1\"";
                                                                                                                            if ($method["method_type"] == 1) {
                                                                                                                                $return .= "selected";
                                                                                                                            }
                                                                                                                            $return .= ">Pasif</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Görünür adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\r\n          </div>\r\n\r\n          <hr>\r\n            <p class=\"card-description\">\r\n              <ul>\r\n                <li>\r\n                  API Geri Dönüş Adresi: <code>";
                                                                                                                            $return .= base_url("payment/" . $method["method_get"]);
                                                                                                                            $return .= "</code>\r\n                </li>\r\n              </ul>\r\n            </p>\r\n          <hr>\r\n\r\n\r\n <div class=\"form-group\">\r\n  <label class=\"form-group__service-name\">Seller ID</label>\r\n  <input type=\"text\" class=\"form-control\" name=\"seller_id\" value=\"" . $extra["seller_id"] . "\">\r\n </div>\r\n \r\n <div class=\"form-group\">\r\n  <label class=\"form-group__service-name\">Private Key</label>\r\n  <input type=\"text\" class=\"form-control\" name=\"private_key\" value=\"" . $extra["private_key"] . "\">\r\n </div>\r\n \r\n <div class=\"form-group\">\r\n  <label class=\"form-group__service-name\">Currency</label>\r\n  <input type=\"text\" class=\"form-control\" name=\"currency\" value=\"" . $extra["currency"] . "\">\r\n </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Komisyon, %</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"fee\" value=\"" . $extra["fee"] . "\">\r\n          </div>\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                            echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                                                        } else {
                                                                                                                            if ($action == "edit_paymentmethod" && $_POST["id"] == "paytm") {
                                                                                                                                $id = $_POST["id"];
                                                                                                                                $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                                                $method->execute(["id" => $id]);
                                                                                                                                $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                                                $extra = json_decode($method["method_extras"], true);
                                                                                                                                $return = "<form class=\"form\" action=\"" . base_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Method adı</label>\r\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Görünürlük</label>\r\n              <select class=\"form-control\" name=\"method_type\">\r\n                    <option value=\"2\"";
                                                                                                                                if ($method["method_type"] == 2) {
                                                                                                                                    $return .= "selected";
                                                                                                                                }
                                                                                                                                $return .= ">Aktif</option>\r\n                    <option value=\"1\"";
                                                                                                                                if ($method["method_type"] == 1) {
                                                                                                                                    $return .= "selected";
                                                                                                                                }
                                                                                                                                $return .= ">Pasif</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Görünür adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\r\n          </div>\r\n\r\n          <hr>\r\n            <p class=\"card-description\">\r\n              <ul>\r\n                <li>\r\n                  API Geri Dönüş Adresi: <code>";
                                                                                                                                $return .= base_url("payment/" . $method["method_get"]);
                                                                                                                                $return .= "</code>\r\n                </li>\r\n              </ul>\r\n            </p>\r\n          <hr>\r\n\r\n\r\n <div class=\"form-group\">\r\n  <label class=\"form-group__service-name\">Merchant Key</label>\r\n  <input type=\"text\" class=\"form-control\" name=\"merchant_key\" value=\"" . $extra["merchant_key"] . "\">\r\n </div>\r\n<div class=\"form-group\">\r\n  <label class=\"form-group__service-name\">Merchant MID</label>\r\n  <input type=\"text\" class=\"form-control\" name=\"merchant_mid\" value=\"" . $extra["merchant_mid"] . "\">\r\n </div>\r\n<div class=\"form-group\">\r\n  <label class=\"form-group__service-name\">Merchant Website</label>\r\n  <input type=\"text\" class=\"form-control\" name=\"merchant_website\" value=\"" . $extra["merchant_website"] . "\">\r\n </div>\r\n\r\n <div class=\"form-group\">\r\n  <label class=\"form-group__service-name\">Currency</label>\r\n  <input type=\"text\" class=\"form-control\" name=\"currency\" value=\"INR\" readonly=\"\">\r\n </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Komisyon, %</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"fee\" value=\"" . $extra["fee"] . "\">\r\n          </div>\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                                                            } else {
                                                                                                                                if ($action == "edit_paymentmethod" && $_POST["id"] == "payeer") {
                                                                                                                                    $id = $_POST["id"];
                                                                                                                                    $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                                                    $method->execute(["id" => $id]);
                                                                                                                                    $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                                                    $extra = json_decode($method["method_extras"], true);
                                                                                                                                    $return = "<form class=\"form\" action=\"" . base_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Method adı</label>\r\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Görünürlük</label>\r\n              <select class=\"form-control\" name=\"method_type\">\r\n                    <option value=\"2\"";
                                                                                                                                    if ($method["method_type"] == 2) {
                                                                                                                                        $return .= "selected";
                                                                                                                                    }
                                                                                                                                    $return .= ">Aktif</option>\r\n                    <option value=\"1\"";
                                                                                                                                    if ($method["method_type"] == 1) {
                                                                                                                                        $return .= "selected";
                                                                                                                                    }
                                                                                                                                    $return .= ">Pasif</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Görünür adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\r\n          </div>\r\n\r\n          <hr>\r\n            <p class=\"card-description\">\r\n              <ul>\r\n                <li>\r\n                  API Geri Dönüş Adresi: <code>";
                                                                                                                                    $return .= base_url("payment/" . $method["method_get"]);
                                                                                                                                    $return .= "</code>\r\n                </li>\r\n              </ul>\r\n            </p>\r\n          <hr>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Mağaza ID</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"mshop\" value=\"" . $extra["mshop"] . "\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Mağaza key</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"mkey\" value=\"" . $extra["mkey"] . "\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Ödeme Dili (en, ru)</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"lang\" value=\"" . $extra["lang"] . "\">\r\n          </div>\r\n    <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Para Birimi</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"currency\" value=\"" . $extra["currency"] . "\">\r\n          </div>\r\n\r\n\r\n         <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Komisyon, %</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"fee\" value=\"" . $extra["fee"] . "\">\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                    echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                                                                } else {
                                                                                                                                    if ($action == "edit_paymentmethod" && $_POST["id"] == "weepay") {
                                                                                                                                        $id = $_POST["id"];
                                                                                                                                        $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                                                        $method->execute(["id" => $id]);
                                                                                                                                        $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                                                        $extra = json_decode($method["method_extras"], true);
                                                                                                                                        $return = "<form class=\"form\" action=\"" . base_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Method adı</label>\r\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Görünürlük</label>\r\n              <select class=\"form-control\" name=\"method_type\">\r\n                    <option value=\"2\"";
                                                                                                                                        if ($method["method_type"] == 2) {
                                                                                                                                            $return .= "selected";
                                                                                                                                        }
                                                                                                                                        $return .= ">Aktif</option>\r\n                    <option value=\"1\"";
                                                                                                                                        if ($method["method_type"] == 1) {
                                                                                                                                            $return .= "selected";
                                                                                                                                        }
                                                                                                                                        $return .= ">Pasif</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Görünür adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\r\n          </div>\r\n\r\n          <hr>\r\n            <p class=\"card-description\">\r\n              <ul>\r\n                <li>\r\n                  API Geri Dönüş Adresi: <code>Geri dönüş adresine ihtiyaç yoktur.</code>\r\n                </li>\r\n              </ul>\r\n            </p>\r\n          <hr>\r\n\r\n\r\n <div class=\"form-group\">\r\n  <label class=\"form-group__service-name\">Bayi ID</label>\r\n  <input type=\"text\" class=\"form-control\" name=\"bayi_id\" value=\"" . $extra["bayi_id"] . "\">\r\n </div>\r\n<div class=\"form-group\">\r\n  <label class=\"form-group__service-name\">API Key</label>\r\n  <input type=\"text\" class=\"form-control\" name=\"api_key\" value=\"" . $extra["api_key"] . "\">\r\n </div>\r\n<div class=\"form-group\">\r\n  <label class=\"form-group__service-name\">Secret Key</label>\r\n  <input type=\"text\" class=\"form-control\" name=\"secret_key\" value=\"" . $extra["secret_key"] . "\">\r\n </div>\r\n\r\n <div class=\"form-group\">\r\n  <label class=\"form-group__service-name\">Currency</label>\r\n  <input type=\"text\" class=\"form-control\" name=\"currency\" value=\"" . $extra["currency"] . "\">\r\n </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Komisyon, %</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"fee\" value=\"" . $extra["fee"] . "\">\r\n          </div>\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                        echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                                                                    } else {
                                                                                                                                        if ($action == "new_bankaccount") {
                                                                                                                                            $return = "<form class=\"form\" action=\"" . base_url("admin/settings/bank-accounts/new") . "\" method=\"post\" data-xhr=\"true\">\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group\">Banka adı</label>\r\n            <input type=\"text\" name=\"bank_name\" class=\"form-control\" value=\"\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group\">Alıcı adı</label>\r\n            <input type=\"text\" name=\"bank_alici\" class=\"form-control\" value=\"\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group\">Şube no</label>\r\n            <input type=\"text\" name=\"bank_sube\" class=\"form-control\" value=\"\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group\">Hesap no</label>\r\n            <input type=\"text\" name=\"bank_hesap\" class=\"form-control\" value=\"\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group\">IBAN</label>\r\n            <input type=\"text\" name=\"bank_iban\" class=\"form-control\" value=\"\">\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Yeni banka hesabını ekle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                            echo json_encode(["content" => $return, "title" => "Yeni banka hesabı"]);
                                                                                                                                        } else {
                                                                                                                                            if ($action == "edit_bankaccount") {
                                                                                                                                                $id = $_POST["id"];
                                                                                                                                                $bank = $conn->prepare("SELECT * FROM bank_accounts WHERE id=:id ");
                                                                                                                                                $bank->execute(["id" => $id]);
                                                                                                                                                $bank = $bank->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                $return = "<form class=\"form\" action=\"" . base_url("admin/settings/bank-accounts/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group\">Banka adı</label>\r\n            <input type=\"text\" name=\"bank_name\" class=\"form-control\" value=\"" . $bank["bank_name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group\">Alıcı adı</label>\r\n            <input type=\"text\" name=\"bank_alici\" class=\"form-control\" value=\"" . $bank["bank_alici"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group\">Şube no</label>\r\n            <input type=\"text\" name=\"bank_sube\" class=\"form-control\" value=\"" . $bank["bank_sube"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group\">Hesap no</label>\r\n            <input type=\"text\" name=\"bank_hesap\" class=\"form-control\" value=\"" . $bank["bank_hesap"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group\">IBAN</label>\r\n            <input type=\"text\" name=\"bank_iban\" class=\"form-control\" value=\"" . $bank["bank_iban"] . "\">\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n        <div class=\"modal-footer\">\r\n          <a id=\"delete-row\" data-url=\"" . base_url("admin/settings/bank-accounts/delete/" . $bank["id"]) . "\" class=\"btn btn-danger pull-left\">Hesabı kaldır</a>\r\n          <button type=\"submit\" class=\"btn btn-primary\">Banka hesabını güncelle</button>\r\n          <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n        </div>\r\n        </form>\r\n        <script src=\"https://unpkg.com/sweetalert/dist/sweetalert.min.js\"></script>\r\n        <script>\r\n        \$(\"#delete-row\").click(function(){\r\n          var action = \$(this).attr(\"data-url\");\r\n          swal({\r\n            title: \"Silmek istediğinizden emin misiniz?\",\r\n            text: \"Eğer onaylarsanız bu içerik silinecek, bunu geri getirmek mümkün olmayabilir.\",\r\n            icon: \"warning\",\r\n            buttons: true,\r\n            dangerMode: true,\r\n            buttons: [\"Vazgeç\", \"Evet, eminim!\"],\r\n          })\r\n          .then((willDelete) => {\r\n            if (willDelete) {\r\n              \$.ajax({\r\n                url:  action,\r\n                type: \"GET\",\r\n                dataType: \"json\",\r\n                cache: false,\r\n                contentType: false,\r\n                processData: false\r\n              })\r\n              .done(function(result){\r\n                if( result.s == \"error\" ){\r\n                  var heading = \"Başarısız\";\r\n                }else{\r\n                  var heading = \"Başarılı\";\r\n                }\r\n                  \$.toast({\r\n                      heading: heading,\r\n                      text: result.m,\r\n                      icon: result.s,\r\n                      loader: true,\r\n                      loaderBg: \"#9EC600\"\r\n                  });\r\n                  if (result.r!=null) {\r\n                    if( result.time ==null ){ result.time = 3; }\r\n                    setTimeout(function(){\r\n                      window.location.href  = result.r;\r\n                    },result.time*1000);\r\n                  }\r\n              })\r\n              .fail(function(){\r\n                \$.toast({\r\n                    heading: \"Başarısız\",\r\n                    text: \"İstek gerçekleştirilemedi\",\r\n                    icon: \"error\",\r\n                    loader: true,\r\n                    loaderBg: \"#9EC600\"\r\n                });\r\n              });\r\n              /* İçerik silinmesi onaylandı */\r\n            } else {\r\n              \$.toast({\r\n                  heading: \"Başarısız\",\r\n                  text: \"Silinme istediği reddedildi\",\r\n                  icon: \"error\",\r\n                  loader: true,\r\n                  loaderBg: \"#9EC600\"\r\n              });\r\n            }\r\n          });\r\n        });\r\n        </script>\r\n          </form>";
                                                                                                                                                echo json_encode(["content" => $return, "title" => "Banka hesabını güncelle"]);
                                                                                                                                            } else {
                                                                                                                                                if ($action == "edit_paymentmethod" && $_POST["id"] == "shopier") {
                                                                                                                                                    $id = $_POST["id"];
                                                                                                                                                    $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                                                                    $method->execute(["id" => $id]);
                                                                                                                                                    $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                    $extra = json_decode($method["method_extras"], true);
                                                                                                                                                    $return = "<form class=\"form\" action=\"" . base_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Method adı</label>\r\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Görünürlük</label>\r\n              <select class=\"form-control\" name=\"method_type\">\r\n                    <option value=\"2\"";
                                                                                                                                                    if ($method["method_type"] == 2) {
                                                                                                                                                        $return .= "selected";
                                                                                                                                                    }
                                                                                                                                                    $return .= ">Aktif</option>\r\n                    <option value=\"1\"";
                                                                                                                                                    if ($method["method_type"] == 1) {
                                                                                                                                                        $return .= "selected";
                                                                                                                                                    }
                                                                                                                                                    $return .= ">Pasif</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Görünür adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\r\n          </div>\r\n\r\n          <hr>\r\n            <p class=\"card-description\">\r\n              <ul>\r\n                <li>\r\n                  API Geri Dönüş Adresi: <code>";
                                                                                                                                                    $return .= base_url("payment/" . $method["method_get"]);
                                                                                                                                                    $return .= "</code>\r\n                </li>\r\n              </ul>\r\n            </p>\r\n          <hr>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">apiKey</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"apiKey\" value=\"" . $extra["apiKey"] . "\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">apiSecret</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"apiSecret\" value=\"" . $extra["apiSecret"] . "\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n          <label>Geri dönüş</label>\r\n            <select class=\"form-control\" name=\"website_index\">\r\n                  <option value=\"1\"";
                                                                                                                                                    if ($extra["website_index"] == 1) {
                                                                                                                                                        $return .= "selected";
                                                                                                                                                    }
                                                                                                                                                    $return .= ">Geri dönüş URL (1)</option>\r\n                  <option value=\"2\"";
                                                                                                                                                    if ($extra["website_index"] == 2) {
                                                                                                                                                        $return .= "selected";
                                                                                                                                                    }
                                                                                                                                                    $return .= ">Geri dönüş URL (2)</option>\r\n                  <option value=\"3\"";
                                                                                                                                                    if ($extra["website_index"] == 3) {
                                                                                                                                                        $return .= "selected";
                                                                                                                                                    }
                                                                                                                                                    $return .= ">Geri dönüş URL (3)</option>\r\n                  <option value=\"4\"";
                                                                                                                                                    if ($extra["website_index"] == 4) {
                                                                                                                                                        $return .= "selected";
                                                                                                                                                    }
                                                                                                                                                    $return .= ">Geri dönüş URL (4)</option>\r\n                  <option value=\"5\"";
                                                                                                                                                    if ($extra["website_index"] == 5) {
                                                                                                                                                        $return .= "selected";
                                                                                                                                                    }
                                                                                                                                                    $return .= ">Geri dönüş URL (5)</option>\r\n              </select>\r\n          </div>\r\n          <div class=\"form-group\">\r\n          <label>İşlem ücreti (0,49 TL)</label>\r\n            <select class=\"form-control\" name=\"processing_fee\">\r\n                  <option value=\"1\"";
                                                                                                                                                    if ($extra["processing_fee"] == 1) {
                                                                                                                                                        $return .= "selected";
                                                                                                                                                    }
                                                                                                                                                    $return .= ">Yansıt</option>\r\n                  <option value=\"0\"";
                                                                                                                                                    if ($extra["processing_fee"] == 0) {
                                                                                                                                                        $return .= "selected";
                                                                                                                                                    }
                                                                                                                                                    $return .= ">Yansıtma</option>\r\n              </select>\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Komisyon, %</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"fee\" value=\"" . $extra["fee"] . "\">\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                    echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                                                                                } else {
                                                                                                                                                    if ($action == "edit_paymentmethod" && $_POST["id"] == "shoplemo") {
                                                                                                                                                        $id = $_POST["id"];
                                                                                                                                                        $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                                                                        $method->execute(["id" => $id]);
                                                                                                                                                        $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                        $extra = json_decode($method["method_extras"], true);
                                                                                                                                                        $return = "<form class=\"form\" action=\"" . base_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Method adı</label>\r\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Görünürlük</label>\r\n              <select class=\"form-control\" name=\"method_type\">\r\n                    <option value=\"2\"";
                                                                                                                                                        if ($method["method_type"] == 2) {
                                                                                                                                                            $return .= "selected";
                                                                                                                                                        }
                                                                                                                                                        $return .= ">Aktif</option>\r\n                    <option value=\"1\"";
                                                                                                                                                        if ($method["method_type"] == 1) {
                                                                                                                                                            $return .= "selected";
                                                                                                                                                        }
                                                                                                                                                        $return .= ">Pasif</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Görünür adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\r\n          </div>\r\n\r\n          <hr>\r\n            <p class=\"card-description\">\r\n              <ul>\r\n                <li>\r\n                  API Geri Dönüş Adresi: <code>";
                                                                                                                                                        $return .= base_url("payment/" . $method["method_get"]);
                                                                                                                                                        $return .= "</code>\r\n                </li>\r\n              </ul>\r\n            </p>\r\n          <hr>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">apiKey</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"apiKey\" value=\"" . $extra["apiKey"] . "\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">apiSecret</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"apiSecret\" value=\"" . $extra["apiSecret"] . "\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Komisyon, %</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"fee\" value=\"" . $extra["fee"] . "\">\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                        echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                                                                                    } else {
                                                                                                                                                        if ($action == "edit_paymentmethod" && $_POST["id"] == "perfectmoney") {
                                                                                                                                                            $id = $_POST["id"];
                                                                                                                                                            $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                                                                            $method->execute(["id" => $id]);
                                                                                                                                                            $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                            $extra = json_decode($method["method_extras"], true);
                                                                                                                                                            $return = "<form class=\"form\" action=\"" . base_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Method adı</label>\r\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Görünürlük</label>\r\n              <select class=\"form-control\" name=\"method_type\">\r\n                    <option value=\"2\"";
                                                                                                                                                            if ($method["method_type"] == 2) {
                                                                                                                                                                $return .= "selected";
                                                                                                                                                            }
                                                                                                                                                            $return .= ">Aktif</option>\r\n                    <option value=\"1\"";
                                                                                                                                                            if ($method["method_type"] == 1) {
                                                                                                                                                                $return .= "selected";
                                                                                                                                                            }
                                                                                                                                                            $return .= ">Pasif</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Görünür adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\r\n          </div>\r\n\r\n          <hr>\r\n            <p class=\"card-description\">\r\n              <ul>\r\n                <li>\r\n                  API Geri Dönüş Adresi: <code>";
                                                                                                                                                            $return .= base_url("payment/" . $method["method_get"]);
                                                                                                                                                            $return .= "</code>\r\n                </li>\r\n              </ul>\r\n            </p>\r\n          <hr>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">USER ID</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"aid\" value=\"" . $extra["aid"] . "\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">PAYMENT ID</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"pid\" value=\"" . $extra["pid"] . "\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">ÖDEME PARA BİRİMİ</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"current\" value=\"" . $extra["current"] . "\">\r\n          </div>\r\n           </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                            echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                                                                                        } else {
                                                                                                                                                            if ($action == "edit_paymentmethod" && $_POST["id"] == "havale-eft") {
                                                                                                                                                                $id = $_POST["id"];
                                                                                                                                                                $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                                                                                $method->execute(["id" => $id]);
                                                                                                                                                                $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                $extra = json_decode($method["method_extras"], true);
                                                                                                                                                                $return = "<form class=\"form\" action=\"" . base_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Method adı</label>\r\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Görünürlük</label>\r\n              <select class=\"form-control\" name=\"method_type\">\r\n                    <option value=\"2\"";
                                                                                                                                                                if ($method["method_type"] == 2) {
                                                                                                                                                                    $return .= "selected";
                                                                                                                                                                }
                                                                                                                                                                $return .= ">Aktif</option>\r\n                    <option value=\"1\"";
                                                                                                                                                                if ($method["method_type"] == 1) {
                                                                                                                                                                    $return .= "selected";
                                                                                                                                                                }
                                                                                                                                                                $return .= ">Pasif</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Görünür adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                                                                                            } else {
                                                                                                                                                                if ($action == "new_paymentbonus") {
                                                                                                                                                                    $methodList = $conn->prepare("SELECT * FROM payment_methods WHERE id!='7' ");
                                                                                                                                                                    $methodList->execute([]);
                                                                                                                                                                    $methodList = $methodList->fetchAll(PDO::FETCH_ASSOC);
                                                                                                                                                                    $return = "<form class=\"form\" action=\"" . base_url("admin/settings/payment-bonuses/new") . "\" method=\"post\" data-xhr=\"true\">\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n          <label>Method</label>\r\n            <select class=\"form-control\" name=\"method_type\">";
                                                                                                                                                                    foreach ($methodList as $method) {
                                                                                                                                                                        $return .= "<option value=\"" . $method["id"] . "\">" . $method["method_name"] . "</option>";
                                                                                                                                                                    }
                                                                                                                                                                    $return .= "</select>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group\">Bonus tutarı (%)</label>\r\n            <input type=\"text\" name=\"amount\" class=\"form-control\" value=\"\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group\">İtibaren (<i class=\"fa fa-try\"></i>)</label>\r\n            <input type=\"text\" name=\"from\" class=\"form-control\" value=\"\">\r\n          </div>\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Yeni bonusu ekle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                    echo json_encode(["content" => $return, "title" => "Yeni ödeme bonusu"]);
                                                                                                                                                                } else {
                                                                                                                                                                    if ($action == "payment_bankedit") {
                                                                                                                                                                        $id = $_POST["id"];
                                                                                                                                                                        $payment = $conn->prepare("SELECT * FROM payments INNER JOIN bank_accounts ON bank_accounts.id=payments.payment_bank INNER JOIN clients ON clients.client_id=payments.client_id WHERE payments.payment_id=:id");
                                                                                                                                                                        $payment->execute(["id" => $id]);
                                                                                                                                                                        $payment = $payment->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                        $bank = $conn->prepare("SELECT * FROM bank_accounts ");
                                                                                                                                                                        $bank->execute();
                                                                                                                                                                        $bank = $bank->fetchAll(PDO::FETCH_ASSOC);
                                                                                                                                                                        $return = "<form class=\"form\" action=\"" . base_url("admin/payments/edit-bank/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Ödeme yapılan banka</label>\r\n              <select class=\"form-control\" name=\"bank\">";
                                                                                                                                                                        foreach ($bank as $banka) {
                                                                                                                                                                            $return .= "<option value=\"" . $banka["id"] . "\"";
                                                                                                                                                                            if ($payment["payment_bank"] == $banka["id"]) {
                                                                                                                                                                                $return .= "selected";
                                                                                                                                                                            }
                                                                                                                                                                            $return .= ">" . $banka["bank_name"] . "</option>";
                                                                                                                                                                        }
                                                                                                                                                                        $return .= "</select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Ödeme durumu</label>\r\n              <select class=\"form-control\" ";
                                                                                                                                                                        if ($payment["payment_status"] == 3) {
                                                                                                                                                                            $return .= "disabled";
                                                                                                                                                                        }
                                                                                                                                                                        $return .= " name=\"status\">\r\n                    <option value=\"1\"";
                                                                                                                                                                        if ($payment["payment_status"] == 1) {
                                                                                                                                                                            $return .= "selected";
                                                                                                                                                                        }
                                                                                                                                                                        $return .= ">Beklemede</option>\r\n                    <option value=\"2\"";
                                                                                                                                                                        if ($payment["payment_status"] == 2) {
                                                                                                                                                                            $return .= "selected";
                                                                                                                                                                        }
                                                                                                                                                                        $return .= ">İptal</option>\r\n                    <option value=\"3\"";
                                                                                                                                                                        if ($payment["payment_status"] == 3) {
                                                                                                                                                                            $return .= "selected";
                                                                                                                                                                        }
                                                                                                                                                                        $return .= ">Onaylandı</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">NOT</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"note\" value=\"" . $payment["payment_note"] . "\">\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                        echo json_encode(["content" => $return, "title" => "Banka ödemesi düzenle (ID: " . $id . ") "]);
                                                                                                                                                                    } else {
                                                                                                                                                                        if ($action == "payment_banknew") {
                                                                                                                                                                            $bank = $conn->prepare("SELECT * FROM bank_accounts ");
                                                                                                                                                                            $bank->execute();
                                                                                                                                                                            $bank = $bank->fetchAll(PDO::FETCH_ASSOC);
                                                                                                                                                                            $return = "<form class=\"form\" action=\"" . base_url("admin/payments/new-bank/") . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Kullanıcı adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"username\" value=\"\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Tutar</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"amount\" value=\"\">\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Ödeme yapılan banka</label>\r\n              <select class=\"form-control\" name=\"bank\">";
                                                                                                                                                                            foreach ($bank as $banka) {
                                                                                                                                                                                $return .= "<option value=\"" . $banka["id"] . "\">" . $banka["bank_name"] . "</option>";
                                                                                                                                                                            }
                                                                                                                                                                            $return .= "</select>\r\n            </div>\r\n          </div>\r\n\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">NOT</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"note\" value=\"\">\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ödeme ekle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                            echo json_encode(["content" => $return, "title" => "Banka ödemesi ekle"]);
                                                                                                                                                                        } else {
                                                                                                                                                                            if ($action == "edit_paymentbonus") {
                                                                                                                                                                                $id = $_POST["id"];
                                                                                                                                                                                $bonus = $conn->prepare("SELECT * FROM payments_bonus WHERE bonus_id=:id ");
                                                                                                                                                                                $bonus->execute(["id" => $id]);
                                                                                                                                                                                $bonus = $bonus->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                $methodList = $conn->prepare("SELECT * FROM payment_methods  WHERE id!='7' ");
                                                                                                                                                                                $methodList->execute([]);
                                                                                                                                                                                $methodList = $methodList->fetchAll(PDO::FETCH_ASSOC);
                                                                                                                                                                                $return = "<form class=\"form\" action=\"" . base_url("admin/settings/payment-bonuses/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n          <label>Method</label>\r\n            <select class=\"form-control\" name=\"method_type\">";
                                                                                                                                                                                foreach ($methodList as $method) {
                                                                                                                                                                                    $return .= "<option value=\"" . $method["id"] . "\"";
                                                                                                                                                                                    if ($bonus["bonus_method"] == $method["id"]) {
                                                                                                                                                                                        $return .= "selected";
                                                                                                                                                                                    }
                                                                                                                                                                                    $return .= ">" . $method["method_name"] . "</option>";
                                                                                                                                                                                }
                                                                                                                                                                                $return .= "</select>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group\">Bonus tutarı (%)</label>\r\n            <input type=\"text\" name=\"amount\" class=\"form-control\" value=\"" . $bonus["bonus_amount"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group\">İtibaren (<i class=\"fa fa-try\"></i>)</label>\r\n            <input type=\"text\" name=\"from\" class=\"form-control\" value=\"" . $bonus["bonus_from"] . "\">\r\n          </div>\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Bonusu güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>  \r\n            <a id=\"delete-row\" data-url=\"" . base_url("admin/settings/payment-bonuses/delete/" . $bonus["bonus_id"]) . "\" class=\"btn btn-link pull-right deactivate-integration-btn\">Bonusu kaldır</a>\r\n\r\n          </div>\r\n          </form>\r\n          <script src=\"https://unpkg.com/sweetalert/dist/sweetalert.min.js\"></script>\r\n          <script>\r\n          \$(\"#delete-row\").click(function(){\r\n            var action = \$(this).attr(\"data-url\");\r\n            swal({\r\n              title: \"Silmek istediğinizden emin misiniz?\",\r\n              text: \"Eğer onaylarsanız bu içerik silinecek, bunu geri getirmek mümkün olmayabilir.\",\r\n              icon: \"warning\",\r\n              buttons: true,\r\n              dangerMode: true,\r\n              buttons: [\"Vazgeç\", \"Evet, eminim!\"],\r\n            })\r\n            .then((willDelete) => {\r\n              if (willDelete) {\r\n                \$.ajax({\r\n                  url:  action,\r\n                  type: \"GET\",\r\n                  dataType: \"json\",\r\n                  cache: false,\r\n                  contentType: false,\r\n                  processData: false\r\n                })\r\n                .done(function(result){\r\n                  if( result.s == \"error\" ){\r\n                    var heading = \"Başarısız\";\r\n                  }else{\r\n                    var heading = \"Başarılı\";\r\n                  }\r\n                    \$.toast({\r\n                        heading: heading,\r\n                        text: result.m,\r\n                        icon: result.s,\r\n                        loader: true,\r\n                        loaderBg: \"#9EC600\"\r\n                    });\r\n                    if (result.r!=null) {\r\n                      if( result.time ==null ){ result.time = 3; }\r\n                      setTimeout(function(){\r\n                        window.location.href  = result.r;\r\n                      },result.time*1000);\r\n                    }\r\n                })\r\n                .fail(function(){\r\n                  \$.toast({\r\n                      heading: \"Başarısız\",\r\n                      text: \"İstek gerçekleştirilemedi\",\r\n                      icon: \"error\",\r\n                      loader: true,\r\n                      loaderBg: \"#9EC600\"\r\n                  });\r\n                });\r\n                /* İçerik silinmesi onaylandı */\r\n              } else {\r\n                \$.toast({\r\n                    heading: \"Başarısız\",\r\n                    text: \"Silinme istediği reddedildi\",\r\n                    icon: \"error\",\r\n                    loader: true,\r\n                    loaderBg: \"#9EC600\"\r\n                });\r\n              }\r\n            });\r\n          });\r\n          </script>\r\n          ";
                                                                                                                                                                                echo json_encode(["content" => $return, "title" => "Ödeme bonusu güncelle"]);
                                                                                                                                                                            } else {
                                                                                                                                                                                if ($action == "new_provider") {
                                                                                                                                                                                    $return = "<form class=\"form\" action=\"" . base_url("admin/settings/providers/new") . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">API URL</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"url\" value=\"\">\r\n          </div>\r\n          \r\n                    <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">API Key</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"key\" value=\"\">\r\n          </div>\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Sağlayıcıyı ekle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                                    echo json_encode(["content" => $return, "title" => "Yeni sağlayıcı ekle"]);
                                                                                                                                                                                } else {
                                                                                                                                                                                    if ($action == "edit_provider") {
                                                                                                                                                                                        $id = $_POST["id"];
                                                                                                                                                                                        $provider = $conn->prepare("SELECT * FROM service_api WHERE id=:id ");
                                                                                                                                                                                        $provider->execute(["id" => $id]);
                                                                                                                                                                                        $provider = $provider->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                        $services = $conn->prepare("SELECT * FROM services WHERE service_api=:api");
                                                                                                                                                                                        $services->execute(["api" => $id]);
                                                                                                                                                                                        if ($settings["guard_apikey_type"] == 2 && $settings["guard_system_status"] == 2) {
                                                                                                                                                                                            $key = crypt(crc32(md5(sha1(str_rot13(base64_encode($provider["api_key"]))))));
                                                                                                                                                                                        } else {
                                                                                                                                                                                            $key = $provider["api_key"];
                                                                                                                                                                                        }
                                                                                                                                                                                        $return = "<form class=\"form\" action=\"" . base_url("admin/settings/providers/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Sağlayıcı Adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $provider["api_name"] . "\">\r\n          </div>\r\n<hr>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">API URL</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"url\" value=\"" . $provider["api_url"] . "\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">API Key</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"apikey\" value=\"" . $key . "\">\r\n          </div>\r\n<hr>\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Bakiye Limit <small>(Bakiyeniz bu tutarın altına düşerse bildirim alacaksınız)</small></label>\r\n            <input type=\"text\" class=\"form-control\" name=\"limit\" value=\"" . $provider["api_limit"] . "\">\r\n          </div>\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n         <button type=\"submit\" class=\"btn btn-primary\">Güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>";
                                                                                                                                                                                        if (!$services->rowCount()) {
                                                                                                                                                                                            $return .= " <a id=\"delete-row\" data-url=\"" . base_url("admin/settings/providers/delete/" . $provider["id"]) . "\" class=\"btn btn-link pull-right deactivate-integration-btn\">Sağlayıcıyı Sil</a>";
                                                                                                                                                                                        }
                                                                                                                                                                                        $return .= "\r\n          </div>\r\n          </form>\r\n          \r\n               <script src=\"https://unpkg.com/sweetalert/dist/sweetalert.min.js\"></script>\r\n          <script>\r\n          \$(\"#delete-row\").click(function(){\r\n            var action = \$(this).attr(\"data-url\");\r\n            swal({\r\n              title: \"Silmek istediğinizden emin misiniz?\",\r\n              text: \"Eğer onaylarsanız bu içerik silinecek, bunu geri getirmek mümkün olmayabilir.\",\r\n              icon: \"warning\",\r\n              buttons: true,\r\n              dangerMode: true,\r\n              buttons: [\"Vazgeç\", \"Evet, eminim!\"],\r\n            })\r\n            .then((willDelete) => {\r\n              if (willDelete) {\r\n                \$.ajax({\r\n                  url:  action,\r\n                  type: \"GET\",\r\n                  dataType: \"json\",\r\n                  cache: false,\r\n                  contentType: false,\r\n                  processData: false\r\n                })\r\n                .done(function(result){\r\n                  if( result.s == \"error\" ){\r\n                    var heading = \"Başarısız\";\r\n                  }else{\r\n                    var heading = \"Başarılı\";\r\n                  }\r\n                    \$.toast({\r\n                        heading: heading,\r\n                        text: result.m,\r\n                        icon: result.s,\r\n                        loader: true,\r\n                        loaderBg: \"#9EC600\"\r\n                    });\r\n                    if (result.r!=null) {\r\n                      if( result.time ==null ){ result.time = 3; }\r\n                      setTimeout(function(){\r\n                        window.location.href  = result.r;\r\n                      },result.time*1000);\r\n                    }\r\n                })\r\n                .fail(function(){\r\n                  \$.toast({\r\n                      heading: \"Başarısız\",\r\n                      text: \"İstek gerçekleştirilemedi\",\r\n                      icon: \"error\",\r\n                      loader: true,\r\n                      loaderBg: \"#9EC600\"\r\n                  });\r\n                });\r\n                /* İçerik silinmesi onaylandı */\r\n              } else {\r\n                \$.toast({\r\n                    heading: \"Başarısız\",\r\n                    text: \"Silinme istediği reddedildi\",\r\n                    icon: \"error\",\r\n                    loader: true,\r\n                    loaderBg: \"#9EC600\"\r\n                });\r\n              }\r\n            });\r\n          });\r\n          </script>";
                                                                                                                                                                                        echo json_encode(["content" => $return, "title" => "Sağlayıcı düzenle (" . $provider["api_name"] . ") "]);
                                                                                                                                                                                    } else {
                                                                                                                                                                                        if ($action == "new_news") {
                                                                                                                                                                                            $return = "<form class=\"form\" action=\"" . base_url("admin/appearance/news/new") . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n        \r\n     <div class=\"form-group\">\r\n                            <label class=\"control-label\" for=\"createorderform-currency\">Duyuru İkonu</label>\r\n                            <select class=\"form-control\" name=\"icon\">\r\n                            <option value=\"duyuru\">Genel Duyuru</option>\r\n                            <option value=\"yildiz\">Yıldız</option>\r\n                            <option value=\"instagram\">Instagram</option>\r\n                            <option value=\"facebook\">Facebook</option>\r\n                            <option value=\"youtube\">Youtube</option>\r\n                            <option value=\"twitter\">Twitter</option>\r\n                            <option value=\"tiktok\">TikTok</option>  \r\n                            <option value=\"spotify\">Spotify</option>\r\n                            <option value=\"pinterest\">Pinterest</option>\r\n                            <option value=\"telegram\">Telegram</option>\r\n                            <option value=\"twitch\">Twitch</option>\r\n\r\n                                                            </select>\r\n                        </div>\r\n                        \r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Duyuru Başlığı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"title\"></textarea>\r\n          </div>\r\n          \r\n        <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Duyuru İçeriği</label>\r\n            <textarea class=\"form-control\" name=\"content\"></textarea>\r\n          </div>\r\n</div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Duyuruyu ekle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                                            echo json_encode(["content" => $return, "title" => "Yeni duyuru ekle"]);
                                                                                                                                                                                        } else {
                                                                                                                                                                                            if ($action == "edit_news") {
                                                                                                                                                                                                $id = $_POST["id"];
                                                                                                                                                                                                $news = $conn->prepare("SELECT * FROM news WHERE id=:id ");
                                                                                                                                                                                                $news->execute(["id" => $id]);
                                                                                                                                                                                                $news = $news->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                                $return = "<form class=\"form\" action=\"" . base_url("admin/appearance/news/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n     <div class=\"form-group\">\r\n                            <label class=\"control-label\" for=\"createorderform-currency\">Duyuru İkonu</label>\r\n                            <select class=\"form-control\" name=\"icon\">\r\n                            <option value=\"" . $news["news_icon"] . "\">Seçili: " . $news["news_icon"] . "</option>\r\n                            <option value=\"duyuru\">Genel Duyuru</option>\r\n                            <option value=\"yildiz\">Yıldız</option>\r\n                            <option value=\"instagram\">Instagram</option>\r\n                            <option value=\"facebook\">Facebook</option>\r\n                            <option value=\"youtube\">Youtube</option>\r\n                            <option value=\"twitter\">Twitter</option>\r\n                            <option value=\"tiktok\">TikTok</option>  \r\n                            <option value=\"spotify\">Spotify</option>\r\n                            <option value=\"pinterest\">Pinterest</option>\r\n                            <option value=\"telegram\">Telegram</option>\r\n                            <option value=\"twitch\">Twitch</option>\r\n                                                            </select>\r\n                        </div>\r\n                        \r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Duyuru Başlığı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"title\" value=\"" . $news["news_title"] . "\"></textarea>\r\n          </div>\r\n          \r\n        <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Duyuru İçeriği</label>\r\n            <textarea class=\"form-control\" name=\"content\" rows=\"7\" >" . $news["news_content"] . "</textarea>\r\n          </div>\r\n\r\n\r\n          \r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n         <button type=\"submit\" class=\"btn btn-primary\">Güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n         \r\n      <a id=\"delete-row\" data-url=\"" . base_url("admin/appearance/news/delete/" . $news["id"]) . "\" class=\"btn btn-link pull-right deactivate-integration-btn\">Duyuruyu Sil</a>\r\n          \r\n          </div>\r\n          </form>\r\n          \r\n               <script src=\"https://unpkg.com/sweetalert/dist/sweetalert.min.js\"></script>\r\n          <script>\r\n          \$(\"#delete-row\").click(function(){\r\n            var action = \$(this).attr(\"data-url\");\r\n            swal({\r\n              title: \"Silmek istediğinizden emin misiniz?\",\r\n              text: \"Eğer onaylarsanız bu içerik silinecek, bunu geri getirmek mümkün olmayabilir.\",\r\n              icon: \"warning\",\r\n              buttons: true,\r\n              dangerMode: true,\r\n              buttons: [\"Vazgeç\", \"Evet, eminim!\"],\r\n            })\r\n            .then((willDelete) => {\r\n              if (willDelete) {\r\n                \$.ajax({\r\n                  url:  action,\r\n                  type: \"GET\",\r\n                  dataType: \"json\",\r\n                  cache: false,\r\n                  contentType: false,\r\n                  processData: false\r\n                })\r\n                .done(function(result){\r\n                  if( result.s == \"error\" ){\r\n                    var heading = \"Başarısız\";\r\n                  }else{\r\n                    var heading = \"Başarılı\";\r\n                  }\r\n                    \$.toast({\r\n                        heading: heading,\r\n                        text: result.m,\r\n                        icon: result.s,\r\n                        loader: true,\r\n                        loaderBg: \"#9EC600\"\r\n                    });\r\n                    if (result.r!=null) {\r\n                      if( result.time ==null ){ result.time = 3; }\r\n                      setTimeout(function(){\r\n                        window.location.href  = result.r;\r\n                      },result.time*1000);\r\n                    }\r\n                })\r\n                .fail(function(){\r\n                  \$.toast({\r\n                      heading: \"Başarısız\",\r\n                      text: \"İstek gerçekleştirilemedi\",\r\n                      icon: \"error\",\r\n                      loader: true,\r\n                      loaderBg: \"#9EC600\"\r\n                  });\r\n                });\r\n                /* İçerik silinmesi onaylandı */\r\n              } else {\r\n                \$.toast({\r\n                    heading: \"Başarısız\",\r\n                    text: \"Silinme istediği reddedildi\",\r\n                    icon: \"error\",\r\n                    loader: true,\r\n                    loaderBg: \"#9EC600\"\r\n                });\r\n              }\r\n            });\r\n          });\r\n          </script>";
                                                                                                                                                                                                echo json_encode(["content" => $return, "title" => "Duyuru Düzenle (" . $news["news_title"] . ") "]);
                                                                                                                                                                                            } else {
                                                                                                                                                                                                if ($action == "export_user") {
                                                                                                                                                                                                    $return = "<form class=\"form\" action=\"" . base_url("admin/clients/export") . "\" method=\"post\">\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Üyelik Statu</label>\r\n              <select class=\"form-control\" name=\"client_status\">\r\n                    <option value=\"all\">Tüm üyeler</option>\r\n                    <option value=\"1\">Pasif</option>\r\n                    <option value=\"2\">Aktif</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Email Statu</label>\r\n              <select class=\"form-control\" name=\"email_status\">\r\n                    <option value=\"all\">Tüm üyeler</option>\r\n                    <option value=\"1\">Onaysız</option>\r\n                    <option value=\"2\">Onaylı</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Format</label>\r\n              <select class=\"form-control\" name=\"format\">\r\n                    <option value=\"json\">JSON</option>\r\n                </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Üye bilgileri</label>\r\n              <div class=\"form-group\">\r\n                  <label class=\"checkbox-inline\">\r\n                    <input type=\"checkbox\" class=\"access\" name=\"exportcolumn[client_id]\" checked value=\"1\"> ID\r\n                  </label>\r\n                  <label class=\"checkbox-inline\">\r\n                    <input type=\"checkbox\" class=\"access\" name=\"exportcolumn[email]\" checked value=\"1\"> Email\r\n                  </label>\r\n                  <label class=\"checkbox-inline\">\r\n                    <input type=\"checkbox\" class=\"access\" name=\"exportcolumn[name]\" checked value=\"1\"> Ad Soyad\r\n                  </label>\r\n                  <label class=\"checkbox-inline\">\r\n                    <input type=\"checkbox\" class=\"access\" name=\"exportcolumn[username]\" checked value=\"1\"> Kullanıcı adı\r\n                  </label>\r\n                  <label class=\"checkbox-inline\">\r\n                    <input type=\"checkbox\" class=\"access\" name=\"exportcolumn[telephone]\" checked value=\"1\"> Telefon numarası\r\n                  </label>\r\n                  <label class=\"checkbox-inline\">\r\n                    <input type=\"checkbox\" class=\"access\" name=\"exportcolumn[balance]\" checked value=\"1\"> Bakiye\r\n                  </label>\r\n                  <label class=\"checkbox-inline\">\r\n                    <input type=\"checkbox\" class=\"access\" name=\"exportcolumn[spent]\" checked value=\"1\"> Harcama\r\n                  </label>\r\n                  <label class=\"checkbox-inline\">\r\n                    <input type=\"checkbox\" class=\"access\" name=\"exportcolumn[register_date]\" checked value=\"1\"> Kayıt tarihi\r\n                  </label>\r\n                  <label class=\"checkbox-inline\">\r\n                    <input type=\"checkbox\" class=\"access\" name=\"exportcolumn[login_date]\" checked value=\"1\"> Son giriş tarihi\r\n                  </label>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Kullanıcıları yedekle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                                                    echo json_encode(["content" => $return, "title" => "Kullanıcıları yedekle"]);
                                                                                                                                                                                                } else {
                                                                                                                                                                                                    if ($action == "all_numbers") {
                                                                                                                                                                                                        $rows = $conn->prepare("SELECT * FROM clients");
                                                                                                                                                                                                        $rows->execute([]);
                                                                                                                                                                                                        $rows = $rows->fetchAll(PDO::FETCH_ASSOC);
                                                                                                                                                                                                        $numbers = "";
                                                                                                                                                                                                        $emails = "";
                                                                                                                                                                                                        foreach ($rows as $row) {
                                                                                                                                                                                                            if ($row["telephone"]) {
                                                                                                                                                                                                                $numbers .= $row["telephone"] . "\n";
                                                                                                                                                                                                            }
                                                                                                                                                                                                            $emails .= $row["email"] . "\n";
                                                                                                                                                                                                        }
                                                                                                                                                                                                        $return = "<form>\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Üye Telefon Numaraları</label>\r\n              <textarea class=\"form-control\" rows=\"8\" readonly>" . $numbers . "</textarea>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Üye E-mail Adresleri</label>\r\n              <textarea class=\"form-control\" rows=\"8\" readonly>" . $emails . "</textarea>\r\n            </div>\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                                                        echo json_encode(["content" => $return, "title" => "Kullanıcı Bilgileri"]);
                                                                                                                                                                                                    } else {
                                                                                                                                                                                                        if ($action == "details") {
                                                                                                                                                                                                            $toplamkullanici = $conn->prepare("SELECT * FROM clients");
                                                                                                                                                                                                            $toplamkullanici->execute();
                                                                                                                                                                                                            $toplamkullanici = $toplamkullanici->rowCount();
                                                                                                                                                                                                            $query = $conn->query("SELECT sum(balance) as toplambakiye FROM clients")->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                                            $query2 = $conn->query("SELECT sum(order_charge) as order_charge FROM orders")->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                                            $negatifbakiye = $conn->prepare("SELECT * FROM clients where balance < 0");
                                                                                                                                                                                                            $negatifbakiye->execute();
                                                                                                                                                                                                            $negatifbakiye = $negatifbakiye->rowCount();
                                                                                                                                                                                                            $bakiyesiz = $conn->prepare("SELECT * FROM clients where balance = 0");
                                                                                                                                                                                                            $bakiyesiz->execute();
                                                                                                                                                                                                            $bakiyesiz = $bakiyesiz->rowCount();
                                                                                                                                                                                                            $return = "<form>\r\n        <div class=\"modal-body\">\r\n\t\t\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Toplam Kullanıcı : " . $toplamkullanici . "</label>\r\n            </div>\r\n          </div>\r\n\t\t  \r\n\t\t  <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Toplam Kullanılabilir Bakiye : " . $query["toplambakiye"] . "</label>\r\n            </div>\r\n          </div>\r\n\t\t  \r\n\t\t  <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Toplam Harcanan Bakiye : " . $query2["order_charge"] . "</label>\r\n            </div>\r\n          </div>\r\n\t\t  \r\n\t\t  <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Negatif Bakiyeli Kullanıcı : " . $negatifbakiye . "</label>\r\n            </div>\r\n          </div>\r\n\t\t  \r\n\t\t  <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Bakiyesi Sıfır Olan Kullanıcı : " . $bakiyesiz . "</label>\r\n            </div>\r\n          </div>\r\n\t\t  \r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                                                            echo json_encode(["content" => $return, "title" => "Detaylar"]);
                                                                                                                                                                                                        } else {
                                                                                                                                                                                                            if ($action == "price_user") {
                                                                                                                                                                                                                $id = $_POST["id"];
                                                                                                                                                                                                                $price = $conn->prepare("SELECT *,services.service_id as serviceid,services.service_price as price,clients_price.service_price as clientprice FROM services LEFT JOIN clients_price ON clients_price.service_id=services.service_id && clients_price.client_id=:id ");
                                                                                                                                                                                                                $price->execute(["id" => $id]);
                                                                                                                                                                                                                $price = $price->fetchAll(PDO::FETCH_ASSOC);
                                                                                                                                                                                                                $return = "<form class=\"form\" action=\"" . base_url("admin/clients/price/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n        <div class=\"modal-body\">\r\n\r\n        <div class=\"majer\">\r\n               <div>\r\n                  <div class=\"services-import__list-wrap services-import__list-active\">\r\n                     <div class=\"services-import__scroll-wrap\">\r\n                        <span>\r\n                             <div class=\"services-import__packages\">\r\n                                <ul>";
                                                                                                                                                                                                                foreach ($price as $row) {
                                                                                                                                                                                                                    $return .= "<li id=\"service-" . $row["serviceid"] . "\">\r\n                                     <label class=\"row\" style=\"margin:0\">\r\n                                     <p class=\"col-md-8 col-xs-10\" style=\"margin-top:5px;padding:0px;\">\r\n                                        <span class=\"label-id\" style=\"margin-right:7px\">" . $row["serviceid"] . "</span>" . $row["service_name"] . "</p>\r\n                                        \r\n                                           <span class=\"col-md-1 col-xs-2\" style=\"margin-top:5px\">" . $row["price"] . "</span>\r\n                                        <span class=\"col-md-2 col-xs-10\" >\r\n                                        <div class=\"input-group\" style=\"width:100%\">\r\n                                           <input type=\"text\" style=\"border-radius:5px\" class=\"form_field field_price form-control\" name=\"price[" . $row["serviceid"] . "]\" value=\"" . $row["clientprice"] . "\">\r\n                                           </div>\r\n                                        </span>\r\n                                        \r\n                                           <div class=\"col-md-1 col-xs-2\" style=\"text-align:right;font-size:17px;top:5;right:17px;\"  data-id=\"servicedelete-" . $row["serviceid"] . "\" data-service=\"" . $row["serviceid"] . "\">\r\n                                             <span class=\"fa fa-trash\"></span>\r\n                                           </div>\r\n                                        \r\n                                        \r\n                                     </label>\r\n                                    </li>";
                                                                                                                                                                                                                }
                                                                                                                                                                                                                $return .= "</ul>\r\n                             </div>\r\n                          </span></div>\r\n                  </div>\r\n               </div>\r\n            </div>\r\n            <script>\r\n\r\n              \$('[data-id^=\"servicedelete-\"]').click(function(){\r\n                var id        = \$(this).attr(\"data-service\");\r\n                \$(\"[name='price[\"+id+\"]']\").val(\"\");\r\n                //\$(\"ul > li#service-\"+id).remove();\r\n              });\r\n\r\n            </script>\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                                                                echo json_encode(["content" => $return, "title" => "Özel Fiyatlandırma"]);
                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                if ($action == "order_errors") {
                                                                                                                                                                                                                    $id = $_POST["id"];
                                                                                                                                                                                                                    $row = $conn->prepare("SELECT * FROM orders WHERE order_id=:id ");
                                                                                                                                                                                                                    $row->execute(["id" => $id]);
                                                                                                                                                                                                                    $row = $row->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                                                    $errors = json_decode($row["order_error"]);
                                                                                                                                                                                                                    $return = "<form>\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Sağlayıcıdan gelen bilgi</label>\r\n              <textarea class=\"form-control\" rows=\"8\" readonly>";
                                                                                                                                                                                                                    $return .= print_r($errors, true);
                                                                                                                                                                                                                    $return .= "</textarea>\r\n            </div>\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n     ";
                                                                                                                                                                                                                    $services = new \App\Models\services();
                                                                                                                                                                                                                    $servis_bul = $services->where("service_id", $row['service_id'])->get()->getResultArray()[0];
                                                                                                                                                                                                                    if ($servis_bul['birlestirme']) {
                                                                                                                                                                                                                        $detail = json_decode($row["order_error2"]);
                                                                                                                                                                                                                        $return .= "\r\n      <textarea class=\"form-control\" rows=\"8\" readonly>";
                                                                                                                                                                                                                        $return .= print_r($detail, true);
                                                                                                                                                                                                                        $return .= "</textarea>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Sipariş ID</label>\r\n              <input class=\"form-control\" value=\"" . $row["api_orderid2"] . "\" readonly>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Son güncelleme</label>\r\n              <input class=\"form-control\" value=\"" . $row["last_check"] . "\" readonly>\r\n            </div>\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n         ";
                                                                                                                                                                                                                    }
                                                                                                                                                                                                                    $return .= " <div class=\"modal-footer\">\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";

                                                                                                                                                                                                                    echo json_encode(["content" => $return, "title" => "Hata detayları (ID: " . $row["order_id"] . ") "]);
                                                                                                                                                                                                                } else {
                                                                                                                                                                                                                    if ($action == "order_comment") {
                                                                                                                                                                                                                        $id = $_POST["id"];
                                                                                                                                                                                                                        $row = $conn->prepare("SELECT * FROM orders WHERE order_id=:id ");
                                                                                                                                                                                                                        $row->execute(["id" => $id]);
                                                                                                                                                                                                                        $row = $row->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                                                        $arr = json_decode($row["order_extras"], true);
                                                                                                                                                                                                                        $cnazede = $arr[array_key_first($arr)];
                                                                                                                                                                                                                        $return = "<form>\r\n        <div class=\"modal-body\">\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Ekstra</label>\r\n              <textarea class=\"form-control\" rows=\"8\" readonly>";
                                                                                                                                                                                                                        $return .= print_r($cnazede, true);
                                                                                                                                                                                                                        $return .= "</textarea>\r\n            </div>\r\n          </div>\r\n        </div>\r\n          <div class=\"modal-footer\">\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Kapat</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                                                                        echo json_encode(["content" => $return, "title" => "Ekstra"]);
                                                                                                                                                                                                                    } else {
                                                                                                                                                                                                                        if ($action == "order_details") {
                                                                                                                                                                                                                            $id = $_POST["id"];
                                                                                                                                                                                                                            $row = $conn->prepare("SELECT * FROM orders WHERE order_id=:id ");
                                                                                                                                                                                                                            $row->execute(["id" => $id]);
                                                                                                                                                                                                                            $row = $row->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                                                            $detail = json_decode($row["order_detail"]);
                                                                                                                                                                                                                            $return = "<form>\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Sağlayıcıdan gelen bilgi</label>\r\n              <textarea class=\"form-control\" rows=\"8\" readonly>";
                                                                                                                                                                                                                            $return .= print_r($detail, true);
                                                                                                                                                                                                                            $return .= "</textarea>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Sipariş ID</label>\r\n              <input class=\"form-control\" value=\"" . $row["api_orderid"] . "\" readonly>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Son güncelleme</label>\r\n              <input class=\"form-control\" value=\"" . $row["last_check"] . "\" readonly>\r\n            </div>\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          ";

                                                                                                                                                                                                                            $services = new \App\Models\services();
                                                                                                                                                                                                                            $servis_bul = $services->where("service_id", $row['service_id'])->get()->getResultArray()[0];
                                                                                                                                                                                                                            if ($servis_bul['birlestirme']) {
                                                                                                                                                                                                                                $detail = json_decode($row["order_detail2"]);
                                                                                                                                                                                                                                $return .= "\r\n      <textarea class=\"form-control\" rows=\"8\" readonly>";
                                                                                                                                                                                                                                $return .= print_r($detail, true);
                                                                                                                                                                                                                                $return .= "</textarea>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Sipariş ID</label>\r\n              <input class=\"form-control\" value=\"" . $row["api_orderid2"] . "\" readonly>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Son güncelleme</label>\r\n              <input class=\"form-control\" value=\"" . $row["last_check"] . "\" readonly>\r\n            </div>\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n         ";
                                                                                                                                                                                                                            }
                                                                                                                                                                                                                            $return .= " <div class=\"modal-footer\">\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                                                                            echo json_encode(["content" => $return, "title" => "Sipariş detayları (ID: " . $row["order_id"] . ") "]);
                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                            if ($action == "order_orderurl") {
                                                                                                                                                                                                                                $id = $_POST["id"];
                                                                                                                                                                                                                                $row = $conn->prepare("SELECT * FROM orders WHERE order_id=:id ");
                                                                                                                                                                                                                                $row->execute(["id" => $id]);
                                                                                                                                                                                                                                $row = $row->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                                                                $detail = json_decode($row["order_detail"]);
                                                                                                                                                                                                                                $return = "<form class=\"form\" action=\"" . base_url("admin/orders/set_orderurl/" . $id) . "\" method=\"post\">\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Sipariş Bağlantısı</label>\r\n              <input class=\"form-control\" value=\"" . $row["order_url"] . "\" name=\"url\">\r\n            </div>\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                                                                                echo json_encode(["content" => $return, "title" => "Sipariş detayları (ID: " . $row["order_id"] . ") "]);
                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                if ($action == "order_startcount") {
                                                                                                                                                                                                                                    $id = $_POST["id"];
                                                                                                                                                                                                                                    $row = $conn->prepare("SELECT * FROM orders WHERE order_id=:id ");
                                                                                                                                                                                                                                    $row->execute(["id" => $id]);
                                                                                                                                                                                                                                    $row = $row->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                                                                    $detail = json_decode($row["order_detail"]);
                                                                                                                                                                                                                                    $return = "<form class=\"form\" action=\"" . base_url("admin/orders/set_startcount/" . $id) . "\" method=\"post\">\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Başlangıç sayısı</label>\r\n              <input class=\"form-control\" value=\"" . $row["order_start"] . "\" name=\"start\">\r\n            </div>\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                                                                                    echo json_encode(["content" => $return, "title" => "Sipariş detayları (ID: " . $row["order_id"] . ") "]);
                                                                                                                                                                                                                                } else {
                                                                                                                                                                                                                                    if ($action == "order_partial") {
                                                                                                                                                                                                                                        $id = $_POST["id"];
                                                                                                                                                                                                                                        $row = $conn->prepare("SELECT * FROM orders WHERE order_id=:id ");
                                                                                                                                                                                                                                        $row->execute(["id" => $id]);
                                                                                                                                                                                                                                        $row = $row->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                                                                        $detail = json_decode($row["order_detail"]);
                                                                                                                                                                                                                                        $return = "<form class=\"form\" action=\"" . base_url("admin/orders/set_partial/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Gitmeyen miktar</label>\r\n              <input class=\"form-control\" name=\"remains\">\r\n            </div>\r\n          </div>\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                                                                                        echo json_encode(["content" => $return, "title" => "Sipariş detayları (ID: " . $row["order_id"] . ") "]);
                                                                                                                                                                                                                                    } else {
                                                                                                                                                                                                                                        if ($action == "subscriptions_expiry") {
                                                                                                                                                                                                                                            $id = $_POST["id"];
                                                                                                                                                                                                                                            $row = $conn->prepare("SELECT * FROM orders WHERE order_id=:id ");
                                                                                                                                                                                                                                            $row->execute(["id" => $id]);
                                                                                                                                                                                                                                            $row = $row->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                                                                            $detail = json_decode($row["order_detail"]);
                                                                                                                                                                                                                                            $return = "<form class=\"form\" action=\"" . base_url("admin/subscriptions/set_expiry/" . $id) . "\" method=\"post\">\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Başlangıç sayısı</label>\r\n              <input class=\"form-control datetime\" value=\"";
                                                                                                                                                                                                                                            if ($row["subscriptions_expiry"] != "1970-01-01") {
                                                                                                                                                                                                                                                $return .= date("d/m/Y", strtotime($row["subscriptions_expiry"]));
                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                            $return .= "\" name=\"expiry\">\r\n            </div>\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>\r\n          <link rel=\"stylesheet\" type=\"text/css\" href=\"" . base_url("assets/js/") . "datepicker/css/bootstrap-datepicker3.min.css\">\r\n          <script type=\"text/javascript\" src=\"" . base_url("assets/js/") . "datepicker/js/bootstrap-datepicker.min.js\"></script>\r\n          <script type=\"text/javascript\" src=\"" . base_url("assets/js/") . "datepicker/locales/bootstrap-datepicker.tr.min.js\"></script>\r\n          ";
                                                                                                                                                                                                                                            echo json_encode(["content" => $return, "title" => "Abonelik bitiş tarihi (ID: " . $row["order_id"] . ") "]);
                                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                                            if ($action == "payment_edit") {
                                                                                                                                                                                                                                                $id = $_POST["id"];
                                                                                                                                                                                                                                                $payment = $conn->prepare("SELECT * FROM payments INNER JOIN clients ON clients.client_id=payments.client_id WHERE payments.payment_id=:id");
                                                                                                                                                                                                                                                $payment->execute(["id" => $id]);
                                                                                                                                                                                                                                                $payment = $payment->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                                                                                $methods = $conn->prepare("SELECT * FROM payment_methods WHERE id!='7' ");
                                                                                                                                                                                                                                                $methods->execute();
                                                                                                                                                                                                                                                $methods = $methods->fetchAll(PDO::FETCH_ASSOC);
                                                                                                                                                                                                                                                $return = "<form class=\"form\" action=\"" . base_url("admin/payments/edit-online/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Ödeme yöntemi</label>\r\n              <select class=\"form-control\" name=\"method\">";
                                                                                                                                                                                                                                                foreach ($methods as $method) {
                                                                                                                                                                                                                                                    $return .= "<option value=\"" . $method["id"] . "\"";
                                                                                                                                                                                                                                                    if ($payment["payment_method"] == $method["id"]) {
                                                                                                                                                                                                                                                        $return .= "selected";
                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                    $return .= ">" . $method["method_name"] . "</option>";
                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                $return .= "</select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">NOT</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"note\" value=\"" . $payment["payment_note"] . "\">\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                                                                                                echo json_encode(["content" => $return, "title" => "Online ödeme düzenle (ID: " . $id . ") "]);
                                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                                if ($action == "payment_new") {
                                                                                                                                                                                                                                                    $methods = $conn->prepare("SELECT * FROM payment_methods WHERE id!='7' ");
                                                                                                                                                                                                                                                    $methods->execute();
                                                                                                                                                                                                                                                    $methods = $methods->fetchAll(PDO::FETCH_ASSOC);
                                                                                                                                                                                                                                                    $return = "<form class=\"form\" action=\"" . base_url("admin/payments/new-online") . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Kullanıcı adı</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"username\" value=\"\">\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">Tutar</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"amount\" value=\"\">\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Ekle/Eksilt</label>\r\n              <select class=\"form-control\" name=\"add-remove\">\r\n                <option value=\"add\">Ekle</option>\r\n                <option value=\"remove\">Eksilt</option>\r\n            </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Ödeme yöntemi</label>\r\n              <select class=\"form-control\" name=\"method\">";
                                                                                                                                                                                                                                                    foreach ($methods as $method) {
                                                                                                                                                                                                                                                        $return .= "<option value=\"" . $method["id"] . "\">" . $method["method_name"] . "</option>";
                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                    $return .= "</select>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n            <label class=\"form-group__service-name\">NOT</label>\r\n            <input type=\"text\" class=\"form-control\" name=\"note\" value=\"\">\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Ödeme ekle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                                                                                                    echo json_encode(["content" => $return, "title" => "Online ödeme ekle"]);
                                                                                                                                                                                                                                                } else {
                                                                                                                                                                                                                                                    if ($action == "payment_detail") {
                                                                                                                                                                                                                                                        $id = $_POST["id"];
                                                                                                                                                                                                                                                        $row = $conn->prepare("SELECT * FROM payments WHERE payment_id=:id ");
                                                                                                                                                                                                                                                        $row->execute(["id" => $id]);
                                                                                                                                                                                                                                                        $row = $row->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                                                                                        $detail = json_decode($row["payment_extra"]);
                                                                                                                                                                                                                                                        $return = "<form>\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Ödeme bilgisi</label>\r\n              <textarea class=\"form-control\" rows=\"8\" readonly>";
                                                                                                                                                                                                                                                        $return .= print_r($detail, true);
                                                                                                                                                                                                                                                        $return .= "</textarea>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"service-mode__block\">\r\n            <div class=\"form-group\">\r\n            <label>Son güncelleme</label>\r\n              <input class=\"form-control\" value=\"" . $row["payment_update_date"] . "\" readonly>\r\n            </div>\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                                                                                                        echo json_encode(["content" => $return, "title" => "Ödeme detayları (ID: " . $row["payment_id"] . ") "]);
                                                                                                                                                                                                                                                    } else {
                                                                                                                                                                                                                                                        if ($action == "module_ref") {
                                                                                                                                                                                                                                                            $return = "<form class=\"form\" action=\"" . base_url("admin/settings/modules/ref") . "\" method=\"post\" data-xhr=\"true\">    \r\n        <div class=\"modal-body\">\r\n        <div class=\"form-group\">\r\n              <label class=\"control-label\">Referans Sistemi</label>\r\n              <select class=\"form-control\" name=\"referral\">\r\n                <option value=\"2\" ";
                                                                                                                                                                                                                                                            if ($settings["referral"] == 2) {
                                                                                                                                                                                                                                                                $return .= "selected";
                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                            $return .= ">Aktif</option>\r\n                <option value=\"1\" ";
                                                                                                                                                                                                                                                            if ($settings["referral"] == 1) {
                                                                                                                                                                                                                                                                $return .= "selected";
                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                            $return .= ">Pasif</option>\r\n              </select>\r\n            </div>\r\n              <hr />\r\n\t\t\t<div class=\"form-group\">\r\n              <label class=\"control-label\">Referans Bonusu %</label>\r\n              <input type=\"text\" class=\"form-control\" name=\"ref_bonus\" value=\"" . $settings["ref_bonus"] . "\">\r\n            </div>\r\n\t\t\t<div class=\"form-group\">\r\n              <label class=\"control-label\">Max Yükleme Tutarı (TL)</label>\r\n              <input type=\"text\" class=\"form-control\" name=\"ref_max\" value=\"" . $settings["ref_max"] . "\">\r\n\t\t\t  <p class=\"help-block\">\r\n                <small>Max kaç TL ye kadar yüklemelerde referans bonusu alınabilsin.</small>\r\n\t\t\t  </p>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"form-group\">\r\n              <label class=\"control-label\">Referans Tipi</label>\r\n              <select class=\"form-control\" name=\"ref_type\">\r\n                <option value=\"1\" ";
                                                                                                                                                                                                                                                            if ($settings["ref_type"] == 1) {
                                                                                                                                                                                                                                                                $return .= "selected";
                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                            $return .= ">İlk Yüklemede</option>\r\n                <option value=\"0\" ";
                                                                                                                                                                                                                                                            if ($settings["ref_type"] == 0) {
                                                                                                                                                                                                                                                                $return .= "selected";
                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                            $return .= ">Her Yüklemede</option>\r\n              </select>\r\n            </div>\r\n   \r\n        </div>\r\n\r\n          <div class=\"modal-footer\">            \r\n          <button type=\"submit\" class=\"btn btn-primary\">Ayarları Güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n          </form>";
                                                                                                                                                                                                                                                            echo json_encode(["content" => $return, "title" => "Referans Sistemi"]);
                                                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                                                            if ($action == "module_child") {
                                                                                                                                                                                                                                                                $return = "<form class=\"form\" action=\"" . base_url("admin/settings/modules/module_child") . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n     \r\n     <div class=\"form-group\">\r\n          <label class=\"control-label\">Child panel Satışı</label>\r\n          <select class=\"form-control\" name=\"panel_selling\">\r\n            <option value=\"2\" ";
                                                                                                                                                                                                                                                                if ($settings["panel_selling"] == 2) {
                                                                                                                                                                                                                                                                    $return .= "selected";
                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                $return .= ">Aktif</option>\r\n            <option value=\"1\" ";
                                                                                                                                                                                                                                                                if ($settings["panel_selling"] == 1) {
                                                                                                                                                                                                                                                                    $return .= "selected";
                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                $return .= ">Pasif</option>\r\n          </select>\r\n        </div>\r\n     \r\n     <div class=\"form-group\">\r\n              <label class=\"control-label\">Aylık Ücret</label>\r\n              <input type=\"text\" class=\"form-control\" name=\"panel_price\" value=\"" . $settings["panel_price"] . "\">\r\n            </div>\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">            \r\n          <button type=\"submit\" class=\"btn btn-primary\">Ayarları Güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n      </form>  ";
                                                                                                                                                                                                                                                                echo json_encode(["content" => $return, "title" => "Child Panel"]);
                                                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                                                if ($action == "module_balance") {
                                                                                                                                                                                                                                                                    $return = "<form class=\"form\" action=\"" . base_url("admin/settings/modules/module_balance") . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n     \r\n     <div class=\"form-group\">\r\n          <label class=\"control-label\">Ücretsiz Bakiye</label>\r\n          <select class=\"form-control\" name=\"free_balance\">\r\n            <option value=\"2\" ";
                                                                                                                                                                                                                                                                    if ($settings["free_balance"] == 2) {
                                                                                                                                                                                                                                                                        $return .= "selected";
                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                    $return .= ">Aktif</option>\r\n            <option value=\"1\" ";
                                                                                                                                                                                                                                                                    if ($settings["free_balance"] == 1) {
                                                                                                                                                                                                                                                                        $return .= "selected";
                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                    $return .= ">Pasif</option>\r\n          </select>\r\n        </div>\r\n     \r\n     <div class=\"form-group\">\r\n              <label class=\"control-label\">Hediye Tutarı</label>\r\n              <input type=\"text\" class=\"form-control\" name=\"free_amount\" value=\"" . $settings["free_amount"] . "\">\r\n            </div>\r\n\r\n        </div>\r\n\r\n          <div class=\"modal-footer\">            \r\n          <button type=\"submit\" class=\"btn btn-primary\">Ayarları Güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n      </form>  ";
                                                                                                                                                                                                                                                                    echo json_encode(["content" => $return, "title" => "Ücretsiz Bakiye"]);
                                                                                                                                                                                                                                                                } else {
                                                                                                                                                                                                                                                                    if ($action == "module_cache") {
                                                                                                                                                                                                                                                                        $return = "<form class=\"form\" action=\"" . base_url("admin/settings/modules/module_cache") . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n        <div class=\"modal-body\">\r\n\r\n     \r\n     <div class=\"form-group\">\r\n          <label class=\"control-label\">Cache Sistemi</label>\r\n          <select class=\"form-control\" name=\"cache\">\r\n            <option value=\"2\" ";
                                                                                                                                                                                                                                                                        if ($settings["cache"] == 2) {
                                                                                                                                                                                                                                                                            $return .= "selected";
                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                        $return .= ">Aktif</option>\r\n            <option value=\"1\" ";
                                                                                                                                                                                                                                                                        if ($settings["cache"] == 1) {
                                                                                                                                                                                                                                                                            $return .= "selected";
                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                        $return .= ">Pasif</option>\r\n          </select>\r\n        </div>\r\n     \r\n     <div class=\"form-group\">\r\n              <label class=\"control-label\">Cache Süresi (Saat)</label>\r\n              <input type=\"text\" class=\"form-control\" name=\"cache_time\" value=\"" . $settings["cache_time"] . "\">\r\n            </div>\r\n\r\n        </div>\r\n        \r\n        </div>\r\n\r\n          <div class=\"modal-footer\">            \r\n          <button type=\"submit\" class=\"btn btn-primary\">Ayarları Güncelle</button>\r\n            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n          </div>\r\n      </form>  ";
                                                                                                                                                                                                                                                                        echo json_encode(["content" => $return, "title" => "Cache Sistemi"]);
                                                                                                                                                                                                                                                                    } else {
                                                                                                                                                                                                                                                                        if ($action == "edit_code") {
                                                                                                                                                                                                                                                                            $id = $_POST["id"];
                                                                                                                                                                                                                                                                            $int = $conn->prepare("SELECT * FROM integrations WHERE id=:id");
                                                                                                                                                                                                                                                                            $int->execute(["id" => $id]);
                                                                                                                                                                                                                                                                            $int = $int->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                                                                                                            $return = "<form class=\"form\" action=\"" . base_url("admin/settings/integrations/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n\r\n       <div class=\"modal-body\">\r\n                                           <div class=\"form edit-integration-modal-body\">\r\n                                <div class=\"form-group field-editintegrationform-code\">\r\n            <label class=\"control-label\" for=\"editintegrationform-code\">Kod alanı</label>\r\n            <textarea id=\"editintegrationform-code\" class=\"form-control\" name=\"code\" rows=\"7\" placeholder=\"\">" . $int["code"] . "</textarea>\r\n            </div>                    <div class=\"form-group field-editintegrationform-visibility\">\r\n            <label class=\"control-label\" for=\"editintegrationform-visibility\">Görünürlük</label>\r\n            <select class=\"form-control\" name=\"visibility\">\r\n            <option value=\"1\" ";
                                                                                                                                                                                                                                                                            if ($int["visibility"] == 1) {
                                                                                                                                                                                                                                                                                $return .= "selected";
                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                            $return .= ">Tüm sayfalar</option>\r\n            <option value=\"2\" ";
                                                                                                                                                                                                                                                                            if ($int["visibility"] == 2) {
                                                                                                                                                                                                                                                                                $return .= "selected";
                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                            $return .= ">Giriş yapmayanlar</option>\r\n            <option value=\"3\" ";
                                                                                                                                                                                                                                                                            if ($int["visibility"] == 3) {
                                                                                                                                                                                                                                                                                $return .= "selected";
                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                            $return .= ">Giriş yapanlar</option>\r\n            </select>\r\n            </div>                </div>\r\n                        </div>\r\n                        <div class=\"modal-footer\">\r\n                            <button type=\"submit\" class=\"btn btn-primary\">\r\n                                Güncelle                </button>\r\n                            <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">\r\n                                Kapat                </button>\r\n                            <a href=\"/admin/settings/integrations/disabled/" . $id . "\" class=\"btn btn-link pull-right deactivate-integration-btn\">\r\n                                Pasifleştir\r\n                            </a>\r\n                        </div>\r\n                        </form>    ";
                                                                                                                                                                                                                                                                            echo json_encode(["content" => $return, "title" => "Entegrasyonu düzenle (ID: " . $id . ")"]);
                                                                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                                                                            if ($action == "edit_google") {
                                                                                                                                                                                                                                                                                $return = "<form class=\"form\" action=\"" . base_url("admin/settings/integrations/google") . "\" method=\"post\" data-xhr=\"true\">\r\n            \r\n                    <div class=\"modal-body\">\r\n\r\n                 \r\n                 <div class=\"form-group\">\r\n                          <label class=\"control-label\">Site Anahtarı</label>\r\n                          <input type=\"text\" class=\"form-control\" name=\"pwd\" value=\"" . $settings["recaptcha_key"] . "\">\r\n                        </div>\r\n            \r\n                        <div class=\"form-group\">\r\n                        <label class=\"control-label\">Gizli Anahtar</label>\r\n                        <input type=\"text\" class=\"form-control\" name=\"secret\" value=\"" . $settings["recaptcha_secret"] . "\">\r\n                      </div>\r\n                    </div>\r\n            \r\n                      <div class=\"modal-footer\">            \r\n                      <button type=\"submit\" class=\"btn btn-primary\">Ayarları Güncelle</button>\r\n                        <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n                      </div>\r\n                  </form>  ";
                                                                                                                                                                                                                                                                                echo json_encode(["content" => $return, "title" => "Google reCAPTCHA v2"]);
                                                                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                                                                if ($action == "edit_seo") {
                                                                                                                                                                                                                                                                                    $return = "<form class=\"form\" action=\"" . base_url("admin/settings/integrations/seo") . "\" method=\"post\" data-xhr=\"true\">\r\n            \r\n                    <div class=\"modal-body\">\r\n        <div class=\"form-group\">\r\n          <label for=\"\" class=\"control-label\">Title</label>\r\n          <input type=\"text\" class=\"form-control\" name=\"title\" value=\"" . $settings["site_title"] . "\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"\" class=\"control-label\">Keywords</label>\r\n          <input type=\"text\" class=\"form-control\" name=\"keywords\" value=\"" . $settings["site_keywords"] . "\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label class=\"control-label\">Description</label>\r\n          <textarea class=\"form-control\" rows=\"3\" name=\"description\">" . $settings["site_description"] . "</textarea>\r\n        </div>\r\n                      \r\n                      \r\n                    </div>\r\n            \r\n                      <div class=\"modal-footer\">            \r\n                      <button type=\"submit\" class=\"btn btn-primary\">Ayarları Güncelle</button>\r\n                        <button type=\"button\" class=\"btn btn-default\" data-bs-dismiss=\"modal\">Vazgeç</button>\r\n                      </div>\r\n                  </form>  ";
                                                                                                                                                                                                                                                                                    echo json_encode(["content" => $return, "title" => "SEO Ayarlamaları"]);
                                                                                                                                                                                                                                                                                } else {
                                                                                                                                                                                                                                                                                    if ($action == "edit_ticket") {
                                                                                                                                                                                                                                                                                        $id = $_POST["id"];
                                                                                                                                                                                                                                                                                        $tickets = $conn->prepare("SELECT * FROM ticket_reply WHERE id=:id");
                                                                                                                                                                                                                                                                                        $tickets->execute(["id" => $id]);
                                                                                                                                                                                                                                                                                        $tickets = $tickets->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                                                                                                                        $return = "<form class=\"form\" action=\"" . base_url("admin/tickets/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\r\n            \r\n                    <div class=\"modal-body\">\r\n        <div class=\"form-group\">\r\n          <label class=\"control-label\">Mesaj İçeriği</label>\r\n          <textarea class=\"form-control\" id=\"tinymce\" rows=\"5\" name=\"description\">" . $tickets["message"] . "</textarea>\r\n        </div>\r\n                    </div>\r\n                      <div class=\"modal-footer\">            \r\n                      <button type=\"submit\" class=\"btn btn-primary\">Güncelle</button>\r\n \r\n                      </div>\r\n                  </form>  ";
                                                                                                                                                                                                                                                                                        echo json_encode(["content" => $return, "title" => "Destek mesajı düzenle"]);
                                                                                                                                                                                                                                                                                    } elseif ($action == "ticketSend_provider") {

                                                                                                                                                                                                                                                                                        $id = $_POST["id"];
                                                                                                                                                                                                                                                                                        $tickets = $conn->prepare("SELECT * FROM ticket_reply WHERE id=:id");
                                                                                                                                                                                                                                                                                        $tickets->execute(["id" => $id]);

                                                                                                                                                                                                                                                                                        $tickets = $tickets->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                                                                                                                        $tics = new \App\Models\tickets();
                                                                                                                                                                                                                                                                                        $cek = $tics->where('ticket_id', $tickets['ticket_id'])->get()->getResultArray()[0];
                                                                                                                                                                                                                                                                                        if ($cek['panel_id'] != Null) {
                                                                                                                                                                                                                                                                                            $saglayicilar = json_decode($cek['panel_id'], true);
                                                                                                                                                                                                                                                                                            $option = "";
                                                                                                                                                                                                                                                                                            foreach ($saglayicilar as $key => $value) {
                                                                                                                                                                                                                                                                                                $service_api = new service_api();
                                                                                                                                                                                                                                                                                                $bul = $service_api->where("api_url", $key)->get()->getResultArray();
                                                                                                                                                                                                                                                                                                if (isset($bul[0]['api_key'])) {
                                                                                                                                                                                                                                                                                                    $apikey = $bul[0]['api_key'];
                                                                                                                                                                                                                                                                                                    $option .= '<option value="' . $value . '" data-key="' . $apikey . '">' . $key . '</option>';
                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                            $return = "\r\n            \r\n                    <div class=\"modal-body\">\r\n        <div class=\"form-group\"><select class='form-select w-100' id='select_saglayici'>" . $option . "</select>\r\n          
																																									<p class=\"bg-primary p-3 w-100 text-white text-center\">Mesajı düzenleyerek sağlayıcıya gönderebilirsiniz.</p>																																		  <label class=\"control-label\">Mesaj İçeriği</label>\r\n          <textarea class=\"form-control\" id=\"description_saglayici\" rows=\"5\" name=\"description_saglayici\">" . $tickets["message"] . "</textarea>\r\n        </div>\r\n                    </div>\r\n                      <div class=\"modal-footer\">            \r\n                      <a href=\"javascript::void(0)\" onclick='button_saglayici()' class=\"btn btn-primary\">Güncelle</a>\r\n \r\n                      </div>\r\n                  ";
                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                        echo json_encode(["content" => $return, "title" => "Yanıtı Sağlayıcıya Gönder"]);
                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                }
                                                                                                                                                                                                                            }
                                                                                                                                                                                                                        }
                                                                                                                                                                                                                    }
                                                                                                                                                                                                                }
                                                                                                                                                                                                            }
                                                                                                                                                                                                        }
                                                                                                                                                                                                    }
                                                                                                                                                                                                }
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }

        file_put_contents("system/helper", date("d-m-Y", strtotime("yesterday")));
    }
}
